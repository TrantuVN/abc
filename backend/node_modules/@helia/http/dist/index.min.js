(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.HeliaHttp = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var HeliaHttp=(()=>{var jp=Object.create;var Po=Object.defineProperty;var Gp=Object.getOwnPropertyDescriptor;var Wp=Object.getOwnPropertyNames;var Yp=Object.getPrototypeOf,Zp=Object.prototype.hasOwnProperty;var Bo=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),wt=(r,t)=>{for(var e in t)Po(r,e,{get:t[e],enumerable:!0})},Qu=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Wp(t))!Zp.call(r,o)&&o!==e&&Po(r,o,{get:()=>t[o],enumerable:!(n=Gp(t,o))||n.enumerable});return r};var Nn=(r,t,e)=>(e=r!=null?jp(Yp(r)):{},Qu(t||!r||!r.__esModule?Po(e,"default",{value:r,enumerable:!0}):e,r)),Xp=r=>Qu(Po({},"__esModule",{value:!0}),r);var eh=Bo((p6,Ec)=>{"use strict";var cg=Object.prototype.hasOwnProperty,Kt="~";function co(){}Object.create&&(co.prototype=Object.create(null),new co().__proto__||(Kt=!1));function ug(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function th(r,t,e,n,o){if(typeof e!="function")throw new TypeError("The listener must be a function");var i=new ug(e,n||r,o),s=Kt?Kt+t:t;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],i]:r._events[s].push(i):(r._events[s]=i,r._eventsCount++),r}function Ei(r,t){--r._eventsCount===0?r._events=new co:delete r._events[t]}function Rt(){this._events=new co,this._eventsCount=0}Rt.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)cg.call(e,n)&&t.push(Kt?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};Rt.prototype.listeners=function(t){var e=Kt?Kt+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s};Rt.prototype.listenerCount=function(t){var e=Kt?Kt+t:t,n=this._events[e];return n?n.fn?1:n.length:0};Rt.prototype.emit=function(t,e,n,o,i,s){var a=Kt?Kt+t:t;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,f;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,o),!0;case 5:return c.fn.call(c.context,e,n,o,i),!0;case 6:return c.fn.call(c.context,e,n,o,i,s),!0}for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];c.fn.apply(c.context,u)}else{var d=c.length,x;for(f=0;f<d;f++)switch(c[f].once&&this.removeListener(t,c[f].fn,void 0,!0),l){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,e);break;case 3:c[f].fn.call(c[f].context,e,n);break;case 4:c[f].fn.call(c[f].context,e,n,o);break;default:if(!u)for(x=1,u=new Array(l-1);x<l;x++)u[x-1]=arguments[x];c[f].fn.apply(c[f].context,u)}}return!0};Rt.prototype.on=function(t,e,n){return th(this,t,e,n,!1)};Rt.prototype.once=function(t,e,n){return th(this,t,e,n,!0)};Rt.prototype.removeListener=function(t,e,n,o){var i=Kt?Kt+t:t;if(!this._events[i])return this;if(!e)return Ei(this,i),this;var s=this._events[i];if(s.fn)s.fn===e&&(!o||s.once)&&(!n||s.context===n)&&Ei(this,i);else{for(var a=0,c=[],l=s.length;a<l;a++)(s[a].fn!==e||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[i]=c.length===1?c[0]:c:Ei(this,i)}return this};Rt.prototype.removeAllListeners=function(t){var e;return t?(e=Kt?Kt+t:t,this._events[e]&&Ei(this,e)):(this._events=new co,this._eventsCount=0),this};Rt.prototype.off=Rt.prototype.removeListener;Rt.prototype.addListener=Rt.prototype.on;Rt.prefixed=Kt;Rt.EventEmitter=Rt;typeof Ec<"u"&&(Ec.exports=Rt)});var sh=Bo((F6,ih)=>{ih.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,e=Object.create(null),n=Object.create(null);function o(i,s){e[i]=s,t++,t>=r&&(t=0,n=e,e=Object.create(null))}return{has:function(i){return e[i]!==void 0||n[i]!==void 0},remove:function(i){e[i]!==void 0&&(e[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var s=e[i];if(s!==void 0)return s;if((s=n[i])!==void 0)return o(i,s),s},set:function(i,s){e[i]!==void 0?e[i]=s:o(i,s)},clear:function(){e=Object.create(null),n=Object.create(null)}}}});var sp=Bo(Ao=>{(function(){var r,t,e,n,o,i,s,a;a=function(c){var l,u,f,d;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,f=(c&65280)>>>8,d=c&255,[l,u,f,d].join(".")},s=function(c){var l,u,f,d,x,C;for(l=[],f=d=0;d<=3&&c.length!==0;f=++d){if(f>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}C=t(c),x=C[0],u=C[1],c=c.substring(u),l.push(x)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},e=function(c){return c.charCodeAt(0)},n=e("0"),i=e("a"),o=e("A"),t=function(c){var l,u,f,d,x;for(d=0,l=10,u="9",f=0,c.length>1&&c[f]==="0"&&(c[f+1]==="x"||c[f+1]==="X"?(f+=2,l=16):"0"<=c[f+1]&&c[f+1]<="9"&&(f++,l=8,u="7")),x=f;f<c.length;){if("0"<=c[f]&&c[f]<=u)d=d*l+(e(c[f])-n)>>>0;else if(l===16)if("a"<=c[f]&&c[f]<="f")d=d*l+(10+e(c[f])-i)>>>0;else if("A"<=c[f]&&c[f]<="F")d=d*l+(10+e(c[f])-o)>>>0;else break;else break;if(d>4294967295)throw new Error("too large");f++}if(f===x)throw new Error("empty octet");return[d,f]},r=function(){function c(l,u){var f,d,x,C;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(C=l.split("/",2),l=C[0],u=C[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=s(u)}catch(y){throw f=y,new Error("Invalid mask: "+u)}for(d=x=32;x>=0;d=--x)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(s(l)&this.maskLong)>>>0}catch(y){throw f=y,new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(s(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,f,d;for(d=s(this.first),f=s(this.last),u=0;d<=f;)l(a(d),d,u),u++,d++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),Ao.ip2long=s,Ao.long2ip=a,Ao.Netmask=r}).call(Ao)});var Ku=Bo((SI,Mu)=>{var vI=function(){typeof Mu<"u"&&(Mu.exports=y);var r=86400,t=3200,e=146097*t/400,n=r*e,o=1e3*n,i=864e13,s=4294967296,a=1e6,c="000000000",l=Math.trunc||function(g){var T=g-g%1;return T==0&&(g<0||g===0&&1/g!=1/0)?-0:T},u=y.prototype,f=(y.fromDate=function(g){return new y(+g)},y.fromInt64BE=p(0,1,2,3,0,4),y.fromInt64LE=p(3,2,1,0,4,0),y.fromString=function(k){var T,D=new y,k=(k+="").replace(/^\s*[+\-]?\d+/,function(N){var N=+N,j=1970+(N-1970)%400;return D.year=N-j,j}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(P,N,j){return N<0&&(j*=-1),T=6e4*(60*+N+ +j),""}).replace(/\.\d+$/,function(P){return D.nano=+(P+c).substr(1,9),""}).split(/\D+/);if(1<k.length?k[1]--:k[1]=0,D.time=T=Date.UTC.apply(Date,k)-(T||0),isNaN(T))throw new TypeError("Invalid Date");return _(D)},y.fromTimeT=function(g){return z(g,0)},u.year=0,u.time=0,u.nano=0,u.addNano=function(g){return this.nano+=+g||0,this},u.getNano=function(){var g=_(this);return(g.time%1e3*a+ +g.nano+1e9)%1e9},u.getTimeT=function(){var T=_(this),g=Math.floor(T.time/1e3),T=T.year;return T&&(g+=T*e*r/t),g},u.getYear=function(){return this.toDate().getUTCFullYear()+this.year},u.toDate=function(){return M(_(this).time)},u.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},u.toString=function(g){var T=this,D=T.toDate(),k={H:function(){return R(D.getUTCHours())},L:function(){return U(D.getUTCMilliseconds(),3)},M:function(){return R(D.getUTCMinutes())},N:function(){return U(T.getNano(),9)},S:function(){return R(D.getUTCSeconds())},Y:function(){var P=T.getYear();return 999999<P?"+"+P:9999<P?"+"+U(P,6):0<=P?U(P,4):-999999<=P?"-"+U(-P,6):P},a:function(){return x[D.getUTCDay()]},b:function(){return d[D.getUTCMonth()]},d:function(){return R(D.getUTCDate())},e:function(){return function(P){return(9<P?"":" ")+(0|P)}(D.getUTCDate())},m:function(){return R(D.getUTCMonth()+1)}};return function P(N){return N.replace(/%./g,function(j){var b=j[1],w=C[b],b=k[b];return w?P(w):b?b():j})}(g||f)},u.writeInt64BE=I(0,1,2,3,0,4),u.writeInt64LE=I(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],x=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],C={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return y;function y(g,T,D){var k=this;if(!(k instanceof y))return new y(g,T,D);k.time=+g||0,k.nano=+T||0,k.year=+D||0,_(k)}function _(g){var T,D,k,P=g.year,N=g.time,j=g.nano,w=((j<0||a<=j)&&(j-=(D=Math.floor(j/a))*a,N+=D,D=1),P%t);return(N<-i||i<N||w)&&((T=l(N/o))&&(P+=T*t,N-=T*o),(k=M(N)).setUTCFullYear(w+k.getUTCFullYear()),k=(N=+k)+(T=l((P-=w)/t))*o,T&&-i<=k&&k<=i&&(P-=T*t,N=k),D=1),D&&(g.year=P,g.time=N,g.nano=j),g}function M(g){var T=new Date(0);return T.setTime(g),T}function z(P,k){P=+P||0;var D=l((k=(k|0)*s)/n)+l(P/n),k=k%n+P%n,P=l(k/n);return P&&(D+=P,k-=P*n),new y(1e3*k,0,D*t)}function I(g,T,D,k,P,N){return function(w,b){var S=_(this);w=w||new Array(8),A(w,b|=0);var m=Math.floor(S.time/1e3),S=S.year*(e*r/t),F=l(S/s)+l(m/s),S=S%s+m%s,m=Math.floor(S/s);return m&&(F+=m,S-=m*s),j(w,b+P,F),j(w,b+N,S),w};function j(w,b,F){w[b+g]=F>>24&255,w[b+T]=F>>16&255,w[b+D]=F>>8&255,w[b+k]=255&F}}function p(g,T,D,k,P,N){return function(w,b){A(w,b|=0);var F=j(w,b+P);return z(j(w,b+N),F)};function j(w,b){return 16777216*w[b+g]+(w[b+T]<<16|w[b+D]<<8|w[b+k])}}function A(g,T){if(g=g&&g.length,g==null)throw new TypeError("Invalid Buffer");if(g<T+8)throw new RangeError("Out of range")}function R(g){return(9<g?"":"0")+(0|g)}function U(g,T){return(c+(0|g)).substr(-T)}}()});var Jx={};wt(Jx,{DEFAULT_SESSION_MAX_PROVIDERS:()=>Vc,DEFAULT_SESSION_MIN_PROVIDERS:()=>$c,InsufficientProvidersError:()=>xo,NoRoutersAvailableError:()=>pr,UnknownCodecError:()=>Eo,UnknownHashAlgorithmError:()=>bo,createHeliaHTTP:()=>Qx,heliaDefaults:()=>Xx});var Rn=Symbol.for("@libp2p/content-routing");var Lo=Symbol.for("@libp2p/peer-id");function Ju(r){return!!r?.[Lo]}var Dn=Symbol.for("@libp2p/peer-routing");var se=class extends Error{static name="AbortError";constructor(t="The operation was aborted"){super(t),this.name="AbortError"}};var ht=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Or=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Ct=class extends Error{static name="NotFoundError";constructor(t="Not found"){super(t),this.name="NotFoundError"}};var No=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},Qe=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}};var Mr=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Kr=class extends EventTarget{#t=new Map;constructor(){super()}listenerCount(t){let e=this.#t.get(t);return e==null?0:e.length}addEventListener(t,e,n){super.addEventListener(t,e,n);let o=this.#t.get(t);o==null&&(o=[],this.#t.set(t,o)),o.push({callback:e,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(t,e,n){super.removeEventListener(t.toString(),e??null,n);let o=this.#t.get(t);o!=null&&(o=o.filter(({callback:i})=>i!==e),this.#t.set(t,o))}dispatchEvent(t){let e=super.dispatchEvent(t),n=this.#t.get(t.type);return n==null||(n=n.filter(({once:o})=>!o),this.#t.set(t.type,n)),e}safeDispatchEvent(t,e={}){return this.dispatchEvent(new CustomEvent(t,e))}};function tl(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Je(...r){let t=[];for(let e of r)tl(e)&&t.push(e);await Promise.all(t.map(async e=>{e.beforeStart!=null&&await e.beforeStart()})),await Promise.all(t.map(async e=>{await e.start()})),await Promise.all(t.map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async function tr(...r){let t=[];for(let e of r)tl(e)&&t.push(e);await Promise.all(t.map(async e=>{e.beforeStop!=null&&await e.beforeStop()})),await Promise.all(t.map(async e=>{await e.stop()})),await Promise.all(t.map(async e=>{e.afterStop!=null&&await e.afterStop()}))}function Ft(r){let t=new globalThis.AbortController;function e(){t.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",e)}for(let i of r){if(i?.aborted===!0){e();break}i?.addEventListener!=null&&i.addEventListener("abort",e)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",e)}let o=t.signal;return o.clear=n,o}function ft(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var Ro=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},$r=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Ro(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new Ro(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var Ls=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}};function Un(r={}){return Qp(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Qp(r,t){t=t??{};let e=t.onEnd,n=new $r,o,i,s,a=ft(),c=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((_,M)=>{i=z=>{i=null,n.push(z);try{_(r(n))}catch(I){M(I)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=ft()})}},l=_=>i!=null?i(_):(n.push(_),o),u=_=>(n=new $r,i!=null?i({error:_}):(n.push({error:_}),o)),f=_=>{if(s)return o;if(t?.objectMode!==!0&&_?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:_})},d=_=>s?o:(s=!0,_!=null?u(_):l({done:!0})),x=()=>(n=new $r,d(),{done:!0}),C=_=>(d(_),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:x,throw:C,push:f,end:d,get readableLength(){return n.size},onEmpty:async _=>{let M=_?.signal;if(M?.throwIfAborted(),n.isEmpty())return;let z,I;M!=null&&(z=new Promise((p,A)=>{I=()=>{A(new Ls)},M.addEventListener("abort",I)}));try{await Promise.race([a.promise,z])}finally{I!=null&&M!=null&&M?.removeEventListener("abort",I)}}},e==null)return o;let y=o;return o={[Symbol.asyncIterator](){return this},next(){return y.next()},throw(_){return y.throw(_),e!=null&&(e(_),e=void 0),{done:!0}},return(){return y.return(),e!=null&&(e(),e=void 0),{done:!0}},push:f,end(_){return y.end(_),e!=null&&(e(_),e=void 0),o},get readableLength(){return y.readableLength},onEmpty:_=>y.onEmpty(_)},o}var Ns=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=e??"ABORT_ERR"}};async function Do(r,t,e,n){let o=new Ns(n?.errorMessage,n?.errorCode);return e?.aborted===!0?Promise.reject(o):new Promise((i,s)=>{function a(){e?.removeEventListener("abort",u),r.removeEventListener(t,c),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,l)}let c=f=>{try{if(n?.filter?.(f)===!1)return}catch(d){a(),s(d);return}a(),i(f)},l=f=>{a(),s(f.detail)},u=()=>{a(),s(o)};e?.addEventListener("abort",u),r.addEventListener(t,c),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,l)})}function Rs(r,t){let e,n=function(){let o=function(){e=void 0,r()};clearTimeout(e),e=setTimeout(o,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(e)},n}var Uo=class extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}};var Fo=class extends Error{type;code;constructor(t,e,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=e??"ABORT_ERR"}};async function Oo(r,t,e){if(t==null)return r;if(t.aborted)return r.catch(()=>{}),Promise.reject(new Fo(e?.errorMessage,e?.errorCode,e?.errorName));let n,o=new Fo(e?.errorMessage,e?.errorCode,e?.errorName);try{return await Promise.race([r,new Promise((i,s)=>{n=()=>{s(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var Mo=class{deferred;signal;constructor(t){this.signal=t,this.deferred=ft(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new se)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function Jp(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var Ko=class{id;fn;options;recipients;status;timeline;controller;constructor(t,e){this.id=Jp(),this.status="queued",this.fn=t,this.options=e,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(t){this.controller.abort(t)}onAbort(){this.recipients.reduce((e,n)=>e&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new se),this.cleanup())}async join(t={}){let e=new Mo(t.signal);return this.recipients.push(e),t.signal?.addEventListener("abort",this.onAbort),e.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();let t=await Oo(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(e=>{e.deferred.resolve(t)}),this.status="complete"}catch(t){this.recipients.forEach(e=>{e.deferred.reject(t)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(t=>{t.cleanup(),t.signal?.removeEventListener("abort",this.onAbort)})}};var Ne=class extends Kr{concurrency;maxSize;queue;pending;sort;constructor(t={}){super(),this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&t.metrics?.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=t.sort,this.queue=[],this.emitEmpty=Rs(this.emitEmpty.bind(this),1),this.emitIdle=Rs(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(let e of this.queue)if(e.status==="queued"){t=e;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let e=0;e<this.queue.length;e++)if(this.queue[e]===t){this.queue.splice(e,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,e){if(e?.signal?.throwIfAborted(),this.size===this.maxSize)throw new Uo;let n=new Ko(t,e);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(e).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:n,result:o}}),o)).catch(o=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:n,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new se)}),this.clear()}async onEmpty(t){this.size!==0&&await Do(this,"empty",t?.signal)}async onSizeLessThan(t,e){this.size<t||await Do(this,"next",e?.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Do(this,"idle",t?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();let e=Un({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),e.end(c)},o=c=>{c.detail!=null&&e.push(c.detail)},i=c=>{n(c.detail)},s=()=>{n()},a=()=>{n(new se("Queue aborted"))};this.addEventListener("completed",o),this.addEventListener("error",i),this.addEventListener("idle",s),t?.signal?.addEventListener("abort",a);try{yield*e}finally{this.removeEventListener("completed",o),this.removeEventListener("error",i),this.removeEventListener("idle",s),t?.signal?.removeEventListener("abort",a),n()}}};var $o=class extends Ne{has(t){return this.find(t)!=null}find(t){return this.queue.find(e=>t.equals(e.options.peerId))}};function tm(r){return r[Symbol.asyncIterator]!=null}function em(r){if(tm(r))return(async()=>{for await(let t of r);})();for(let t of r);}var wr=em;function ae(r=0){return new Uint8Array(r)}function Vt(r=0){return new Uint8Array(r)}var rm=Math.pow(2,7),nm=Math.pow(2,14),om=Math.pow(2,21),Us=Math.pow(2,28),Fs=Math.pow(2,35),Os=Math.pow(2,42),Ms=Math.pow(2,49),nt=128,Pt=127;function qt(r){if(r<rm)return 1;if(r<nm)return 2;if(r<om)return 3;if(r<Us)return 4;if(r<Fs)return 5;if(r<Os)return 6;if(r<Ms)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Ks(r,t,e=0){switch(qt(r)){case 8:t[e++]=r&255|nt,r/=128;case 7:t[e++]=r&255|nt,r/=128;case 6:t[e++]=r&255|nt,r/=128;case 5:t[e++]=r&255|nt,r/=128;case 4:t[e++]=r&255|nt,r>>>=7;case 3:t[e++]=r&255|nt,r>>>=7;case 2:t[e++]=r&255|nt,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function im(r,t,e=0){switch(qt(r)){case 8:t.set(e++,r&255|nt),r/=128;case 7:t.set(e++,r&255|nt),r/=128;case 6:t.set(e++,r&255|nt),r/=128;case 5:t.set(e++,r&255|nt),r/=128;case 4:t.set(e++,r&255|nt),r>>>=7;case 3:t.set(e++,r&255|nt),r>>>=7;case 2:t.set(e++,r&255|nt),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function $s(r,t){let e=r[t],n=0;if(n+=e&Pt,e<nt||(e=r[t+1],n+=(e&Pt)<<7,e<nt)||(e=r[t+2],n+=(e&Pt)<<14,e<nt)||(e=r[t+3],n+=(e&Pt)<<21,e<nt)||(e=r[t+4],n+=(e&Pt)*Us,e<nt)||(e=r[t+5],n+=(e&Pt)*Fs,e<nt)||(e=r[t+6],n+=(e&Pt)*Os,e<nt)||(e=r[t+7],n+=(e&Pt)*Ms,e<nt))return n;throw new RangeError("Could not decode varint")}function sm(r,t){let e=r.get(t),n=0;if(n+=e&Pt,e<nt||(e=r.get(t+1),n+=(e&Pt)<<7,e<nt)||(e=r.get(t+2),n+=(e&Pt)<<14,e<nt)||(e=r.get(t+3),n+=(e&Pt)<<21,e<nt)||(e=r.get(t+4),n+=(e&Pt)*Us,e<nt)||(e=r.get(t+5),n+=(e&Pt)*Fs,e<nt)||(e=r.get(t+6),n+=(e&Pt)*Os,e<nt)||(e=r.get(t+7),n+=(e&Pt)*Ms,e<nt))return n;throw new RangeError("Could not decode varint")}function Vr(r,t,e=0){return t==null&&(t=Vt(qt(r))),t instanceof Uint8Array?Ks(r,t,e):im(r,t,e)}function xr(r,t=0){return r instanceof Uint8Array?$s(r,t):sm(r,t)}function Bt(r,t){t==null&&(t=r.reduce((o,i)=>o+i.length,0));let e=Vt(t),n=0;for(let o of r)e.set(o,n),n+=o.length;return e}function Q(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}var nl=Symbol.for("@achingbrain/uint8arraylist");function rl(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let o=e+n.byteLength;if(t<o)return{buf:n,index:t-e};e=o}throw new RangeError("index is out of bounds")}function qr(r){return!!r?.[nl]}var Gt=class r{bufs;length;[nl]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(qr(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(qr(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=rl(this.bufs,t);return e.buf[e.index]}set(t,e){let n=rl(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(qr(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:o}=this._subList(t,e);return Bt(n,o)}subarray(t,e){let{bufs:n,length:o}=this._subList(t,e);return n.length===1?n[0]:Bt(n,o)}sublist(t,e){let{bufs:n,length:o}=this._subList(t,e),i=new r;return i.length=o,i.bufs=[...n],i}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,t>=c)continue;let l=t>=a&&t<c,u=e>a&&e<=c;if(l&&u){if(t===a&&e===c){n.push(s);break}let f=t-a;n.push(s.subarray(f,f+(e-t)));break}if(l){if(t===0){n.push(s);continue}n.push(s.subarray(t-a));continue}if(u){if(e===c){n.push(s);break}n.push(s.subarray(0,e-a));break}n.push(s)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!qr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let f=0;f<i;f++)s[f]=-1;for(let f=0;f<o;f++)s[n[f]]=f;let a=s,c=this.byteLength-n.byteLength,l=n.byteLength-1,u;for(let f=e;f<=c;f+=u){u=0;for(let d=l;d>=0;d--){let x=this.get(f+d);if(n[d]!==x){u=Math.max(1,d-a[x]);break}}if(u===0)return f}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=Vt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let o=ae(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,e,n),this.write(o,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let o=ae(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,e,n),this.write(o,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let o=ae(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,e,n),this.write(o,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=Vt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let o=ae(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,e,n),this.write(o,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let o=ae(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,e,n),this.write(o,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let o=ae(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,e,n),this.write(o,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let o=ae(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,e,n),this.write(o,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let o=ae(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,e,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!Q(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((o,i)=>o+i.byteLength,0)),n.length=e,n}};function am(r){let[t,e]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:o=>{n.push(o)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[e](){return this}}}var zr=am;function cm(r){return r[Symbol.asyncIterator]!=null}function um(r,t){let e=0;if(cm(r))return async function*(){for await(let c of r)yield t(c,e++)}();let n=zr(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=t(o,e++);if(typeof s.then=="function")return async function*(){yield await s;for await(let c of n)yield t(c,e++)}();let a=t;return function*(){yield s;for(let c of n)yield a(c,e++)}()}var Hr=um;var Vs=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=ft(),this.haveNext=ft()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=ft(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=ft(),await Oo(this.readNext.promise,e?.signal,e)}};function ol(){return new Vs}function lm(r){return r[Symbol.asyncIterator]!=null}async function fm(r,t,e){try{await Promise.all(r.map(async n=>{for await(let o of n)await t.push(o,{signal:e}),e.throwIfAborted()})),await t.end(void 0,{signal:e})}catch(n){await t.end(n,{signal:e}).catch(()=>{})}}async function*hm(r){let t=new AbortController,e=ol();fm(r,e,t.signal).catch(()=>{});try{yield*e}finally{t.abort()}}function*dm(r){for(let t of r)yield*t}function pm(...r){let t=[];for(let e of r)lm(e)||t.push(e);return t.length===r.length?dm(t):hm(r)}var br=pm;function mm(r){return r[Symbol.asyncIterator]!=null}function ym(r,t){return mm(r)?async function*(){let e=0;if(!(t<1)){for await(let n of r)if(yield n,e++,e===t)return}}():function*(){let e=0;if(!(t<1)){for(let n of r)if(yield n,e++,e===t)return}}()}var Vo=ym;var et=class extends Event{type;detail;constructor(t,e){super(t),this.type=t,this.detail=e}};var qs=new Float32Array([-0]),er=new Uint8Array(qs.buffer);function il(r,t,e){qs[0]=r,t[e]=er[0],t[e+1]=er[1],t[e+2]=er[2],t[e+3]=er[3]}function sl(r,t){return er[0]=r[t],er[1]=r[t+1],er[2]=r[t+2],er[3]=r[t+3],qs[0]}var zs=new Float64Array([-0]),Lt=new Uint8Array(zs.buffer);function al(r,t,e){zs[0]=r,t[e]=Lt[0],t[e+1]=Lt[1],t[e+2]=Lt[2],t[e+3]=Lt[3],t[e+4]=Lt[4],t[e+5]=Lt[5],t[e+6]=Lt[6],t[e+7]=Lt[7]}function cl(r,t){return Lt[0]=r[t],Lt[1]=r[t+1],Lt[2]=r[t+2],Lt[3]=r[t+3],Lt[4]=r[t+4],Lt[5]=r[t+5],Lt[6]=r[t+6],Lt[7]=r[t+7],zs[0]}var gm=BigInt(Number.MAX_SAFE_INTEGER),wm=BigInt(Number.MIN_SAFE_INTEGER),Wt=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Er;if(t<gm&&t>wm)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,o=t-(n<<32n);return e&&(n=~n|0n,o=~o|0n,++o>ul&&(o=0n,++n>ul&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(t){if(t===0)return Er;let e=t<0;e&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return e&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):Er}},Er=new Wt(0,0);Er.toBigInt=function(){return 0n};Er.zzEncode=Er.zzDecode=function(){return this};Er.length=function(){return 1};var ul=4294967296n;function ll(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function fl(r,t,e){if(e-t<1)return"";let o,i=[],s=0,a;for(;t<e;)a=r[t++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[t++]&63:a>239&&a<365?(a=((a&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[t++]&63)<<6|r[t++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function Hs(r,t,e){let n=e,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128);return e-n}function ce(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function qo(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var js=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,ce(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw ce(this,4);return qo(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ce(this,4);return qo(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw ce(this,4);let t=sl(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw ce(this,4);let t=cl(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw ce(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return fl(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw ce(this,t);this.pos+=t}else do if(this.pos>=this.len)throw ce(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Wt(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ce(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw ce(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ce(this,8);let t=qo(this.buf,this.pos+=4),e=qo(this.buf,this.pos+=4);return new Wt(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=$s(this.buf,this.pos);return this.pos+=qt(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Gs(r){return new js(r instanceof Uint8Array?r:r.subarray())}function jr(r,t,e){let n=Gs(r);return t.decode(n,void 0,e)}var Js={};wt(Js,{base10:()=>_m});var d1=new Uint8Array(0);function dl(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function ue(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function pl(r){return new TextEncoder().encode(r)}function ml(r){return new TextDecoder().decode(r)}function xm(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(e[s]!==255)throw new TypeError(i+" is ambiguous");e[s]=o}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var y=0,_=0,M=0,z=C.length;M!==z&&C[M]===0;)M++,y++;for(var I=(z-M)*u+1>>>0,p=new Uint8Array(I);M!==z;){for(var A=C[M],R=0,U=I-1;(A!==0||R<_)&&U!==-1;U--,R++)A+=256*p[U]>>>0,p[U]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");_=R,M++}for(var g=I-_;g!==I&&p[g]===0;)g++;for(var T=c.repeat(y);g<I;++g)T+=r.charAt(p[g]);return T}function d(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var y=0;if(C[y]!==" "){for(var _=0,M=0;C[y]===c;)_++,y++;for(var z=(C.length-y)*l+1>>>0,I=new Uint8Array(z);C[y];){var p=e[C.charCodeAt(y)];if(p===255)return;for(var A=0,R=z-1;(p!==0||A<M)&&R!==-1;R--,A++)p+=a*I[R]>>>0,I[R]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");M=A,y++}if(C[y]!==" "){for(var U=z-M;U!==z&&I[U]===0;)U++;for(var g=new Uint8Array(_+(z-U)),T=_;U!==z;)g[T++]=I[U++];return g}}}function x(C){var y=d(C);if(y)return y;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:d,decode:x}}var bm=xm,Em=bm,yl=Em;var Ys=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Zs=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let o=e.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return gl(this,t)}},Xs=class{decoders;constructor(t){this.decoders=t}or(t){return gl(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function gl(r,t){return new Xs({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var Qs=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,o){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=o,this.encoder=new Ys(t,e,n),this.decoder=new Zs(t,e,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Gr({name:r,prefix:t,encode:e,decode:n}){return new Qs(r,t,e,n)}function rr({name:r,prefix:t,alphabet:e}){let{encode:n,decode:o}=yl(e,r);return Gr({prefix:t,name:r,encode:n,decode:i=>ue(o(i))})}function vm(r,t,e,n){let o=r.length;for(;r[o-1]==="=";)--o;let i=new Uint8Array(o*e/8|0),s=0,a=0,c=0;for(let l=0;l<o;++l){let u=t[r[l]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<e|u,s+=e,s>=8&&(s-=8,i[c++]=255&a>>s)}if(s>=e||(255&a<<8-s)!==0)throw new SyntaxError("Unexpected end of data");return i}function Sm(r,t,e){let n=t[t.length-1]==="=",o=(1<<e)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>e;)s-=e,i+=t[o&a>>s];if(s!==0&&(i+=t[o&a<<e-s]),n)for(;(i.length*e&7)!==0;)i+="=";return i}function Am(r){let t={};for(let e=0;e<r.length;++e)t[r[e]]=e;return t}function dt({name:r,prefix:t,bitsPerChar:e,alphabet:n}){let o=Am(n);return Gr({prefix:t,name:r,encode(i){return Sm(i,n,e)},decode(i){return vm(i,o,e,r)}})}var _m=rr({prefix:"9",name:"base10",alphabet:"0123456789"});var ta={};wt(ta,{base16:()=>Im,base16upper:()=>Tm});var Im=dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Tm=dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ea={};wt(ea,{base2:()=>km});var km=dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ra={};wt(ra,{base256emoji:()=>Nm});var wl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Cm=wl.reduce((r,t,e)=>(r[e]=t,r),[]),Pm=wl.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function Bm(r){return r.reduce((t,e)=>(t+=Cm[e],t),"")}function Lm(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let o=Pm[n];if(o==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(o)}return new Uint8Array(t)}var Nm=Gr({prefix:"\u{1F680}",name:"base256emoji",encode:Bm,decode:Lm});var na={};wt(na,{base32:()=>At,base32hex:()=>Fm,base32hexpad:()=>Mm,base32hexpadupper:()=>Km,base32hexupper:()=>Om,base32pad:()=>Dm,base32padupper:()=>Um,base32upper:()=>Rm,base32z:()=>$m});var At=dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Rm=dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Dm=dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Um=dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Fm=dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Om=dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mm=dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Km=dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$m=dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var oa={};wt(oa,{base36:()=>Ae,base36upper:()=>Vm});var Ae=rr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Vm=rr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ia={};wt(ia,{base58btc:()=>ot,base58flickr:()=>qm});var ot=rr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qm=rr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var aa={};wt(aa,{base64:()=>_e,base64pad:()=>zm,base64url:()=>sa,base64urlpad:()=>Hm});var _e=dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),zm=dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sa=dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Hm=dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ca={};wt(ca,{base8:()=>jm});var jm=dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ua={};wt(ua,{identity:()=>Gm});var Gm=Gr({prefix:"\0",name:"identity",encode:r=>ml(r),decode:r=>pl(r)});var zo={};wt(zo,{code:()=>la,decode:()=>Qm,encode:()=>Xm,name:()=>Zm});var Wm=new TextEncoder,Ym=new TextDecoder,Zm="json",la=512;function Xm(r){return Wm.encode(JSON.stringify(r))}function Qm(r){return JSON.parse(Ym.decode(r))}var On={};wt(On,{code:()=>Fn,decode:()=>e0,encode:()=>t0,name:()=>Jm});var Jm="raw",Fn=85;function t0(r){return ue(r)}function e0(r){return ue(r)}var ha={};wt(ha,{identity:()=>Nt});var r0=El,xl=128,n0=127,o0=~n0,i0=Math.pow(2,31);function El(r,t,e){t=t||[],e=e||0;for(var n=e;r>=i0;)t[e++]=r&255|xl,r/=128;for(;r&o0;)t[e++]=r&255|xl,r>>>=7;return t[e]=r|0,El.bytes=e-n+1,t}var s0=fa,a0=128,bl=127;function fa(r,n){var e=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw fa.bytes=0,new RangeError("Could not decode varint");s=r[i++],e+=o<28?(s&bl)<<o:(s&bl)*Math.pow(2,o),o+=7}while(s>=a0);return fa.bytes=i-n,e}var c0=Math.pow(2,7),u0=Math.pow(2,14),l0=Math.pow(2,21),f0=Math.pow(2,28),h0=Math.pow(2,35),d0=Math.pow(2,42),p0=Math.pow(2,49),m0=Math.pow(2,56),y0=Math.pow(2,63),g0=function(r){return r<c0?1:r<u0?2:r<l0?3:r<f0?4:r<h0?5:r<d0?6:r<p0?7:r<m0?8:r<y0?9:10},w0={encode:r0,decode:s0,encodingLength:g0},x0=w0,Mn=x0;function Kn(r,t=0){return[Mn.decode(r,t),Mn.decode.bytes]}function Wr(r,t,e=0){return Mn.encode(r,t,e),t}function Yr(r){return Mn.encodingLength(r)}function le(r,t){let e=t.byteLength,n=Yr(r),o=n+Yr(e),i=new Uint8Array(o+e);return Wr(r,i,0),Wr(e,i,n),i.set(t,o),new Zr(r,e,t,i)}function fe(r){let t=ue(r),[e,n]=Kn(t),[o,i]=Kn(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Zr(e,o,s,t)}function vl(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&dl(r.bytes,e.bytes)}}var Zr=class{code;size;digest;bytes;constructor(t,e,n,o){this.code=t,this.size=e,this.digest=n,this.bytes=o}};var Sl=0,b0="identity",Al=ue;function E0(r){return le(Sl,Al(r))}var Nt={code:Sl,name:b0,encode:Al,digest:E0};var ma={};wt(ma,{sha256:()=>nr,sha512:()=>jo});function pa({name:r,code:t,encode:e}){return new da(r,t,e)}var da=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?le(this.code,e):e.then(n=>le(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Il(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var nr=pa({name:"sha2-256",code:18,encode:Il("SHA-256")}),jo=pa({name:"sha2-512",code:19,encode:Il("SHA-512")});function Tl(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return S0(e,ya(r),t??ot.encoder);default:return A0(e,ya(r),t??At.encoder)}}var kl=new WeakMap;function ya(r){let t=kl.get(r);if(t==null){let e=new Map;return kl.set(r,e),e}return t}var K=class r{code;version;multihash;bytes;"/";constructor(t,e,n,o){this.code=e,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==$n)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==_0)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=le(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&vl(t.multihash,n.multihash)}toString(t){return Tl(this,t)}toJSON(){return{"/":Tl(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:o,multihash:i,bytes:s}=e;return new r(n,o,i,s??Cl(n,o,i.bytes))}else if(e[I0]===!0){let{version:n,multihash:o,code:i}=e,s=fe(o);return r.create(n,i,s)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==$n)throw new Error(`Version 0 CID must use dag-pb (code: ${$n}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let o=Cl(t,e,n.bytes);return new r(t,e,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,$n,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,o=ue(t.subarray(n,n+e.multihashSize));if(o.byteLength!==e.multihashSize)throw new Error("Incorrect length");let i=o.subarray(e.multihashSize-e.digestSize),s=new Zr(e.multihashCode,e.digestSize,i,o);return[e.version===0?r.createV0(s):r.createV1(e.codec,s),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[f,d]=Kn(t.subarray(e));return e+=d,f},o=n(),i=$n;if(o===18?(o=0,e=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=e,a=n(),c=n(),l=e+c,u=l-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(t,e){let[n,o]=v0(t,e),i=r.decode(o);if(i.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ya(i).set(n,t),i}};function v0(r,t){switch(r[0]){case"Q":{let e=t??ot;return[ot.prefix,e.decode(`${ot.prefix}${r}`)]}case ot.prefix:{let e=t??ot;return[ot.prefix,e.decode(r)]}case At.prefix:{let e=t??At;return[At.prefix,e.decode(r)]}case Ae.prefix:{let e=t??Ae;return[Ae.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function S0(r,t,e){let{prefix:n}=e;if(n!==ot.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let o=t.get(n);if(o==null){let i=e.encode(r).slice(1);return t.set(n,i),i}else return o}function A0(r,t,e){let{prefix:n}=e,o=t.get(n);if(o==null){let i=e.encode(r);return t.set(n,i),i}else return o}var $n=112,_0=18;function Cl(r,t,e){let n=Yr(r),o=n+Yr(t),i=new Uint8Array(o+e.byteLength);return Wr(r,i,0),Wr(t,i,n),i.set(e,o),i}var I0=Symbol.for("@ipld/js-cid/CID");var Vn={...ua,...ea,...ca,...Js,...ta,...na,...oa,...ia,...aa,...ra},Z1={...ma,...ha};function Bl(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var Pl=Bl("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ga=Bl("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=Vt(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),T0={utf8:Pl,"utf-8":Pl,hex:Vn.base16,latin1:ga,ascii:ga,binary:ga,...Vn},Go=T0;function V(r,t="utf8"){let e=Go[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function wa(r){let t=r??8192,e=t>>>1,n,o=t;return function(s){if(s<1||s>e)return Vt(s);o+s>t&&(n=Vt(t),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var vr=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function xa(){}var Ea=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},k0=wa();function C0(r){return globalThis.Buffer!=null?Vt(r):k0(r)}var zn=class{len;head;tail;states;constructor(){this.len=0,this.head=new vr(xa,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new vr(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new va((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Wo,10,Wt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=Wt.fromBigInt(t);return this._push(Wo,e.length(),e)}uint64Number(t){return this._push(Ks,qt(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=Wt.fromBigInt(t).zzEncode();return this._push(Wo,e.length(),e)}sint64Number(t){let e=Wt.fromNumber(t).zzEncode();return this._push(Wo,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(ba,1,t?1:0)}fixed32(t){return this._push(qn,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=Wt.fromBigInt(t);return this._push(qn,4,e.lo)._push(qn,4,e.hi)}fixed64Number(t){let e=Wt.fromNumber(t);return this._push(qn,4,e.lo)._push(qn,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(il,4,t)}double(t){return this._push(al,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(ba,1,0):this.uint32(e)._push(B0,e,t)}string(t){let e=ll(t);return e!==0?this.uint32(e)._push(Hs,e,t):this._push(ba,1,0)}fork(){return this.states=new Ea(this),this.head=this.tail=new vr(xa,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new vr(xa,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=C0(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function ba(r,t,e){t[e]=r&255}function P0(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var va=class extends vr{next;constructor(t,e){super(P0,t,e),this.next=void 0}};function Wo(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function qn(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function B0(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(zn.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(L0,t,r),this},zn.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(N0,t,r),this});function L0(r,t,e){t.set(r,e)}function N0(r,t,e){r.length<40?Hs(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(V(r),e)}function Sa(){return new zn}function Xr(r,t){let e=Sa();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var Qr;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Qr||(Qr={}));function Yo(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function Hn(r){function t(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let e=function(i,s){let a=t(i);s.int32(a)},n=function(i){let s=i.int32();return t(s)};return Yo("enum",Qr.VARINT,e,n)}function Jr(r,t){return Yo("message",Qr.LENGTH_DELIMITED,r,t)}function q(r,t="utf8"){let e=Go[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.encoder.encode(r).substring(1)}var R0=parseInt("11111",2),Aa=parseInt("10000000",2),D0=parseInt("01111111",2),Ll={0:jn,1:jn,2:U0,3:M0,4:K0,5:O0,6:F0,16:jn,22:jn,48:jn};function De(r,t={offset:0}){let e=r[t.offset]&R0;if(t.offset++,Ll[e]!=null)return Ll[e](r,t);throw new Error("No decoder for tag "+e)}function Gn(r,t){let e=0;if((r[t.offset]&Aa)===Aa){let n=r[t.offset]&D0,o="0x";t.offset++;for(let i=0;i<n;i++,t.offset++)o+=r[t.offset].toString(16).padStart(2,"0");e=parseInt(o,16)}else e=r[t.offset],t.offset++;return e}function jn(r,t){Gn(r,t);let e=[];for(;!(t.offset>=r.byteLength);){let n=De(r,t);if(n===null)break;e.push(n)}return e}function U0(r,t){let e=Gn(r,t),n=t.offset,o=t.offset+e,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return t.offset+=e,Uint8Array.from(i)}function F0(r,t){let e=Gn(r,t),n=t.offset+e,o=r[t.offset];t.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;t.offset<n;){let l=r[t.offset];if(t.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let f=0;f<c.length;f++)u+=c[f]<<f*7;a+=`.${u}`,c=[]}}return a}function O0(r,t){return t.offset++,null}function M0(r,t){let e=Gn(r,t),n=r[t.offset];t.offset++;let o=r.subarray(t.offset,t.offset+e-1);if(t.offset+=e,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function K0(r,t){let e=Gn(r,t),n=r.subarray(t.offset,t.offset+e);return t.offset+=e,n}function $0(r){let t=r.toString(16);t.length%2===1&&(t="0"+t);let e=new Gt;for(let n=0;n<t.length;n+=2)e.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return e}function _a(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let t=$0(r.byteLength);return new Gt(Uint8Array.from([t.byteLength|Aa]),t)}function zt(r){let t=new Gt,e=128;return(r.subarray()[0]&e)===e&&t.append(Uint8Array.from([0])),t.append(r),new Gt(Uint8Array.from([2]),_a(t),t)}function Zo(r){let t=Uint8Array.from([0]),e=new Gt(t,r);return new Gt(Uint8Array.from([3]),_a(e),e)}function or(r,t=48){let e=new Gt;for(let n of r)e.append(n);return new Gt(Uint8Array.from([t]),_a(e),e)}async function Nl(r,t,e){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,t,e.subarray())}var V0=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),q0=Uint8Array.from([6,5,43,129,4,0,34]),z0=Uint8Array.from([6,5,43,129,4,0,35]),H0={ext:!0,kty:"EC",crv:"P-256"},j0={ext:!0,kty:"EC",crv:"P-384"},G0={ext:!0,kty:"EC",crv:"P-521"},Ia=32,Ta=48,ka=66;function Ca(r){let t=De(r);return Rl(t)}function Rl(r){let t=r[1][1][0],e=1,n,o;if(t.byteLength===Ia*2+1)return n=q(t.subarray(e,e+Ia),"base64url"),o=q(t.subarray(e+Ia),"base64url"),new tn({...H0,key_ops:["verify"],x:n,y:o});if(t.byteLength===Ta*2+1)return n=q(t.subarray(e,e+Ta),"base64url"),o=q(t.subarray(e+Ta),"base64url"),new tn({...j0,key_ops:["verify"],x:n,y:o});if(t.byteLength===ka*2+1)return n=q(t.subarray(e,e+ka),"base64url"),o=q(t.subarray(e+ka),"base64url"),new tn({...G0,key_ops:["verify"],x:n,y:o});throw new ht(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function Dl(r){return or([zt(Uint8Array.from([1])),or([W0(r.crv)],160),or([Zo(new Gt(Uint8Array.from([4]),V(r.x??"","base64url"),V(r.y??"","base64url")))],161)]).subarray()}function W0(r){if(r==="P-256")return V0;if(r==="P-384")return q0;if(r==="P-521")return z0;throw new ht(`Invalid curve ${r}`)}var tn=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=Dl(this.jwk)),this._raw}toMultihash(){return Nt.digest(en(this))}toCID(){return K.createV1(114,this.toMultihash())}toString(){return ot.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Q(this.raw,t.raw)}async verify(t,e){return Nl(this.jwk,e,t)}};var Sr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Y0(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xo(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Ar(r,...t){if(!Y0(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function Ul(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Xo(r.outputLen),Xo(r.blockLen)}function nn(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Fl(r,t){Ar(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function Ue(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}function Qo(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function he(r,t){return r<<32-t|r>>>t}function Ol(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Wn(r){return typeof r=="string"&&(r=Ol(r)),Ar(r),r}function Pa(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ar(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let i=r[n];e.set(i,o),o+=i.length}return e}var rn=class{};function Ba(r){let t=n=>r().update(Wn(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function Jo(r=32){if(Sr&&typeof Sr.getRandomValues=="function")return Sr.getRandomValues(new Uint8Array(r));if(Sr&&typeof Sr.randomBytes=="function")return Uint8Array.from(Sr.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function Z0(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(e>>o&i),a=Number(e&i),c=n?4:0,l=n?0:4;r.setUint32(t+c,s,n),r.setUint32(t+l,a,n)}function Ml(r,t,e){return r&t^~r&e}function Kl(r,t,e){return r&t^r&e^t&e}var Yn=class extends rn{constructor(t,e,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Qo(this.buffer)}update(t){nn(this),t=Wn(t),Ar(t);let{view:e,buffer:n,blockLen:o}=this,i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Qo(t);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){nn(this),Fl(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;e[s++]=128,Ue(this.buffer.subarray(s)),this.padOffset>o-s&&(this.process(n,0),s=0);for(let f=s;f<o;f++)e[f]=0;Z0(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Qo(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],i)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return t.destroyed=s,t.finished=i,t.length=o,t.pos=a,o%e&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Fe=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var _t=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var ti=BigInt(4294967295),$l=BigInt(32);function X0(r,t=!1){return t?{h:Number(r&ti),l:Number(r>>$l&ti)}:{h:Number(r>>$l&ti)|0,l:Number(r&ti)|0}}function Vl(r,t=!1){let e=r.length,n=new Uint32Array(e),o=new Uint32Array(e);for(let i=0;i<e;i++){let{h:s,l:a}=X0(r[i],t);[n[i],o[i]]=[s,a]}return[n,o]}var La=(r,t,e)=>r>>>e,Na=(r,t,e)=>r<<32-e|t>>>e,_r=(r,t,e)=>r>>>e|t<<32-e,Ir=(r,t,e)=>r<<32-e|t>>>e,Zn=(r,t,e)=>r<<64-e|t>>>e-32,Xn=(r,t,e)=>r>>>e-32|t<<64-e;function Ie(r,t,e,n){let o=(t>>>0)+(n>>>0);return{h:r+e+(o/2**32|0)|0,l:o|0}}var ql=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),zl=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,Hl=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),jl=(r,t,e,n,o)=>t+e+n+o+(r/2**32|0)|0,Gl=(r,t,e,n,o)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(o>>>0),Wl=(r,t,e,n,o,i)=>t+e+n+o+i+(r/2**32|0)|0;var J0=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ir=new Uint32Array(64),ei=class extends Yn{constructor(t=32){super(64,t,8,!1),this.A=Fe[0]|0,this.B=Fe[1]|0,this.C=Fe[2]|0,this.D=Fe[3]|0,this.E=Fe[4]|0,this.F=Fe[5]|0,this.G=Fe[6]|0,this.H=Fe[7]|0}get(){let{A:t,B:e,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[t,e,n,o,i,s,a,c]}set(t,e,n,o,i,s,a,c){this.A=t|0,this.B=e|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(t,e){for(let f=0;f<16;f++,e+=4)ir[f]=t.getUint32(e,!1);for(let f=16;f<64;f++){let d=ir[f-15],x=ir[f-2],C=he(d,7)^he(d,18)^d>>>3,y=he(x,17)^he(x,19)^x>>>10;ir[f]=y+ir[f-7]+C+ir[f-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){let d=he(a,6)^he(a,11)^he(a,25),x=u+d+Ml(a,c,l)+J0[f]+ir[f]|0,y=(he(n,2)^he(n,13)^he(n,22))+Kl(n,o,i)|0;u=l,l=c,c=a,a=s+x|0,s=i,i=o,o=n,n=x+y|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,o,i,s,a,c,l,u)}roundClean(){Ue(ir)}destroy(){this.set(0,0,0,0,0,0,0,0),Ue(this.buffer)}};var Yl=Vl(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),ty=Yl[0],ey=Yl[1],sr=new Uint32Array(80),ar=new Uint32Array(80),Ra=class extends Yn{constructor(t=64){super(128,t,16,!1),this.Ah=_t[0]|0,this.Al=_t[1]|0,this.Bh=_t[2]|0,this.Bl=_t[3]|0,this.Ch=_t[4]|0,this.Cl=_t[5]|0,this.Dh=_t[6]|0,this.Dl=_t[7]|0,this.Eh=_t[8]|0,this.El=_t[9]|0,this.Fh=_t[10]|0,this.Fl=_t[11]|0,this.Gh=_t[12]|0,this.Gl=_t[13]|0,this.Hh=_t[14]|0,this.Hl=_t[15]|0}get(){let{Ah:t,Al:e,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:l,El:u,Fh:f,Fl:d,Gh:x,Gl:C,Hh:y,Hl:_}=this;return[t,e,n,o,i,s,a,c,l,u,f,d,x,C,y,_]}set(t,e,n,o,i,s,a,c,l,u,f,d,x,C,y,_){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=f|0,this.Fl=d|0,this.Gh=x|0,this.Gl=C|0,this.Hh=y|0,this.Hl=_|0}process(t,e){for(let I=0;I<16;I++,e+=4)sr[I]=t.getUint32(e),ar[I]=t.getUint32(e+=4);for(let I=16;I<80;I++){let p=sr[I-15]|0,A=ar[I-15]|0,R=_r(p,A,1)^_r(p,A,8)^La(p,A,7),U=Ir(p,A,1)^Ir(p,A,8)^Na(p,A,7),g=sr[I-2]|0,T=ar[I-2]|0,D=_r(g,T,19)^Zn(g,T,61)^La(g,T,6),k=Ir(g,T,19)^Xn(g,T,61)^Na(g,T,6),P=Hl(U,k,ar[I-7],ar[I-16]),N=jl(P,R,D,sr[I-7],sr[I-16]);sr[I]=N|0,ar[I]=P|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:l,Dl:u,Eh:f,El:d,Fh:x,Fl:C,Gh:y,Gl:_,Hh:M,Hl:z}=this;for(let I=0;I<80;I++){let p=_r(f,d,14)^_r(f,d,18)^Zn(f,d,41),A=Ir(f,d,14)^Ir(f,d,18)^Xn(f,d,41),R=f&x^~f&y,U=d&C^~d&_,g=Gl(z,A,U,ey[I],ar[I]),T=Wl(g,M,p,R,ty[I],sr[I]),D=g|0,k=_r(n,o,28)^Zn(n,o,34)^Zn(n,o,39),P=Ir(n,o,28)^Xn(n,o,34)^Xn(n,o,39),N=n&i^n&a^i&a,j=o&s^o&c^s&c;M=y|0,z=_|0,y=x|0,_=C|0,x=f|0,C=d|0,{h:f,l:d}=Ie(l|0,u|0,T|0,D|0),l=a|0,u=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let w=ql(D,P,j);n=zl(w,T,k,N),o=w|0}({h:n,l:o}=Ie(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=Ie(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=Ie(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ie(this.Dh|0,this.Dl|0,l|0,u|0),{h:f,l:d}=Ie(this.Eh|0,this.El|0,f|0,d|0),{h:x,l:C}=Ie(this.Fh|0,this.Fl|0,x|0,C|0),{h:y,l:_}=Ie(this.Gh|0,this.Gl|0,y|0,_|0),{h:M,l:z}=Ie(this.Hh|0,this.Hl|0,M|0,z|0),this.set(n,o,i,s,a,c,l,u,f,d,x,C,y,_,M,z)}roundClean(){Ue(sr,ar)}destroy(){Ue(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var ri=Ba(()=>new ei);var Zl=Ba(()=>new Ra);var Oa=BigInt(0),Fa=BigInt(1);function on(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ma(r){if(!on(r))throw new Error("Uint8Array expected")}function Te(r,t){if(typeof t!="boolean")throw new Error(r+" boolean expected, got "+t)}function Qn(r){let t=r.toString(16);return t.length&1?"0"+t:t}function Jl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Oa:BigInt("0x"+r)}var tf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ry=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function cr(r){if(Ma(r),tf)return r.toHex();let t="";for(let e=0;e<r.length;e++)t+=ry[r[e]];return t}var Oe={_0:48,_9:57,A:65,F:70,a:97,f:102};function Xl(r){if(r>=Oe._0&&r<=Oe._9)return r-Oe._0;if(r>=Oe.A&&r<=Oe.F)return r-(Oe.A-10);if(r>=Oe.a&&r<=Oe.f)return r-(Oe.a-10)}function Jn(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(tf)return Uint8Array.fromHex(r);let t=r.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let o=0,i=0;o<e;o++,i+=2){let s=Xl(r.charCodeAt(i)),a=Xl(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}function Me(r){return Jl(cr(r))}function Tr(r){return Ma(r),Jl(cr(Uint8Array.from(r).reverse()))}function kr(r,t){return Jn(r.toString(16).padStart(t*2,"0"))}function sn(r,t){return kr(r,t).reverse()}function ct(r,t,e){let n;if(typeof t=="string")try{n=Jn(t)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(on(t))n=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof e=="number"&&o!==e)throw new Error(r+" of length "+e+" expected, got "+o);return n}function ur(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ma(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let i=r[n];e.set(i,o),o+=i.length}return e}var Da=r=>typeof r=="bigint"&&Oa<=r;function ni(r,t,e){return Da(r)&&Da(t)&&Da(e)&&t<=r&&r<e}function Yt(r,t,e,n){if(!ni(t,e,n))throw new Error("expected valid "+r+": "+e+" <= n < "+n+", got "+t)}function ef(r){let t;for(t=0;r>Oa;r>>=Fa,t+=1);return t}var Cr=r=>(Fa<<BigInt(r))-Fa,Ua=r=>new Uint8Array(r),Ql=r=>Uint8Array.from(r);function rf(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=Ua(r),o=Ua(r),i=0,s=()=>{n.fill(1),o.fill(0),i=0},a=(...f)=>e(o,n,...f),c=(f=Ua(0))=>{o=a(Ql([0]),f),n=a(),f.length!==0&&(o=a(Ql([1]),f),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let f=0,d=[];for(;f<t;){n=a();let x=n.slice();d.push(x),f+=n.length}return ur(...d)};return(f,d)=>{s(),c(f);let x;for(;!(x=d(l()));)c();return s(),x}}var ny={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||on(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Ke(r,t,e={}){let n=(o,i,s)=>{let a=ny[i];if(typeof a!="function")throw new Error("invalid validator function");let c=r[o];if(!(s&&c===void 0)&&!a(c,r))throw new Error("param "+String(o)+" is invalid. Expected "+i+", got "+c)};for(let[o,i]of Object.entries(t))n(o,i,!1);for(let[o,i]of Object.entries(e))n(o,i,!0);return r}function an(r){let t=new WeakMap;return(e,...n)=>{let o=t.get(e);if(o!==void 0)return o;let i=r(e,...n);return t.set(e,i),i}}var Ot=BigInt(0),bt=BigInt(1),Pr=BigInt(2),oy=BigInt(3),of=BigInt(4),sf=BigInt(5),af=BigInt(8);function at(r,t){let e=r%t;return e>=Ot?e:t+e}function ut(r,t,e){let n=r;for(;t-- >Ot;)n*=n,n%=e;return n}function oi(r,t){if(r===Ot)throw new Error("invert: expected non-zero number");if(t<=Ot)throw new Error("invert: expected positive modulus, got "+t);let e=at(r,t),n=t,o=Ot,i=bt,s=bt,a=Ot;for(;e!==Ot;){let l=n/e,u=n%e,f=o-s*l,d=i-a*l;n=e,e=u,o=s,i=a,s=f,a=d}if(n!==bt)throw new Error("invert: does not exist");return at(o,t)}function cf(r,t){let e=(r.ORDER+bt)/of,n=r.pow(t,e);if(!r.eql(r.sqr(n),t))throw new Error("Cannot find square root");return n}function iy(r,t){let e=(r.ORDER-sf)/af,n=r.mul(t,Pr),o=r.pow(n,e),i=r.mul(t,o),s=r.mul(r.mul(i,Pr),o),a=r.mul(i,r.sub(s,r.ONE));if(!r.eql(r.sqr(a),t))throw new Error("Cannot find square root");return a}function sy(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let t=r-bt,e=0;for(;t%Pr===Ot;)t/=Pr,e++;let n=Pr,o=$e(r);for(;nf(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(e===1)return cf;let i=o.pow(n,t),s=(t+bt)/Pr;return function(c,l){if(c.is0(l))return l;if(nf(c,l)!==1)throw new Error("Cannot find square root");let u=e,f=c.mul(c.ONE,i),d=c.pow(l,t),x=c.pow(l,s);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let C=1,y=c.sqr(d);for(;!c.eql(y,c.ONE);)if(C++,y=c.sqr(y),C===u)throw new Error("Cannot find square root");let _=bt<<BigInt(u-C-1),M=c.pow(f,_);u=C,f=c.sqr(M),d=c.mul(d,f),x=c.mul(x,M)}return x}}function ay(r){return r%of===oy?cf:r%af===sf?iy:sy(r)}var uf=(r,t)=>(at(r,t)&bt)===bt,cy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ka(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=cy.reduce((n,o)=>(n[o]="function",n),t);return Ke(r,e)}function uy(r,t,e){if(e<Ot)throw new Error("invalid exponent, negatives unsupported");if(e===Ot)return r.ONE;if(e===bt)return t;let n=r.ONE,o=t;for(;e>Ot;)e&bt&&(n=r.mul(n,o)),o=r.sqr(o),e>>=bt;return n}function cn(r,t,e=!1){let n=new Array(t.length).fill(e?r.ZERO:void 0),o=t.reduce((s,a,c)=>r.is0(a)?s:(n[c]=s,r.mul(s,a)),r.ONE),i=r.inv(o);return t.reduceRight((s,a,c)=>r.is0(a)?s:(n[c]=r.mul(s,n[c]),r.mul(s,a)),i),n}function nf(r,t){let e=(r.ORDER-bt)/Pr,n=r.pow(t,e),o=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),s=r.eql(n,r.neg(r.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function $a(r,t){t!==void 0&&Xo(t);let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function $e(r,t,e=!1,n={}){if(r<=Ot)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:i}=$a(r,t);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let s,a=Object.freeze({ORDER:r,isLE:e,BITS:o,BYTES:i,MASK:Cr(o),ZERO:Ot,ONE:bt,create:c=>at(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ot<=c&&c<r},is0:c=>c===Ot,isOdd:c=>(c&bt)===bt,neg:c=>at(-c,r),eql:(c,l)=>c===l,sqr:c=>at(c*c,r),add:(c,l)=>at(c+l,r),sub:(c,l)=>at(c-l,r),mul:(c,l)=>at(c*l,r),pow:(c,l)=>uy(a,c,l),div:(c,l)=>at(c*oi(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>oi(c,r),sqrt:n.sqrt||(c=>(s||(s=ay(r)),s(a,c))),toBytes:c=>e?sn(c,i):kr(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return e?Tr(c):Me(c)},invertBatch:c=>cn(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function lf(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function Va(r){let t=lf(r);return t+Math.ceil(t/2)}function ff(r,t,e=!1){let n=r.length,o=lf(t),i=Va(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=e?Tr(r):Me(r),a=at(s,t-bt)+bt;return e?sn(a,o):kr(a,o)}var hf=BigInt(0),Ga=BigInt(1);function qa(r,t){let e=t.negate();return r?e:t}function pf(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function za(r,t){pf(r,t);let e=Math.ceil(t/r)+1,n=2**(r-1),o=2**r,i=Cr(r),s=BigInt(r);return{windows:e,windowSize:n,mask:i,maxNumber:o,shiftBy:s}}function df(r,t,e){let{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=e,a=Number(r&o),c=r>>s;a>n&&(a-=i,c+=Ga);let l=t*n,u=l+Math.abs(a)-1,f=a===0,d=a<0,x=t%2!==0;return{nextN:c,offset:u,isZero:f,isNeg:d,isNegF:x,offsetF:l}}function ly(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function fy(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}var Ha=new WeakMap,mf=new WeakMap;function ja(r){return mf.get(r)||1}function ii(r,t){return{constTimeNegate:qa,hasPrecomputes(e){return ja(e)!==1},unsafeLadder(e,n,o=r.ZERO){let i=e;for(;n>hf;)n&Ga&&(o=o.add(i)),i=i.double(),n>>=Ga;return o},precomputeWindow(e,n){let{windows:o,windowSize:i}=za(n,t),s=[],a=e,c=a;for(let l=0;l<o;l++){c=a,s.push(c);for(let u=1;u<i;u++)c=c.add(a),s.push(c);a=c.double()}return s},wNAF(e,n,o){let i=r.ZERO,s=r.BASE,a=za(e,t);for(let c=0;c<a.windows;c++){let{nextN:l,offset:u,isZero:f,isNeg:d,isNegF:x,offsetF:C}=df(o,c,a);o=l,f?s=s.add(qa(x,n[C])):i=i.add(qa(d,n[u]))}return{p:i,f:s}},wNAFUnsafe(e,n,o,i=r.ZERO){let s=za(e,t);for(let a=0;a<s.windows&&o!==hf;a++){let{nextN:c,offset:l,isZero:u,isNeg:f}=df(o,a,s);if(o=c,!u){let d=n[l];i=i.add(f?d.negate():d)}}return i},getPrecomputes(e,n,o){let i=Ha.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&Ha.set(n,o(i))),i},wNAFCached(e,n,o){let i=ja(e);return this.wNAF(i,this.getPrecomputes(i,e,o),n)},wNAFCachedUnsafe(e,n,o,i){let s=ja(e);return s===1?this.unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,o),n,i)},setWindowSize(e,n){pf(n,t),mf.set(e,n),Ha.delete(e)}}}function si(r,t,e,n){ly(e,r),fy(n,t);let o=e.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");let s=r.ZERO,a=ef(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Cr(c),u=new Array(Number(l)+1).fill(s),f=Math.floor((t.BITS-1)/c)*c,d=s;for(let x=f;x>=0;x-=c){u.fill(s);for(let y=0;y<i;y++){let _=n[y],M=Number(_>>BigInt(x)&l);u[M]=u[M].add(e[y])}let C=s;for(let y=u.length-1,_=s;y>0;y--)_=_.add(u[y]),C=C.add(_);if(d=d.add(C),x!==0)for(let y=0;y<c;y++)d=d.double()}return d}function to(r){return Ka(r.Fp),Ke(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$a(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var ke=BigInt(0),Mt=BigInt(1),yf=BigInt(2),hy=BigInt(8),dy={zip215:!0};function py(r){let t=to(r);return Ke(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function gf(r){let t=py(r),{Fp:e,n,prehash:o,hash:i,randomBytes:s,nByteLength:a,h:c}=t,l=yf<<BigInt(a*8)-Mt,u=e.create,f=$e(t.n,t.nBitLength);function d(S,m){let v=e.sqr(S),B=e.sqr(m),$=e.add(e.mul(t.a,v),B),H=e.add(e.ONE,e.mul(t.d,e.mul(v,B)));return e.eql($,H)}if(!d(t.Gx,t.Gy))throw new Error("bad curve params: generator point");let x=t.uvRatio||((S,m)=>{try{return{isValid:!0,value:e.sqrt(S*e.inv(m))}}catch{return{isValid:!1,value:ke}}}),C=t.adjustScalarBytes||(S=>S),y=t.domain||((S,m,v)=>{if(Te("phflag",v),m.length||v)throw new Error("Contexts/pre-hash are not supported");return S});function _(S,m,v=!1){let B=v?Mt:ke;Yt("coordinate "+S,m,B,l)}function M(S){if(!(S instanceof p))throw new Error("ExtendedPoint expected")}let z=an((S,m)=>{let{ex:v,ey:B,ez:$}=S,H=S.is0();m==null&&(m=H?hy:e.inv($));let Y=u(v*m),X=u(B*m),tt=u($*m);if(H)return{x:ke,y:Mt};if(tt!==Mt)throw new Error("invZ was invalid");return{x:Y,y:X}}),I=an(S=>{let{a:m,d:v}=t;if(S.is0())throw new Error("bad point: ZERO");let{ex:B,ey:$,ez:H,et:Y}=S,X=u(B*B),tt=u($*$),it=u(H*H),yt=u(it*it),pt=u(X*m),St=u(it*u(pt+tt)),$t=u(yt+u(v*u(X*tt)));if(St!==$t)throw new Error("bad point: equation left != right (1)");let xt=u(B*$),kt=u(H*Y);if(xt!==kt)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(m,v,B,$){_("x",m),_("y",v),_("z",B,!0),_("t",$),this.ex=m,this.ey=v,this.ez=B,this.et=$,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof p)throw new Error("extended point not allowed");let{x:v,y:B}=m||{};return _("x",v),_("y",B),new p(v,B,Mt,u(v*B))}static normalizeZ(m){let v=cn(e,m.map(B=>B.ez));return m.map((B,$)=>B.toAffine(v[$])).map(p.fromAffine)}static msm(m,v){return si(p,f,m,v)}_setWindowSize(m){U.setWindowSize(this,m)}assertValidity(){I(this)}equals(m){M(m);let{ex:v,ey:B,ez:$}=this,{ex:H,ey:Y,ez:X}=m,tt=u(v*X),it=u(H*$),yt=u(B*X),pt=u(Y*$);return tt===it&&yt===pt}is0(){return this.equals(p.ZERO)}negate(){return new p(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:m}=t,{ex:v,ey:B,ez:$}=this,H=u(v*v),Y=u(B*B),X=u(yf*u($*$)),tt=u(m*H),it=v+B,yt=u(u(it*it)-H-Y),pt=tt+Y,St=pt-X,$t=tt-Y,xt=u(yt*St),kt=u(pt*$t),jt=u(yt*$t),ie=u(St*pt);return new p(xt,kt,ie,jt)}add(m){M(m);let{a:v,d:B}=t,{ex:$,ey:H,ez:Y,et:X}=this,{ex:tt,ey:it,ez:yt,et:pt}=m,St=u($*tt),$t=u(H*it),xt=u(X*B*pt),kt=u(Y*yt),jt=u(($+H)*(tt+it)-St-$t),ie=kt-xt,Ln=kt+xt,Xu=u($t-v*St),Vp=u(jt*ie),qp=u(Ln*Xu),zp=u(jt*Xu),Hp=u(ie*Ln);return new p(Vp,qp,Hp,zp)}subtract(m){return this.add(m.negate())}wNAF(m){return U.wNAFCached(this,m,p.normalizeZ)}multiply(m){let v=m;Yt("scalar",v,Mt,n);let{p:B,f:$}=this.wNAF(v);return p.normalizeZ([B,$])[0]}multiplyUnsafe(m,v=p.ZERO){let B=m;return Yt("scalar",B,ke,n),B===ke?R:this.is0()||B===Mt?this:U.wNAFCachedUnsafe(this,B,p.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return U.unsafeLadder(this,n).is0()}toAffine(m){return z(this,m)}clearCofactor(){let{h:m}=t;return m===Mt?this:this.multiplyUnsafe(m)}static fromHex(m,v=!1){let{d:B,a:$}=t,H=e.BYTES;m=ct("pointHex",m,H),Te("zip215",v);let Y=m.slice(),X=m[H-1];Y[H-1]=X&-129;let tt=Tr(Y),it=v?l:e.ORDER;Yt("pointHex.y",tt,ke,it);let yt=u(tt*tt),pt=u(yt-Mt),St=u(B*yt-$),{isValid:$t,value:xt}=x(pt,St);if(!$t)throw new Error("Point.fromHex: invalid y coordinate");let kt=(xt&Mt)===Mt,jt=(X&128)!==0;if(!v&&xt===ke&&jt)throw new Error("Point.fromHex: x=0 and x_0=1");return jt!==kt&&(xt=u(-xt)),p.fromAffine({x:xt,y:tt})}static fromPrivateKey(m){let{scalar:v}=D(m);return A.multiply(v)}toRawBytes(){let{x:m,y:v}=this.toAffine(),B=sn(v,e.BYTES);return B[B.length-1]|=m&Mt?128:0,B}toHex(){return cr(this.toRawBytes())}}p.BASE=new p(t.Gx,t.Gy,Mt,u(t.Gx*t.Gy)),p.ZERO=new p(ke,Mt,Mt,ke);let{BASE:A,ZERO:R}=p,U=ii(p,a*8);function g(S){return at(S,n)}function T(S){return g(Tr(S))}function D(S){let m=e.BYTES;S=ct("private key",S,m);let v=ct("hashed private key",i(S),2*m),B=C(v.slice(0,m)),$=v.slice(m,2*m),H=T(B);return{head:B,prefix:$,scalar:H}}function k(S){let{head:m,prefix:v,scalar:B}=D(S),$=A.multiply(B),H=$.toRawBytes();return{head:m,prefix:v,scalar:B,point:$,pointBytes:H}}function P(S){return k(S).pointBytes}function N(S=Uint8Array.of(),...m){let v=ur(...m);return T(i(y(v,ct("context",S),!!o)))}function j(S,m,v={}){S=ct("message",S),o&&(S=o(S));let{prefix:B,scalar:$,pointBytes:H}=k(m),Y=N(v.context,B,S),X=A.multiply(Y).toRawBytes(),tt=N(v.context,X,H,S),it=g(Y+tt*$);Yt("signature.s",it,ke,n);let yt=ur(X,sn(it,e.BYTES));return ct("result",yt,e.BYTES*2)}let w=dy;function b(S,m,v,B=w){let{context:$,zip215:H}=B,Y=e.BYTES;S=ct("signature",S,2*Y),m=ct("message",m),v=ct("publicKey",v,Y),H!==void 0&&Te("zip215",H),o&&(m=o(m));let X=Tr(S.slice(Y,2*Y)),tt,it,yt;try{tt=p.fromHex(v,H),it=p.fromHex(S.slice(0,Y),H),yt=A.multiplyUnsafe(X)}catch{return!1}if(!H&&tt.isSmallOrder())return!1;let pt=N($,it.toRawBytes(),tt.toRawBytes(),m);return it.add(tt.multiplyUnsafe(pt)).subtract(yt).clearCofactor().equals(p.ZERO)}return A._setWindowSize(8),{CURVE:t,getPublicKey:P,sign:j,verify:b,ExtendedPoint:p,utils:{getExtendedPublicKey:k,randomPrivateKey:()=>s(e.BYTES),precompute(S=8,m=p.BASE){return m._setWindowSize(S),m.multiply(BigInt(3)),m}}}}var Wa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),wf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),vE=BigInt(0),my=BigInt(1),xf=BigInt(2),SE=BigInt(3),yy=BigInt(5),gy=BigInt(8);function wy(r){let t=BigInt(10),e=BigInt(20),n=BigInt(40),o=BigInt(80),i=Wa,a=r*r%i*r%i,c=ut(a,xf,i)*a%i,l=ut(c,my,i)*r%i,u=ut(l,yy,i)*l%i,f=ut(u,t,i)*u%i,d=ut(f,e,i)*f%i,x=ut(d,n,i)*d%i,C=ut(x,o,i)*x%i,y=ut(C,o,i)*x%i,_=ut(y,t,i)*u%i;return{pow_p_5_8:ut(_,xf,i)*r%i,b2:a}}function xy(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function by(r,t){let e=Wa,n=at(t*t*t,e),o=at(n*n*t,e),i=wy(r*o).pow_p_5_8,s=at(r*n*i,e),a=at(t*s*s,e),c=s,l=at(s*wf,e),u=a===r,f=a===at(-r,e),d=a===at(-r*wf,e);return u&&(s=c),(f||d)&&(s=l),uf(s,e)&&(s=at(-s,e)),{isValid:u||f,value:s}}var bf=$e(Wa,void 0,!0),Ey={a:bf.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:bf,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:gy,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Zl,randomBytes:Jo,adjustScalarBytes:xy,uvRatio:by},Ef=gf(Ey);var ai=32;function vf(r,t,e){return Ef.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}var ci=class{type="Ed25519";raw;constructor(t){this.raw=Ya(t,ai)}toMultihash(){return Nt.digest(en(this))}toCID(){return K.createV1(114,this.toMultihash())}toString(){return ot.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Q(this.raw,t.raw)}verify(t,e){return vf(this.raw,e,t)}};function Za(r){return r=Ya(r,ai),new ci(r)}function Ya(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new ht(`Key must be a Uint8Array of length ${t}, got ${r.length}`);return r}var mt;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(mt||(mt={}));var Xa;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Xa||(Xa={}));(function(r){r.codec=()=>Hn(Xa)})(mt||(mt={}));var Ce;(function(r){let t;r.codec=()=>(t==null&&(t=Jr((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),mt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let i={},s=n==null?e.len:e.pos+n;for(;e.pos<s;){let a=e.uint32();switch(a>>>3){case 1:{i.Type=mt.codec().decode(e);break}case 2:{i.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return i})),t),r.encode=e=>Xr(e,r.codec()),r.decode=(e,n)=>jr(e,r.codec(),n)})(Ce||(Ce={}));var Qa;(function(r){let t;r.codec=()=>(t==null&&(t=Jr((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),mt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let i={},s=n==null?e.len:e.pos+n;for(;e.pos<s;){let a=e.uint32();switch(a>>>3){case 1:{i.Type=mt.codec().decode(e);break}case 2:{i.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return i})),t),r.encode=e=>Xr(e,r.codec()),r.decode=(e,n)=>jr(e,r.codec(),n)})(Qa||(Qa={}));var eo=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},ui=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var _f={get(r=globalThis){let t=r.crypto;if(t?.subtle==null)throw new ui("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var lr=_f;var no={};wt(no,{MAX_RSA_KEY_SIZE:()=>Ja,generateRSAKeyPair:()=>Cf,jwkToJWKKeyPair:()=>Pf,jwkToPkcs1:()=>Iy,jwkToPkix:()=>nc,jwkToRSAPrivateKey:()=>ac,pkcs1MessageToJwk:()=>ec,pkcs1MessageToRSAPrivateKey:()=>oc,pkcs1ToJwk:()=>_y,pkcs1ToRSAPrivateKey:()=>kf,pkixMessageToJwk:()=>rc,pkixMessageToRSAPublicKey:()=>sc,pkixToJwk:()=>Ty,pkixToRSAPublicKey:()=>ic});var li=ri;var un=class{type="RSA";jwk;_raw;_multihash;constructor(t,e){this.jwk=t,this._multihash=e}get raw(){return this._raw==null&&(this._raw=no.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return K.createV1(114,this._multihash)}toString(){return ot.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Q(this.raw,t.raw)}verify(t,e){return Tf(this.jwk,e,t)}},ro=class{type="RSA";jwk;_raw;publicKey;constructor(t,e){this.jwk=t,this.publicKey=e}get raw(){return this._raw==null&&(this._raw=no.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Q(this.raw,t.raw)}sign(t){return If(this.jwk,t)}};var Ja=8192,tc=18,Sy=1062,Ay=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function _y(r){let t=De(r);return ec(t)}function ec(r){return{n:q(r[1],"base64url"),e:q(r[2],"base64url"),d:q(r[3],"base64url"),p:q(r[4],"base64url"),q:q(r[5],"base64url"),dp:q(r[6],"base64url"),dq:q(r[7],"base64url"),qi:q(r[8],"base64url"),kty:"RSA"}}function Iy(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ht("JWK was missing components");return or([zt(Uint8Array.from([0])),zt(V(r.n,"base64url")),zt(V(r.e,"base64url")),zt(V(r.d,"base64url")),zt(V(r.p,"base64url")),zt(V(r.q,"base64url")),zt(V(r.dp,"base64url")),zt(V(r.dq,"base64url")),zt(V(r.qi,"base64url"))]).subarray()}function Ty(r){let t=De(r,{offset:0});return rc(t)}function rc(r){let t=De(r[1],{offset:0});return{kty:"RSA",n:q(t[0],"base64url"),e:q(t[1],"base64url")}}function nc(r){if(r.n==null||r.e==null)throw new ht("JWK was missing components");return or([Ay,Zo(or([zt(V(r.n,"base64url")),zt(V(r.e,"base64url"))]))]).subarray()}function kf(r){let t=De(r);return oc(t)}function oc(r){let t=ec(r);return ac(t)}function ic(r,t){if(r.byteLength>=Sy)throw new Or("Key size is too large");let e=De(r,{offset:0});return sc(e,r,t)}function sc(r,t,e){let n=rc(r);if(e==null){let o=li(Ce.encode({Type:mt.RSA,Data:t}));e=le(tc,o)}return new un(n,e)}function ac(r){if(Lf(r)>Ja)throw new ht("Key size is too large");let t=Pf(r),e=li(Ce.encode({Type:mt.RSA,Data:nc(t.publicKey)})),n=le(tc,e);return new ro(t.privateKey,new un(t.publicKey,n))}async function Cf(r){if(r>Ja)throw new ht("Key size is too large");let t=await Bf(r),e=li(Ce.encode({Type:mt.RSA,Data:nc(t.publicKey)})),n=le(tc,e);return new ro(t.privateKey,new un(t.publicKey,n))}function Pf(r){if(r==null)throw new ht("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function Bf(r){let t=await lr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await ky(t);return{privateKey:e[0],publicKey:e[1]}}async function If(r,t){let e=await lr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await lr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function Tf(r,t,e){let n=await lr.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return lr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function ky(r){if(r.privateKey==null||r.publicKey==null)throw new ht("Private and public key are required");return Promise.all([lr.get().subtle.exportKey("jwk",r.privateKey),lr.get().subtle.exportKey("jwk",r.publicKey)])}function Lf(r){if(r.kty!=="RSA")throw new ht("invalid key type");if(r.n==null)throw new ht("invalid key modulus");return V(r.n,"base64url").length*8}var fi=class extends rn{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ul(t);let n=Wn(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?t.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),Ue(i)}update(t){return nn(this),this.iHash.update(t),this}digestInto(t){nn(this),Ar(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},cc=(r,t,e)=>new fi(r,t).update(e).digest();cc.create=(r,t)=>new fi(r,t);function Nf(r){r.lowS!==void 0&&Te("lowS",r.lowS),r.prehash!==void 0&&Te("prehash",r.prehash)}function Cy(r){let t=to(r);Ke(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:e,Fp:n,a:o}=t;if(e){if(!n.eql(o,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}var fc=class extends Error{constructor(t=""){super(t)}},Ve={Err:fc,_tlv:{encode:(r,t)=>{let{Err:e}=Ve;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");let n=t.length/2,o=Qn(n);if(o.length/2&128)throw new e("tlv.encode: long form length too big");let i=n>127?Qn(o.length/2|128):"";return Qn(r)+i+o+t},decode(r,t){let{Err:e}=Ve,n=0;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[n++]!==r)throw new e("tlv.decode: wrong tlv");let o=t[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new e("tlv.decode(long): indefinite length not supported");if(c>4)throw new e("tlv.decode(long): byte length is too big");let l=t.subarray(n,n+c);if(l.length!==c)throw new e("tlv.decode: length bytes not complete");if(l[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(let u of l)s=s<<8|u;if(n+=c,s<128)throw new e("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+s);if(a.length!==s)throw new e("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+s)}}},_int:{encode(r){let{Err:t}=Ve;if(r<qe)throw new t("integer: negative integers are not allowed");let e=Qn(r);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(r){let{Err:t}=Ve;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Me(r)}},toSig(r){let{Err:t,_int:e,_tlv:n}=Ve,o=ct("signature",r),{v:i,l:s}=n.decode(48,o);if(s.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(a),s:e.decode(l)}},hexFromSig(r){let{_tlv:t,_int:e}=Ve,n=t.encode(2,e.encode(r.r)),o=t.encode(2,e.encode(r.s)),i=n+o;return t.encode(48,i)}};function uc(r,t){return cr(kr(r,t))}var qe=BigInt(0),Et=BigInt(1),wv=BigInt(2),lc=BigInt(3),Py=BigInt(4);function By(r){let t=Cy(r),{Fp:e}=t,n=$e(t.n,t.nBitLength),o=t.toBytes||((I,p,A)=>{let R=p.toAffine();return ur(Uint8Array.from([4]),e.toBytes(R.x),e.toBytes(R.y))}),i=t.fromBytes||(I=>{let p=I.subarray(1),A=e.fromBytes(p.subarray(0,e.BYTES)),R=e.fromBytes(p.subarray(e.BYTES,2*e.BYTES));return{x:A,y:R}});function s(I){let{a:p,b:A}=t,R=e.sqr(I),U=e.mul(R,I);return e.add(e.add(U,e.mul(I,p)),A)}function a(I,p){let A=e.sqr(p),R=s(I);return e.eql(A,R)}if(!a(t.Gx,t.Gy))throw new Error("bad curve params: generator point");let c=e.mul(e.pow(t.a,lc),Py),l=e.mul(e.sqr(t.b),BigInt(27));if(e.is0(e.add(c,l)))throw new Error("bad curve params: a or b");function u(I){return ni(I,Et,t.n)}function f(I){let{allowedPrivateKeyLengths:p,nByteLength:A,wrapPrivateKey:R,n:U}=t;if(p&&typeof I!="bigint"){if(on(I)&&(I=cr(I)),typeof I!="string"||!p.includes(I.length))throw new Error("invalid private key");I=I.padStart(A*2,"0")}let g;try{g=typeof I=="bigint"?I:Me(ct("private key",I,A))}catch{throw new Error("invalid private key, expected hex or "+A+" bytes, got "+typeof I)}return R&&(g=at(g,U)),Yt("private key",g,Et,U),g}function d(I){if(!(I instanceof y))throw new Error("ProjectivePoint expected")}let x=an((I,p)=>{let{px:A,py:R,pz:U}=I;if(e.eql(U,e.ONE))return{x:A,y:R};let g=I.is0();p==null&&(p=g?e.ONE:e.inv(U));let T=e.mul(A,p),D=e.mul(R,p),k=e.mul(U,p);if(g)return{x:e.ZERO,y:e.ZERO};if(!e.eql(k,e.ONE))throw new Error("invZ was invalid");return{x:T,y:D}}),C=an(I=>{if(I.is0()){if(t.allowInfinityPoint&&!e.is0(I.py))return;throw new Error("bad point: ZERO")}let{x:p,y:A}=I.toAffine();if(!e.isValid(p)||!e.isValid(A))throw new Error("bad point: x or y not FE");if(!a(p,A))throw new Error("bad point: equation left != right");if(!I.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class y{constructor(p,A,R){if(p==null||!e.isValid(p))throw new Error("x required");if(A==null||!e.isValid(A)||e.is0(A))throw new Error("y required");if(R==null||!e.isValid(R))throw new Error("z required");this.px=p,this.py=A,this.pz=R,Object.freeze(this)}static fromAffine(p){let{x:A,y:R}=p||{};if(!p||!e.isValid(A)||!e.isValid(R))throw new Error("invalid affine point");if(p instanceof y)throw new Error("projective point not allowed");let U=g=>e.eql(g,e.ZERO);return U(A)&&U(R)?y.ZERO:new y(A,R,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){let A=cn(e,p.map(R=>R.pz));return p.map((R,U)=>R.toAffine(A[U])).map(y.fromAffine)}static fromHex(p){let A=y.fromAffine(i(ct("pointHex",p)));return A.assertValidity(),A}static fromPrivateKey(p){return y.BASE.multiply(f(p))}static msm(p,A){return si(y,n,p,A)}_setWindowSize(p){z.setWindowSize(this,p)}assertValidity(){C(this)}hasEvenY(){let{y:p}=this.toAffine();if(e.isOdd)return!e.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){d(p);let{px:A,py:R,pz:U}=this,{px:g,py:T,pz:D}=p,k=e.eql(e.mul(A,D),e.mul(g,U)),P=e.eql(e.mul(R,D),e.mul(T,U));return k&&P}negate(){return new y(this.px,e.neg(this.py),this.pz)}double(){let{a:p,b:A}=t,R=e.mul(A,lc),{px:U,py:g,pz:T}=this,D=e.ZERO,k=e.ZERO,P=e.ZERO,N=e.mul(U,U),j=e.mul(g,g),w=e.mul(T,T),b=e.mul(U,g);return b=e.add(b,b),P=e.mul(U,T),P=e.add(P,P),D=e.mul(p,P),k=e.mul(R,w),k=e.add(D,k),D=e.sub(j,k),k=e.add(j,k),k=e.mul(D,k),D=e.mul(b,D),P=e.mul(R,P),w=e.mul(p,w),b=e.sub(N,w),b=e.mul(p,b),b=e.add(b,P),P=e.add(N,N),N=e.add(P,N),N=e.add(N,w),N=e.mul(N,b),k=e.add(k,N),w=e.mul(g,T),w=e.add(w,w),N=e.mul(w,b),D=e.sub(D,N),P=e.mul(w,j),P=e.add(P,P),P=e.add(P,P),new y(D,k,P)}add(p){d(p);let{px:A,py:R,pz:U}=this,{px:g,py:T,pz:D}=p,k=e.ZERO,P=e.ZERO,N=e.ZERO,j=t.a,w=e.mul(t.b,lc),b=e.mul(A,g),F=e.mul(R,T),S=e.mul(U,D),m=e.add(A,R),v=e.add(g,T);m=e.mul(m,v),v=e.add(b,F),m=e.sub(m,v),v=e.add(A,U);let B=e.add(g,D);return v=e.mul(v,B),B=e.add(b,S),v=e.sub(v,B),B=e.add(R,U),k=e.add(T,D),B=e.mul(B,k),k=e.add(F,S),B=e.sub(B,k),N=e.mul(j,v),k=e.mul(w,S),N=e.add(k,N),k=e.sub(F,N),N=e.add(F,N),P=e.mul(k,N),F=e.add(b,b),F=e.add(F,b),S=e.mul(j,S),v=e.mul(w,v),F=e.add(F,S),S=e.sub(b,S),S=e.mul(j,S),v=e.add(v,S),b=e.mul(F,v),P=e.add(P,b),b=e.mul(B,v),k=e.mul(m,k),k=e.sub(k,b),b=e.mul(m,F),N=e.mul(B,N),N=e.add(N,b),new y(k,P,N)}subtract(p){return this.add(p.negate())}is0(){return this.equals(y.ZERO)}wNAF(p){return z.wNAFCached(this,p,y.normalizeZ)}multiplyUnsafe(p){let{endo:A,n:R}=t;Yt("scalar",p,qe,R);let U=y.ZERO;if(p===qe)return U;if(this.is0()||p===Et)return this;if(!A||z.hasPrecomputes(this))return z.wNAFCachedUnsafe(this,p,y.normalizeZ);let{k1neg:g,k1:T,k2neg:D,k2:k}=A.splitScalar(p),P=U,N=U,j=this;for(;T>qe||k>qe;)T&Et&&(P=P.add(j)),k&Et&&(N=N.add(j)),j=j.double(),T>>=Et,k>>=Et;return g&&(P=P.negate()),D&&(N=N.negate()),N=new y(e.mul(N.px,A.beta),N.py,N.pz),P.add(N)}multiply(p){let{endo:A,n:R}=t;Yt("scalar",p,Et,R);let U,g;if(A){let{k1neg:T,k1:D,k2neg:k,k2:P}=A.splitScalar(p),{p:N,f:j}=this.wNAF(D),{p:w,f:b}=this.wNAF(P);N=z.constTimeNegate(T,N),w=z.constTimeNegate(k,w),w=new y(e.mul(w.px,A.beta),w.py,w.pz),U=N.add(w),g=j.add(b)}else{let{p:T,f:D}=this.wNAF(p);U=T,g=D}return y.normalizeZ([U,g])[0]}multiplyAndAddUnsafe(p,A,R){let U=y.BASE,g=(D,k)=>k===qe||k===Et||!D.equals(U)?D.multiplyUnsafe(k):D.multiply(k),T=g(this,A).add(g(p,R));return T.is0()?void 0:T}toAffine(p){return x(this,p)}isTorsionFree(){let{h:p,isTorsionFree:A}=t;if(p===Et)return!0;if(A)return A(y,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:p,clearCofactor:A}=t;return p===Et?this:A?A(y,this):this.multiplyUnsafe(t.h)}toRawBytes(p=!0){return Te("isCompressed",p),this.assertValidity(),o(y,this,p)}toHex(p=!0){return Te("isCompressed",p),cr(this.toRawBytes(p))}}y.BASE=new y(t.Gx,t.Gy,e.ONE),y.ZERO=new y(e.ZERO,e.ONE,e.ZERO);let{endo:_,nBitLength:M}=t,z=ii(y,_?Math.ceil(M/2):M);return{CURVE:t,ProjectivePoint:y,normPrivateKeyToScalar:f,weierstrassEquation:s,isWithinCurveOrder:u}}function Ly(r){let t=to(r);return Ke(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Rf(r){let t=Ly(r),{Fp:e,n,nByteLength:o,nBitLength:i}=t,s=e.BYTES+1,a=2*e.BYTES+1;function c(w){return at(w,n)}function l(w){return oi(w,n)}let{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:d,isWithinCurveOrder:x}=By({...t,toBytes(w,b,F){let S=b.toAffine(),m=e.toBytes(S.x),v=ur;return Te("isCompressed",F),F?v(Uint8Array.from([b.hasEvenY()?2:3]),m):v(Uint8Array.from([4]),m,e.toBytes(S.y))},fromBytes(w){let b=w.length,F=w[0],S=w.subarray(1);if(b===s&&(F===2||F===3)){let m=Me(S);if(!ni(m,Et,e.ORDER))throw new Error("Point is not on curve");let v=d(m),B;try{B=e.sqrt(v)}catch(Y){let X=Y instanceof Error?": "+Y.message:"";throw new Error("Point is not on curve"+X)}let $=(B&Et)===Et;return(F&1)===1!==$&&(B=e.neg(B)),{x:m,y:B}}else if(b===a&&F===4){let m=e.fromBytes(S.subarray(0,e.BYTES)),v=e.fromBytes(S.subarray(e.BYTES,2*e.BYTES));return{x:m,y:v}}else{let m=s,v=a;throw new Error("invalid Point, expected length of "+m+", or uncompressed "+v+", got "+b)}}});function C(w){let b=n>>Et;return w>b}function y(w){return C(w)?c(-w):w}let _=(w,b,F)=>Me(w.slice(b,F));class M{constructor(b,F,S){Yt("r",b,Et,n),Yt("s",F,Et,n),this.r=b,this.s=F,S!=null&&(this.recovery=S),Object.freeze(this)}static fromCompact(b){let F=o;return b=ct("compactSignature",b,F*2),new M(_(b,0,F),_(b,F,2*F))}static fromDER(b){let{r:F,s:S}=Ve.toSig(ct("DER",b));return new M(F,S)}assertValidity(){}addRecoveryBit(b){return new M(this.r,this.s,b)}recoverPublicKey(b){let{r:F,s:S,recovery:m}=this,v=U(ct("msgHash",b));if(m==null||![0,1,2,3].includes(m))throw new Error("recovery id invalid");let B=m===2||m===3?F+t.n:F;if(B>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let $=(m&1)===0?"02":"03",H=u.fromHex($+uc(B,e.BYTES)),Y=l(B),X=c(-v*Y),tt=c(S*Y),it=u.BASE.multiplyAndAddUnsafe(H,X,tt);if(!it)throw new Error("point at infinify");return it.assertValidity(),it}hasHighS(){return C(this.s)}normalizeS(){return this.hasHighS()?new M(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Jn(this.toDERHex())}toDERHex(){return Ve.hexFromSig(this)}toCompactRawBytes(){return Jn(this.toCompactHex())}toCompactHex(){let b=o;return uc(this.r,b)+uc(this.s,b)}}let z={isValidPrivateKey(w){try{return f(w),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{let w=Va(t.n);return ff(t.randomBytes(w),t.n)},precompute(w=8,b=u.BASE){return b._setWindowSize(w),b.multiply(BigInt(3)),b}};function I(w,b=!0){return u.fromPrivateKey(w).toRawBytes(b)}function p(w){if(typeof w=="bigint")return!1;if(w instanceof u)return!0;let F=ct("key",w).length,S=e.BYTES,m=S+1,v=2*S+1;if(!(t.allowedPrivateKeyLengths||o===m))return F===m||F===v}function A(w,b,F=!0){if(p(w)===!0)throw new Error("first arg must be private key");if(p(b)===!1)throw new Error("second arg must be public key");return u.fromHex(b).multiply(f(w)).toRawBytes(F)}let R=t.bits2int||function(w){if(w.length>8192)throw new Error("input is too large");let b=Me(w),F=w.length*8-i;return F>0?b>>BigInt(F):b},U=t.bits2int_modN||function(w){return c(R(w))},g=Cr(i);function T(w){return Yt("num < 2^"+i,w,qe,g),kr(w,o)}function D(w,b,F=k){if(["recovered","canonical"].some(pt=>pt in F))throw new Error("sign() legacy options not supported");let{hash:S,randomBytes:m}=t,{lowS:v,prehash:B,extraEntropy:$}=F;v==null&&(v=!0),w=ct("msgHash",w),Nf(F),B&&(w=ct("prehashed msgHash",S(w)));let H=U(w),Y=f(b),X=[T(Y),T(H)];if($!=null&&$!==!1){let pt=$===!0?m(e.BYTES):$;X.push(ct("extraEntropy",pt))}let tt=ur(...X),it=H;function yt(pt){let St=R(pt);if(!x(St))return;let $t=l(St),xt=u.BASE.multiply(St).toAffine(),kt=c(xt.x);if(kt===qe)return;let jt=c($t*c(it+kt*Y));if(jt===qe)return;let ie=(xt.x===kt?0:2)|Number(xt.y&Et),Ln=jt;return v&&C(jt)&&(Ln=y(jt),ie^=1),new M(kt,Ln,ie)}return{seed:tt,k2sig:yt}}let k={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function N(w,b,F=k){let{seed:S,k2sig:m}=D(w,b,F),v=t;return rf(v.hash.outputLen,v.nByteLength,v.hmac)(S,m)}u.BASE._setWindowSize(8);function j(w,b,F,S=P){let m=w;b=ct("msgHash",b),F=ct("publicKey",F);let{lowS:v,prehash:B,format:$}=S;if(Nf(S),"strict"in S)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");let H=typeof m=="string"||on(m),Y=!H&&!$&&typeof m=="object"&&m!==null&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!H&&!Y)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let X,tt;try{if(Y&&(X=new M(m.r,m.s)),H){try{$!=="compact"&&(X=M.fromDER(m))}catch(ie){if(!(ie instanceof Ve.Err))throw ie}!X&&$!=="der"&&(X=M.fromCompact(m))}tt=u.fromHex(F)}catch{return!1}if(!X||v&&X.hasHighS())return!1;B&&(b=t.hash(b));let{r:it,s:yt}=X,pt=U(b),St=l(yt),$t=c(pt*St),xt=c(it*St),kt=u.BASE.multiplyAndAddUnsafe(tt,$t,xt)?.toAffine();return kt?c(kt.x)===it:!1}return{CURVE:t,getPublicKey:I,getSharedSecret:A,sign:N,verify:j,ProjectivePoint:u,Signature:M,utils:z}}function Ny(r){return{hash:r,hmac:(t,...e)=>cc(r,t,Pa(...e)),randomBytes:Jo}}function Df(r,t){let e=n=>Rf({...r,...Ny(n)});return{...e(t),create:e}}var Of=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Uf=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ry=BigInt(0),Dy=BigInt(1),hc=BigInt(2),Ff=(r,t)=>(r+t/hc)/t;function Uy(r){let t=Of,e=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%t,u=l*l*r%t,f=ut(u,e,t)*u%t,d=ut(f,e,t)*u%t,x=ut(d,hc,t)*l%t,C=ut(x,o,t)*x%t,y=ut(C,i,t)*C%t,_=ut(y,a,t)*y%t,M=ut(_,c,t)*_%t,z=ut(M,a,t)*y%t,I=ut(z,e,t)*u%t,p=ut(I,s,t)*C%t,A=ut(p,n,t)*l%t,R=ut(A,hc,t);if(!dc.eql(dc.sqr(R),r))throw new Error("Cannot find square root");return R}var dc=$e(Of,void 0,void 0,{sqrt:Uy}),ln=Df({a:Ry,b:BigInt(7),Fp:dc,n:Uf,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=Uf,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Dy*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=e,s=BigInt("0x100000000000000000000000000000000"),a=Ff(i*r,t),c=Ff(-n*r,t),l=at(r-a*e-c*o,t),u=at(-a*n-c*i,t),f=l>s,d=u>s;if(f&&(l=t-l),d&&(u=t-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:f,k1:l,k2neg:d,k2:u}}}},ri);function Mf(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function Kf(r,t,e){let n=nr.digest(e instanceof Uint8Array?e:e.subarray());if(Mf(n))return n.then(({digest:o})=>ln.verify(t,o,r)).catch(o=>{throw new eo(String(o))});try{return ln.verify(t,n.digest,r)}catch(o){throw new eo(String(o))}}var hi=class{type="secp256k1";raw;_key;constructor(t){this._key=Vf(t),this.raw=$f(this._key)}toMultihash(){return Nt.digest(en(this))}toCID(){return K.createV1(114,this.toMultihash())}toString(){return ot.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Q(this.raw,t.raw)}verify(t,e){return Kf(this._key,e,t)}};function pc(r){return new hi(r)}function $f(r){return ln.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Vf(r){try{return ln.ProjectivePoint.fromHex(r),r}catch(t){throw new Or(String(t))}}function qf(r,t){let{Type:e,Data:n}=Ce.decode(r),o=n??new Uint8Array;switch(e){case mt.RSA:return ic(o,t);case mt.Ed25519:return Za(o);case mt.secp256k1:return pc(o);case mt.ECDSA:return Ca(o);default:throw new Mr}}function di(r){let{Type:t,Data:e}=Ce.decode(r.digest),n=e??new Uint8Array;switch(t){case mt.Ed25519:return Za(n);case mt.secp256k1:return pc(n);case mt.ECDSA:return Ca(n);default:throw new Mr}}function en(r){return Ce.encode({Type:mt[r.type],Data:r.raw})}var zf=Symbol.for("nodejs.util.inspect.custom"),Fy=114,oo=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Lo]=!0;toString(){return this.string==null&&(this.string=ot.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return K.createV1(Fy,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return Q(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return Q(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[zf](){return`PeerId(${this.toString()})`}},pi=class extends oo{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},mi=class extends oo{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},yi=class extends oo{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Oy=2336,io=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Nt.digest(V(this.url))}[zf](){return`PeerId(${this.url})`}[Lo]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return K.createV1(Oy,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=q(t)),t.toString()===this.toString())}};var My=114,Hf=2336;function jf(r,t){let e;if(r.charAt(0)==="1"||r.charAt(0)==="Q")e=fe(ot.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return mc(K.parse(r));if(t==null)throw new ht('Please pass a multibase decoder for strings that do not start with "1" or "Q"');e=fe(t.decode(r))}return Gf(e)}function Gf(r){if($y(r))return new pi({multihash:r});if(Ky(r))try{let t=di(r);if(t.type==="Ed25519")return new mi({multihash:r,publicKey:t});if(t.type==="secp256k1")return new yi({multihash:r,publicKey:t})}catch{let e=q(r.digest);return new io(new URL(e))}throw new Qe("Supplied PeerID Multihash is invalid")}function mc(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==My&&r.code!==Hf)throw new No("Supplied PeerID CID is invalid");if(r.code===Hf){let t=q(r.multihash.digest);return new io(new URL(t))}return Gf(r.multihash)}function Ky(r){return r.code===Nt.code}function $y(r){return r.code===nr.code}var yc={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},Wf={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Yf=new globalThis.TextEncoder;function Vy(r,t){let e=yc[t],n=Wf[t];for(let o=0;o<r.length;o++)n^=BigInt(r[o]),n=BigInt.asUintN(t,n*e);return n}function qy(r,t,e){if(e.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");let n=yc[t],o=Wf[t],i=r;for(;i.length>0;){let s=Yf.encodeInto(i,e);i=i.slice(s.read);for(let a=0;a<s.written;a++)o^=BigInt(e[a]),o=BigInt.asUintN(t,o*n)}return o}function gc(r,{size:t=32,utf8Buffer:e}={}){if(!yc[t])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(e)return qy(r,t,e);r=Yf.encode(r)}return Vy(r,t)}var so={hash:r=>Number(gc(r,{size:32})),hashV:(r,t)=>zy(so.hash(r,t))};function zy(r){let t=r.toString(16);return t.length%2===1&&(t=`0${t}`),V(t,"base16")}var wc=64,de=class{fp;h;seed;constructor(t,e,n,o=2){if(o>wc)throw new TypeError("Invalid Fingerprint Size");let i=e.hashV(t,n),s=ae(o);for(let a=0;a<s.length;a++)s[a]=i[a];s.length===0&&(s[0]=7),this.fp=s,this.h=e,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(t){return t?.fp instanceof Uint8Array?Q(this.fp,t.fp):!1}};function Br(r,t){return Math.floor(Math.random()*(t-r))+r}var Lr=class{contents;constructor(t){this.contents=new Array(t).fill(null)}has(t){if(!(t instanceof de))throw new TypeError("Invalid Fingerprint");return this.contents.some(e=>t.equals(e))}add(t){if(!(t instanceof de))throw new TypeError("Invalid Fingerprint");for(let e=0;e<this.contents.length;e++)if(this.contents[e]==null)return this.contents[e]=t,!0;return!0}swap(t){if(!(t instanceof de))throw new TypeError("Invalid Fingerprint");let e=Br(0,this.contents.length-1),n=this.contents[e];return this.contents[e]=t,n}remove(t){if(!(t instanceof de))throw new TypeError("Invalid Fingerprint");let e=this.contents.findIndex(n=>t.equals(n));return e>-1?(this.contents[e]=null,!0):!1}};var Hy=500,ao=class{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(t){this.filterSize=t.filterSize,this.bucketSize=t.bucketSize??4,this.fingerprintSize=t.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=t.hash??so,this.seed=t.seed??Br(0,Math.pow(2,10))}add(t){typeof t=="string"&&(t=V(t));let e=new de(t,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(t,this.seed)%this.filterSize,o=(n^e.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new Lr(this.bucketSize)),this.buckets[o]==null&&(this.buckets[o]=new Lr(this.bucketSize)),this.buckets[n].add(e)||this.buckets[o].add(e))return this.count++,!0;let i=[n,o],s=i[Br(0,i.length-1)];this.buckets[s]==null&&(this.buckets[s]=new Lr(this.bucketSize));for(let a=0;a<Hy;a++){let c=this.buckets[s].swap(e);if(c!=null&&(s=(s^c.hash())%this.filterSize,this.buckets[s]==null&&(this.buckets[s]=new Lr(this.bucketSize)),this.buckets[s].add(c)))return this.count++,!0}return!1}has(t){typeof t=="string"&&(t=V(t));let e=new de(t,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(t,this.seed)%this.filterSize,o=this.buckets[n]?.has(e)??!1;if(o)return o;let i=(n^e.hash())%this.filterSize;return this.buckets[i]?.has(e)??!1}remove(t){typeof t=="string"&&(t=V(t));let e=new de(t,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(t,this.seed)%this.filterSize,o=this.buckets[n]?.remove(e)??!1;if(o)return this.count--,o;let i=(n^e.hash())%this.filterSize,s=this.buckets[i]?.remove(e)??!1;return s&&this.count--,s}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}},jy={1:.5,2:.84,4:.95,8:.98};function Gy(r=.001){return r>.002?2:r>1e-5?4:8}function Zf(r,t=.001){let e=Gy(t),n=jy[e],o=Math.round(r/n),i=Math.min(Math.ceil(Math.log2(1/t)+Math.log2(2*e)),wc);return{filterSize:o,bucketSize:e,fingerprintSize:i}}var gi=class{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(t){this.bucketSize=t.bucketSize??4,this.filterSize=t.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=t.fingerprintSize??2,this.scale=t.scale??2,this.hash=t.hash??so,this.seed=t.seed??Br(0,Math.pow(2,10)),this.filterSeries=[new ao({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(t){if(typeof t=="string"&&(t=V(t)),this.has(t))return!0;let e=this.filterSeries.find(n=>n.reliable);if(e==null){let n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);e=new ao({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(e)}return e.add(t)}has(t){typeof t=="string"&&(t=V(t));for(let e=0;e<this.filterSeries.length;e++)if(this.filterSeries[e].has(t))return!0;return!1}remove(t){typeof t=="string"&&(t=V(t));for(let e=0;e<this.filterSeries.length;e++)if(this.filterSeries[e].remove(t))return!0;return!1}get count(){return this.filterSeries.reduce((t,e)=>t+e.count,0)}};function xc(r,t=.001,e){return new gi({...Zf(r,t),...e??{}})}function Wy(r,t){try{if(typeof r=="string"&&r.length>0)return Yy(r);if(typeof r=="number"&&isFinite(r))return t?.long?Xy(r):Zy(r);throw new Error("Value is not a string or number.")}catch(e){let n=Qy(e)?`${e.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function Yy(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");let t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!t)return NaN;let e=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return e*315576e5;case"weeks":case"week":case"w":return e*6048e5;case"days":case"day":case"d":return e*864e5;case"hours":case"hour":case"hrs":case"hr":case"h":return e*36e5;case"minutes":case"minute":case"mins":case"min":case"m":return e*6e4;case"seconds":case"second":case"secs":case"sec":case"s":return e*1e3;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}var xi=Wy;function Zy(r){let t=Math.abs(r);return t>=864e5?`${Math.round(r/864e5)}d`:t>=36e5?`${Math.round(r/36e5)}h`:t>=6e4?`${Math.round(r/6e4)}m`:t>=1e3?`${Math.round(r/1e3)}s`:`${r}ms`}function Xy(r){let t=Math.abs(r);return t>=864e5?wi(r,t,864e5,"day"):t>=36e5?wi(r,t,36e5,"hour"):t>=6e4?wi(r,t,6e4,"minute"):t>=1e3?wi(r,t,1e3,"second"):`${r} ms`}function wi(r,t,e,n){let o=t>=e*1.5;return`${Math.round(r/e)} ${n}${o?"s":""}`}function Qy(r){return typeof r=="object"&&r!==null&&"message"in r}function bc(r){e.debug=e,e.default=e,e.coerce=c,e.disable=i,e.enable=o,e.enabled=s,e.humanize=xi,e.destroy=l,Object.keys(r).forEach(u=>{e[u]=r[u]}),e.names=[],e.skips=[],e.formatters={};function t(u){let f=0;for(let d=0;d<u.length;d++)f=(f<<5)-f+u.charCodeAt(d),f|=0;return e.colors[Math.abs(f)%e.colors.length]}e.selectColor=t;function e(u){let f,d=null,x,C;function y(..._){if(!y.enabled)return;let M=y,z=Number(new Date),I=z-(f||z);M.diff=I,M.prev=f,M.curr=z,f=z,_[0]=e.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let p=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(R,U)=>{if(R==="%%")return"%";p++;let g=e.formatters[U];if(typeof g=="function"){let T=_[p];R=g.call(M,T),_.splice(p,1),p--}return R}),e.formatArgs.call(M,_),(M.log||e.log).apply(M,_)}return y.namespace=u,y.useColors=e.useColors(),y.color=e.selectColor(u),y.extend=n,y.destroy=e.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(x!==e.namespaces&&(x=e.namespaces,C=e.enabled(u)),C),set:_=>{d=_}}),typeof e.init=="function"&&e.init(y),y}function n(u,f){let d=e(this.namespace+(typeof f>"u"?":":f)+u);return d.log=this.log,d}function o(u){e.save(u),e.namespaces=u,e.names=[],e.skips=[];let f,d=(typeof u=="string"?u:"").split(/[\s,]+/),x=d.length;for(f=0;f<x;f++)d[f]&&(u=d[f].replace(/\*/g,".*?"),u[0]==="-"?e.skips.push(new RegExp("^"+u.substr(1)+"$")):e.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...e.names.map(a),...e.skips.map(a).map(f=>"-"+f)].join(",");return e.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let f,d;for(f=0,d=e.skips.length;f<d;f++)if(e.skips[f].test(u))return!1;for(f=0,d=e.names.length;f<d;f++)if(e.names[f].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.setupFormatters(e.formatters),e.enable(e.load()),e}var bi=ig(),Jy=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function tg(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function eg(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+xi(this.diff),!this.useColors)return;let t="color: "+this.color;r.splice(1,0,t,"color: inherit");let e=0,n=0;r[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(e++,o==="%c"&&(n=e))}),r.splice(n,0,t)}var rg=console.debug??console.log??(()=>{});function ng(r){try{r?bi?.setItem("debug",r):bi?.removeItem("debug")}catch{}}function og(){let r;try{r=bi?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=globalThis.process.env.DEBUG),r}function ig(){try{return localStorage}catch{}}function sg(r){r.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}var Xf=bc({formatArgs:eg,save:ng,load:og,useColors:tg,setupFormatters:sg,colors:Jy,storage:bi,log:rg});var Ht=Xf;Ht.formatters.b=r=>r==null?"undefined":ot.baseEncode(r);Ht.formatters.t=r=>r==null?"undefined":At.baseEncode(r);Ht.formatters.m=r=>r==null?"undefined":_e.baseEncode(r);Ht.formatters.p=r=>r==null?"undefined":r.toString();Ht.formatters.c=r=>r==null?"undefined":r.toString();Ht.formatters.k=r=>r==null?"undefined":r.toString();Ht.formatters.a=r=>r==null?"undefined":r.toString();Ht.formatters.e=r=>r==null?"undefined":Qf(r.stack)??Qf(r.message)??r.toString();function ag(r){let t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=r,t.destroy=()=>!0,t.extend=()=>t,t}function Jf(){return{forComponent(r){return Zt(r)}}}function Zt(r){let t=ag(`${r}:trace`);return Ht.enabled(`${r}:trace`)&&Ht.names.map(e=>e.toString()).find(e=>e.includes(":trace"))!=null&&(t=Ht(`${r}:trace`)),Object.assign(Ht(r),{error:Ht(`${r}:error`),trace:t})}function Qf(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}var vc=Nn(eh(),1);var uo=class extends Error{constructor(t){super(t),this.name="TimeoutError"}},Sc=class extends Error{constructor(t){super(),this.name="AbortError",this.message=t}},rh=r=>globalThis.DOMException===void 0?new Sc(r):new DOMException(r),nh=r=>{let t=r.reason===void 0?rh("This operation was aborted."):r.reason;return t instanceof Error?t:rh(t)};function lo(r,t){let{milliseconds:e,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=t,s,a,l=new Promise((u,f)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(t.signal){let{signal:x}=t;x.aborted&&f(nh(x)),a=()=>{f(nh(x))},x.addEventListener("abort",a,{once:!0})}if(e===Number.POSITIVE_INFINITY){r.then(u,f);return}let d=new uo;s=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(x){f(x)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?u():o instanceof Error?f(o):(d.message=o??`Promise timed out after ${e} milliseconds`,f(d))},e),(async()=>{try{u(await r)}catch(x){f(x)}})()}).finally(()=>{l.clear(),a&&t.signal&&t.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},l}function Ac(r,t,e){let n=0,o=r.length;for(;o>0;){let i=Math.trunc(o/2),s=n+i;e(r[s],t)<=0?(n=++s,o-=i+1):o=i}return n}var fo=class{#t=[];enqueue(t,e){e={priority:0,...e};let n={priority:e.priority,id:e.id,run:t};if(this.size===0||this.#t[this.size-1].priority>=e.priority){this.#t.push(n);return}let o=Ac(this.#t,n,(i,s)=>s.priority-i.priority);this.#t.splice(o,0,n)}setPriority(t,e){let n=this.#t.findIndex(i=>i.id===t);if(n===-1)throw new ReferenceError(`No promise function with the id "${t}" exists in the queue.`);let[o]=this.#t.splice(n,1);this.enqueue(o.run,{priority:e,id:t})}dequeue(){return this.#t.shift()?.run}filter(t){return this.#t.filter(e=>e.priority===t.priority).map(e=>e.run)}get size(){return this.#t.length}};var Pe=class extends vc.default{#t;#e;#r=0;#o;#a;#u=0;#i;#l;#n;#m;#s=0;#f;#c;#y;#x=1n;timeout;constructor(t){if(super(),t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:fo,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);this.#t=t.carryoverConcurrencyCount,this.#e=t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0,this.#o=t.intervalCap,this.#a=t.interval,this.#n=new t.queueClass,this.#m=t.queueClass,this.concurrency=t.concurrency,this.timeout=t.timeout,this.#y=t.throwOnTimeout===!0,this.#c=t.autoStart===!1}get#b(){return this.#e||this.#r<this.#o}get#E(){return this.#s<this.#f}#v(){this.#s--,this.#h(),this.emit("next")}#S(){this.#w(),this.#g(),this.#l=void 0}get#A(){let t=Date.now();if(this.#i===void 0){let e=this.#u-t;if(e<0)this.#r=this.#t?this.#s:0;else return this.#l===void 0&&(this.#l=setTimeout(()=>{this.#S()},e)),!0}return!1}#h(){if(this.#n.size===0)return this.#i&&clearInterval(this.#i),this.#i=void 0,this.emit("empty"),this.#s===0&&this.emit("idle"),!1;if(!this.#c){let t=!this.#A;if(this.#b&&this.#E){let e=this.#n.dequeue();return e?(this.emit("active"),e(),t&&this.#g(),!0):!1}}return!1}#g(){this.#e||this.#i!==void 0||(this.#i=setInterval(()=>{this.#w()},this.#a),this.#u=Date.now()+this.#a)}#w(){this.#r===0&&this.#s===0&&this.#i&&(clearInterval(this.#i),this.#i=void 0),this.#r=this.#t?this.#s:0,this.#d()}#d(){for(;this.#h(););}get concurrency(){return this.#f}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this.#f=t,this.#d()}async#_(t){return new Promise((e,n)=>{t.addEventListener("abort",()=>{n(t.reason)},{once:!0})})}setPriority(t,e){this.#n.setPriority(t,e)}async add(t,e={}){return e.id??=(this.#x++).toString(),e={timeout:this.timeout,throwOnTimeout:this.#y,...e},new Promise((n,o)=>{this.#n.enqueue(async()=>{this.#s++,this.#r++;try{e.signal?.throwIfAborted();let i=t({signal:e.signal});e.timeout&&(i=lo(Promise.resolve(i),{milliseconds:e.timeout})),e.signal&&(i=Promise.race([i,this.#_(e.signal)]));let s=await i;n(s),this.emit("completed",s)}catch(i){if(i instanceof uo&&!e.throwOnTimeout){n();return}o(i),this.emit("error",i)}finally{this.#v()}},e),this.emit("add"),this.#h()})}async addAll(t,e){return Promise.all(t.map(async n=>this.add(n,e)))}start(){return this.#c?(this.#c=!1,this.#d(),this):this}pause(){this.#c=!0}clear(){this.#n=new this.#m}async onEmpty(){this.#n.size!==0&&await this.#p("empty")}async onSizeLessThan(t){this.#n.size<t||await this.#p("next",()=>this.#n.size<t)}async onIdle(){this.#s===0&&this.#n.size===0||await this.#p("idle")}async#p(t,e){return new Promise(n=>{let o=()=>{e&&!e()||(this.off(t,o),n())};this.on(t,o)})}get size(){return this.#n.size}sizeBy(t){return this.#n.filter(t).length}get pending(){return this.#s}get isPaused(){return this.#c}};function vi(r){let t=[pe.A];return r==null?t:Array.isArray(r)?r.length===0?t:r:[r]}var _c=60;function Si(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(t=>({name:t.name,type:pe[t.type]})),Answer:(r.Answer??r.answers??[]).map(t=>({name:t.name,type:pe[t.type],TTL:t.TTL??t.ttl??_c,data:t.data instanceof Uint8Array?q(t.data):t.data}))}}var lg=4;function Ic(r,t={}){let e=new Pe({concurrency:t.queryConcurrency??lg});return async(n,o={})=>{let i=new URLSearchParams;i.set("name",n),vi(o.types).forEach(a=>{i.append("type",pe[a])}),o.onProgress?.(new et("dns:query",{detail:n}));let s=await e.add(async()=>{let a=await fetch(`${r}?${i}`,{headers:{accept:"application/dns-json"},signal:o?.signal});if(a.status!==200)throw new Error(`Unexpected HTTP status: ${a.status} - ${a.statusText}`);let c=Si(await a.json());return o.onProgress?.(new et("dns:response",{detail:c})),c},{signal:o.signal});if(s==null)throw new Error("No DNS response received");return s}}function oh(){return[Ic("https://cloudflare-dns.com/dns-query"),Ic("https://dns.google/resolve")]}var ah=Nn(sh(),1);var Tc=class{lru;constructor(t){this.lru=(0,ah.default)(t)}get(t,e){let n=!0,o=[];for(let i of e){let s=this.getAnswers(t,i);if(s.length===0){n=!1;break}o.push(...s)}if(n)return Si({answers:o})}getAnswers(t,e){let n=`${t.toLowerCase()}-${e}`,o=this.lru.get(n);if(o!=null){let i=o.filter(s=>s.expires>Date.now()).map(({expires:s,value:a})=>({...a,TTL:Math.round((s-Date.now())/1e3),type:pe[a.type]}));return i.length===0&&this.lru.remove(n),i}return[]}add(t,e){let n=`${t.toLowerCase()}-${e.type}`,o=this.lru.get(n)??[];o.push({expires:Date.now()+(e.TTL??_c)*1e3,value:e}),this.lru.set(n,o)}remove(t,e){let n=`${t.toLowerCase()}-${e}`;this.lru.remove(n)}clear(){this.lru.clear()}};function ch(r){return new Tc(r)}var fg=1e3,Ai=class{resolvers;cache;constructor(t){this.resolvers={},this.cache=ch(t.cacheSize??fg),Object.entries(t.resolvers??{}).forEach(([e,n])=>{Array.isArray(n)||(n=[n]),e.endsWith(".")||(e=`${e}.`),this.resolvers[e]=n}),this.resolvers["."]==null&&(this.resolvers["."]=oh())}async query(t,e={}){let n=vi(e.types),o=e.cached!==!1?this.cache.get(t,n):void 0;if(o!=null)return e.onProgress?.(new et("dns:cache",{detail:o})),o;let i=`${t.split(".").pop()}.`,s=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(let c of s){if(e.signal?.aborted===!0)break;try{let l=await c(t,{...e,types:n});for(let u of l.Answer)this.cache.add(t,u);return l}catch(l){a.push(l),e.onProgress?.(new et("dns:error",{detail:l}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${t} ${n} failed`)}};var pe;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(pe||(pe={}));function uh(r={}){return new Ai(r)}var hg=["string","number","bigint","symbol"],dg=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function lh(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let t=typeof r;if(hg.includes(t))return t;if(t==="function")return"Function";if(Array.isArray(r))return"Array";if(pg(r))return"Buffer";let e=mg(r);return e||"Object"}function pg(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function mg(r){let t=Object.prototype.toString.call(r).slice(8,-1);if(dg.includes(t))return t}var h=class{constructor(t,e,n){this.major=t,this.majorEncoded=t<<5,this.name=e,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}};h.uint=new h(0,"uint",!0);h.negint=new h(1,"negint",!0);h.bytes=new h(2,"bytes",!0);h.string=new h(3,"string",!0);h.array=new h(4,"array",!1);h.map=new h(5,"map",!1);h.tag=new h(6,"tag",!1);h.float=new h(7,"float",!0);h.false=new h(7,"false",!0);h.true=new h(7,"true",!0);h.null=new h(7,"null",!0);h.undefined=new h(7,"undefined",!0);h.break=new h(7,"break",!0);var E=class{constructor(t,e,n){this.type=t,this.value=e,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var fn=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",yg=new TextDecoder,gg=new TextEncoder;function _i(r){return fn&&globalThis.Buffer.isBuffer(r)}function ho(r){return r instanceof Uint8Array?_i(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var ph=fn?(r,t,e)=>e-t>64?globalThis.Buffer.from(r.subarray(t,e)).toString("utf8"):hh(r,t,e):(r,t,e)=>e-t>64?yg.decode(r.subarray(t,e)):hh(r,t,e),Ii=fn?r=>r.length>64?globalThis.Buffer.from(r):fh(r):r=>r.length>64?gg.encode(r):fh(r),Be=r=>Uint8Array.from(r),hn=fn?(r,t,e)=>_i(r)?new Uint8Array(r.subarray(t,e)):r.slice(t,e):(r,t,e)=>r.slice(t,e),mh=fn?(r,t)=>(r=r.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),ho(globalThis.Buffer.concat(r,t))):(r,t)=>{let e=new Uint8Array(t),n=0;for(let o of r)n+o.length>e.length&&(o=o.subarray(0,e.length-n)),e.set(o,n),n+=o.length;return e},yh=fn?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function gh(r,t){if(_i(r)&&_i(t))return r.compare(t);for(let e=0;e<r.length;e++)if(r[e]!==t[e])return r[e]<t[e]?-1:1;return 0}function fh(r){let t=[],e=0;for(let n=0;n<r.length;n++){let o=r.charCodeAt(n);o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(o=65536+((o&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128)}return t}function hh(r,t,e){let n=[];for(;t<e;){let o=r[t],i=null,s=o>239?4:o>223?3:o>191?2:1;if(t+s<=e){let a,c,l,u;switch(s){case 1:o<128&&(i=o);break;case 2:a=r[t+1],(a&192)===128&&(u=(o&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[t+1],c=r[t+2],(a&192)===128&&(c&192)===128&&(u=(o&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[t+1],c=r[t+2],l=r[t+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(o&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),t+=s}return kc(n)}var dh=4096;function kc(r){let t=r.length;if(t<=dh)return String.fromCharCode.apply(String,r);let e="",n=0;for(;n<t;)e+=String.fromCharCode.apply(String,r.slice(n,n+=dh));return e}var wg=256,po=class{constructor(t=wg){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let e=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){let o=e.length-(this.maxCursor-this.cursor)-1;e.set(t,o)}else{if(e){let o=e.length-(this.maxCursor-this.cursor)-1;o<e.length&&(this.chunks[this.chunks.length-1]=e.subarray(0,o),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(e=yh(this.chunkSize),this.chunks.push(e),this.maxCursor+=e.length,this._initReuseChunk===null&&(this._initReuseChunk=e),e.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let e;if(this.chunks.length===1){let n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=hn(n,0,this.cursor)}else e=mh(this.chunks,this.cursor);return t&&this.reset(),e}};var O="CBOR decode error:",ze="CBOR encode error:",mo=[];mo[23]=1;mo[24]=2;mo[25]=3;mo[26]=5;mo[27]=9;function He(r,t,e){if(r.length-t<e)throw new Error(`${O} not enough data for type`)}var vt=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Xt(r,t,e){He(r,t,1);let n=r[t];if(e.strict===!0&&n<vt[0])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function Qt(r,t,e){He(r,t,2);let n=r[t]<<8|r[t+1];if(e.strict===!0&&n<vt[1])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function Jt(r,t,e){He(r,t,4);let n=r[t]*16777216+(r[t+1]<<16)+(r[t+2]<<8)+r[t+3];if(e.strict===!0&&n<vt[2])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function te(r,t,e){He(r,t,8);let n=r[t]*16777216+(r[t+1]<<16)+(r[t+2]<<8)+r[t+3],o=r[t+4]*16777216+(r[t+5]<<16)+(r[t+6]<<8)+r[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(e.strict===!0&&i<vt[3])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(e.allowBigInt===!0)return i;throw new Error(`${O} integers outside of the safe integer range are not supported`)}function wh(r,t,e,n){return new E(h.uint,Xt(r,t+1,n),2)}function xh(r,t,e,n){return new E(h.uint,Qt(r,t+1,n),3)}function bh(r,t,e,n){return new E(h.uint,Jt(r,t+1,n),5)}function Eh(r,t,e,n){return new E(h.uint,te(r,t+1,n),9)}function re(r,t){return It(r,0,t.value)}function It(r,t,e){if(e<vt[0]){let n=Number(e);r.push([t|n])}else if(e<vt[1]){let n=Number(e);r.push([t|24,n])}else if(e<vt[2]){let n=Number(e);r.push([t|25,n>>>8,n&255])}else if(e<vt[3]){let n=Number(e);r.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(e);if(n<vt[4]){let o=[t|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,r.push(o)}else throw new Error(`${O} encountered BigInt larger than allowable range`)}}re.encodedSize=function(t){return It.encodedSize(t.value)};It.encodedSize=function(t){return t<vt[0]?1:t<vt[1]?2:t<vt[2]?3:t<vt[3]?5:9};re.compareTokens=function(t,e){return t.value<e.value?-1:t.value>e.value?1:0};function vh(r,t,e,n){return new E(h.negint,-1-Xt(r,t+1,n),2)}function Sh(r,t,e,n){return new E(h.negint,-1-Qt(r,t+1,n),3)}function Ah(r,t,e,n){return new E(h.negint,-1-Jt(r,t+1,n),5)}var Cc=BigInt(-1),_h=BigInt(1);function Ih(r,t,e,n){let o=te(r,t+1,n);if(typeof o!="bigint"){let i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new E(h.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${O} integers outside of the safe integer range are not supported`);return new E(h.negint,Cc-BigInt(o),9)}function Ti(r,t){let e=t.value,n=typeof e=="bigint"?e*Cc-_h:e*-1-1;It(r,t.type.majorEncoded,n)}Ti.encodedSize=function(t){let e=t.value,n=typeof e=="bigint"?e*Cc-_h:e*-1-1;return n<vt[0]?1:n<vt[1]?2:n<vt[2]?3:n<vt[3]?5:9};Ti.compareTokens=function(t,e){return t.value<e.value?1:t.value>e.value?-1:0};function yo(r,t,e,n){He(r,t,e+n);let o=hn(r,t+e,t+e+n);return new E(h.bytes,o,e+n)}function Th(r,t,e,n){return yo(r,t,1,e)}function kh(r,t,e,n){return yo(r,t,2,Xt(r,t+1,n))}function Ch(r,t,e,n){return yo(r,t,3,Qt(r,t+1,n))}function Ph(r,t,e,n){return yo(r,t,5,Jt(r,t+1,n))}function Bh(r,t,e,n){let o=te(r,t+1,n);if(typeof o=="bigint")throw new Error(`${O} 64-bit integer bytes lengths not supported`);return yo(r,t,9,o)}function ki(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===h.string?Ii(r.value):r.value),r.encodedBytes}function dn(r,t){let e=ki(t);It(r,t.type.majorEncoded,e.length),r.push(e)}dn.encodedSize=function(t){let e=ki(t);return It.encodedSize(e.length)+e.length};dn.compareTokens=function(t,e){return bg(ki(t),ki(e))};function bg(r,t){return r.length<t.length?-1:r.length>t.length?1:gh(r,t)}function go(r,t,e,n,o){let i=e+n;He(r,t,i);let s=new E(h.string,ph(r,t+e,t+i),i);return o.retainStringBytes===!0&&(s.byteValue=hn(r,t+e,t+i)),s}function Lh(r,t,e,n){return go(r,t,1,e,n)}function Nh(r,t,e,n){return go(r,t,2,Xt(r,t+1,n),n)}function Rh(r,t,e,n){return go(r,t,3,Qt(r,t+1,n),n)}function Dh(r,t,e,n){return go(r,t,5,Jt(r,t+1,n),n)}function Uh(r,t,e,n){let o=te(r,t+1,n);if(typeof o=="bigint")throw new Error(`${O} 64-bit integer string lengths not supported`);return go(r,t,9,o,n)}var Fh=dn;function pn(r,t,e,n){return new E(h.array,n,e)}function Oh(r,t,e,n){return pn(r,t,1,e)}function Mh(r,t,e,n){return pn(r,t,2,Xt(r,t+1,n))}function Kh(r,t,e,n){return pn(r,t,3,Qt(r,t+1,n))}function $h(r,t,e,n){return pn(r,t,5,Jt(r,t+1,n))}function Vh(r,t,e,n){let o=te(r,t+1,n);if(typeof o=="bigint")throw new Error(`${O} 64-bit integer array lengths not supported`);return pn(r,t,9,o)}function qh(r,t,e,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return pn(r,t,1,1/0)}function Ci(r,t){It(r,h.array.majorEncoded,t.value)}Ci.compareTokens=re.compareTokens;Ci.encodedSize=function(t){return It.encodedSize(t.value)};function mn(r,t,e,n){return new E(h.map,n,e)}function zh(r,t,e,n){return mn(r,t,1,e)}function Hh(r,t,e,n){return mn(r,t,2,Xt(r,t+1,n))}function jh(r,t,e,n){return mn(r,t,3,Qt(r,t+1,n))}function Gh(r,t,e,n){return mn(r,t,5,Jt(r,t+1,n))}function Wh(r,t,e,n){let o=te(r,t+1,n);if(typeof o=="bigint")throw new Error(`${O} 64-bit integer map lengths not supported`);return mn(r,t,9,o)}function Yh(r,t,e,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return mn(r,t,1,1/0)}function Pi(r,t){It(r,h.map.majorEncoded,t.value)}Pi.compareTokens=re.compareTokens;Pi.encodedSize=function(t){return It.encodedSize(t.value)};function Zh(r,t,e,n){return new E(h.tag,e,1)}function Xh(r,t,e,n){return new E(h.tag,Xt(r,t+1,n),2)}function Qh(r,t,e,n){return new E(h.tag,Qt(r,t+1,n),3)}function Jh(r,t,e,n){return new E(h.tag,Jt(r,t+1,n),5)}function td(r,t,e,n){return new E(h.tag,te(r,t+1,n),9)}function Bi(r,t){It(r,h.tag.majorEncoded,t.value)}Bi.compareTokens=re.compareTokens;Bi.encodedSize=function(t){return It.encodedSize(t.value)};var Ig=20,Tg=21,kg=22,Cg=23;function ed(r,t,e,n){if(n.allowUndefined===!1)throw new Error(`${O} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new E(h.null,null,1):new E(h.undefined,void 0,1)}function rd(r,t,e,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return new E(h.break,void 0,1)}function Pc(r,t,e){if(e){if(e.allowNaN===!1&&Number.isNaN(r))throw new Error(`${O} NaN values are not supported`);if(e.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${O} Infinity values are not supported`)}return new E(h.float,r,t)}function nd(r,t,e,n){return Pc(Bc(r,t+1),3,n)}function od(r,t,e,n){return Pc(Lc(r,t+1),5,n)}function id(r,t,e,n){return Pc(ud(r,t+1),9,n)}function Li(r,t,e){let n=t.value;if(n===!1)r.push([h.float.majorEncoded|Ig]);else if(n===!0)r.push([h.float.majorEncoded|Tg]);else if(n===null)r.push([h.float.majorEncoded|kg]);else if(n===void 0)r.push([h.float.majorEncoded|Cg]);else{let o,i=!1;(!e||e.float64!==!0)&&(ad(n),o=Bc(me,1),n===o||Number.isNaN(n)?(me[0]=249,r.push(me.slice(0,3)),i=!0):(cd(n),o=Lc(me,1),n===o&&(me[0]=250,r.push(me.slice(0,5)),i=!0))),i||(Pg(n),o=ud(me,1),me[0]=251,r.push(me.slice(0,9)))}}Li.encodedSize=function(t,e){let n=t.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!e||e.float64!==!0){ad(n);let o=Bc(me,1);if(n===o||Number.isNaN(n))return 3;if(cd(n),o=Lc(me,1),n===o)return 5}return 9};var sd=new ArrayBuffer(9),ne=new DataView(sd,1),me=new Uint8Array(sd,0);function ad(r){if(r===1/0)ne.setUint16(0,31744,!1);else if(r===-1/0)ne.setUint16(0,64512,!1);else if(Number.isNaN(r))ne.setUint16(0,32256,!1);else{ne.setFloat32(0,r);let t=ne.getUint32(0),e=(t&2139095040)>>23,n=t&8388607;if(e===255)ne.setUint16(0,31744,!1);else if(e===0)ne.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let o=e-127;o<-24?ne.setUint16(0,0):o<-14?ne.setUint16(0,(t&2147483648)>>16|1<<24+o,!1):ne.setUint16(0,(t&2147483648)>>16|o+15<<10|n>>13,!1)}}}function Bc(r,t){if(r.length-t<2)throw new Error(`${O} not enough data for float16`);let e=(r[t]<<8)+r[t+1];if(e===31744)return 1/0;if(e===64512)return-1/0;if(e===32256)return NaN;let n=e>>10&31,o=e&1023,i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,e&32768?-i:i}function cd(r){ne.setFloat32(0,r,!1)}function Lc(r,t){if(r.length-t<4)throw new Error(`${O} not enough data for float32`);let e=(r.byteOffset||0)+t;return new DataView(r.buffer,e,4).getFloat32(0,!1)}function Pg(r){ne.setFloat64(0,r,!1)}function ud(r,t){if(r.length-t<8)throw new Error(`${O} not enough data for float64`);let e=(r.byteOffset||0)+t;return new DataView(r.buffer,e,8).getFloat64(0,!1)}Li.compareTokens=re.compareTokens;function J(r,t,e){throw new Error(`${O} encountered invalid minor (${e}) for major ${r[t]>>>5}`)}function Ni(r){return()=>{throw new Error(`${O} ${r}`)}}var L=[];for(let r=0;r<=23;r++)L[r]=J;L[24]=wh;L[25]=xh;L[26]=bh;L[27]=Eh;L[28]=J;L[29]=J;L[30]=J;L[31]=J;for(let r=32;r<=55;r++)L[r]=J;L[56]=vh;L[57]=Sh;L[58]=Ah;L[59]=Ih;L[60]=J;L[61]=J;L[62]=J;L[63]=J;for(let r=64;r<=87;r++)L[r]=Th;L[88]=kh;L[89]=Ch;L[90]=Ph;L[91]=Bh;L[92]=J;L[93]=J;L[94]=J;L[95]=Ni("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)L[r]=Lh;L[120]=Nh;L[121]=Rh;L[122]=Dh;L[123]=Uh;L[124]=J;L[125]=J;L[126]=J;L[127]=Ni("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)L[r]=Oh;L[152]=Mh;L[153]=Kh;L[154]=$h;L[155]=Vh;L[156]=J;L[157]=J;L[158]=J;L[159]=qh;for(let r=160;r<=183;r++)L[r]=zh;L[184]=Hh;L[185]=jh;L[186]=Gh;L[187]=Wh;L[188]=J;L[189]=J;L[190]=J;L[191]=Yh;for(let r=192;r<=215;r++)L[r]=Zh;L[216]=Xh;L[217]=Qh;L[218]=Jh;L[219]=td;L[220]=J;L[221]=J;L[222]=J;L[223]=J;for(let r=224;r<=243;r++)L[r]=Ni("simple values are not supported");L[244]=J;L[245]=J;L[246]=J;L[247]=ed;L[248]=Ni("simple values are not supported");L[249]=nd;L[250]=od;L[251]=id;L[252]=J;L[253]=J;L[254]=J;L[255]=rd;var ye=[];for(let r=0;r<24;r++)ye[r]=new E(h.uint,r,1);for(let r=-1;r>=-24;r--)ye[31-r]=new E(h.negint,r,1);ye[64]=new E(h.bytes,new Uint8Array(0),1);ye[96]=new E(h.string,"",1);ye[128]=new E(h.array,0,1);ye[160]=new E(h.map,0,1);ye[244]=new E(h.false,!1,1);ye[245]=new E(h.true,!0,1);ye[246]=new E(h.null,null,1);function ld(r){switch(r.type){case h.false:return Be([244]);case h.true:return Be([245]);case h.null:return Be([246]);case h.bytes:return r.value.length?void 0:Be([64]);case h.string:return r.value===""?Be([96]):void 0;case h.array:return r.value===0?Be([128]):void 0;case h.map:return r.value===0?Be([160]):void 0;case h.uint:return r.value<24?Be([Number(r.value)]):void 0;case h.negint:if(r.value>=-24)return Be([31-Number(r.value)])}}var Lg={float64:!1,mapSorter:Dg,quickEncodeToken:ld};function Ng(){let r=[];return r[h.uint.major]=re,r[h.negint.major]=Ti,r[h.bytes.major]=dn,r[h.string.major]=Fh,r[h.array.major]=Ci,r[h.map.major]=Pi,r[h.tag.major]=Bi,r[h.float.major]=Li,r}var fd=Ng(),Nc=new po,Di=class r{constructor(t,e){this.obj=t,this.parent=e}includes(t){let e=this;do if(e.obj===t)return!0;while(e=e.parent);return!1}static createCheck(t,e){if(t&&t.includes(e))throw new Error(`${ze} object contains circular references`);return new r(e,t)}},fr={null:new E(h.null,null),undefined:new E(h.undefined,void 0),true:new E(h.true,!0),false:new E(h.false,!1),emptyArray:new E(h.array,0),emptyMap:new E(h.map,0)},hr={number(r,t,e,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new E(h.float,r):r>=0?new E(h.uint,r):new E(h.negint,r)},bigint(r,t,e,n){return r>=BigInt(0)?new E(h.uint,r):new E(h.negint,r)},Uint8Array(r,t,e,n){return new E(h.bytes,r)},string(r,t,e,n){return new E(h.string,r)},boolean(r,t,e,n){return r?fr.true:fr.false},null(r,t,e,n){return fr.null},undefined(r,t,e,n){return fr.undefined},ArrayBuffer(r,t,e,n){return new E(h.bytes,new Uint8Array(r))},DataView(r,t,e,n){return new E(h.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,t,e,n){if(!r.length)return e.addBreakTokens===!0?[fr.emptyArray,new E(h.break)]:fr.emptyArray;n=Di.createCheck(n,r);let o=[],i=0;for(let s of r)o[i++]=Ri(s,e,n);return e.addBreakTokens?[new E(h.array,r.length),o,new E(h.break)]:[new E(h.array,r.length),o]},Object(r,t,e,n){let o=t!=="Object",i=o?r.keys():Object.keys(r),s=o?r.size:i.length;if(!s)return e.addBreakTokens===!0?[fr.emptyMap,new E(h.break)]:fr.emptyMap;n=Di.createCheck(n,r);let a=[],c=0;for(let l of i)a[c++]=[Ri(l,e,n),Ri(o?r.get(l):r[l],e,n)];return Rg(a,e),e.addBreakTokens?[new E(h.map,s),a,new E(h.break)]:[new E(h.map,s),a]}};hr.Map=hr.Object;hr.Buffer=hr.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))hr[`${r}Array`]=hr.DataView;function Ri(r,t={},e){let n=lh(r),o=t&&t.typeEncoders&&t.typeEncoders[n]||hr[n];if(typeof o=="function"){let s=o(r,n,t,e);if(s!=null)return s}let i=hr[n];if(!i)throw new Error(`${ze} unsupported type: ${n}`);return i(r,n,t,e)}function Rg(r,t){t.mapSorter&&r.sort(t.mapSorter)}function Dg(r,t){let e=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(e.type!==n.type)return e.type.compare(n.type);let o=e.type.major,i=fd[o].compareTokens(e,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function hd(r,t,e,n){if(Array.isArray(t))for(let o of t)hd(r,o,e,n);else e[t.type.major](r,t,n)}function Rc(r,t,e){let n=Ri(r,e);if(!Array.isArray(n)&&e.quickEncodeToken){let o=e.quickEncodeToken(n);if(o)return o;let i=t[n.type.major];if(i.encodedSize){let s=i.encodedSize(n,e),a=new po(s);if(i(a,n,e),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return ho(a.chunks[0])}}return Nc.reset(),hd(Nc,n,t,e),Nc.toBytes(!0)}function dr(r,t){return t=Object.assign({},Lg,t),Rc(r,fd,t)}var Ug={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Ui=class{constructor(t,e={}){this._pos=0,this.data=t,this.options=e}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let t=this.data[this._pos],e=ye[t];if(e===void 0){let n=L[t];if(!n)throw new Error(`${O} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);let o=t&31;e=n(this.data,this._pos,o,this.options)}return this._pos+=e.encodedLength,e}},wo=Symbol.for("DONE"),Fi=Symbol.for("BREAK");function Fg(r,t,e){let n=[];for(let o=0;o<r.value;o++){let i=yn(t,e);if(i===Fi){if(r.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed array`)}if(i===wo)throw new Error(`${O} found array but not enough entries (got ${o}, expected ${r.value})`);n[o]=i}return n}function Og(r,t,e){let n=e.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=yn(t,e);if(a===Fi){if(r.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed map`)}if(a===wo)throw new Error(`${O} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${O} non-string keys not supported (got ${typeof a})`);if(e.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in o))throw new Error(`${O} found repeat map key "${a}"`);let c=yn(t,e);if(c===wo)throw new Error(`${O} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function yn(r,t){if(r.done())return wo;let e=r.next();if(e.type===h.break)return Fi;if(e.type.terminal)return e.value;if(e.type===h.array)return Fg(e,r,t);if(e.type===h.map)return Og(e,r,t);if(e.type===h.tag){if(t.tags&&typeof t.tags[e.value]=="function"){let n=yn(r,t);return t.tags[e.value](n)}throw new Error(`${O} tag not supported (${e.value})`)}throw new Error("unsupported")}function Dc(r,t){if(!(r instanceof Uint8Array))throw new Error(`${O} data to decode must be a Uint8Array`);t=Object.assign({},Ug,t);let e=t.tokenizer||new Ui(r,t),n=yn(e,t);if(n===wo)throw new Error(`${O} did not find any content to decode`);if(n===Fi)throw new Error(`${O} got unexpected break`);return[n,r.subarray(e.pos())]}function ee(r,t){let[e,n]=Dc(r,t);if(n.length>0)throw new Error(`${O} too many terminals, data makes no sense`);return e}var je="/",dd=new TextEncoder().encode(je),Oi=dd[0],Dt=class r{_buf;constructor(t,e){if(typeof t=="string")this._buf=V(t);else if(t instanceof Uint8Array)this._buf=t;else throw new Error("Invalid key, should be String of Uint8Array");if(e==null&&(e=!0),e&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Oi)throw new Error("Invalid key")}toString(t="utf8"){return q(this._buf,t)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(t){return new r(t.join(je))}static random(){return new r(Math.random().toString().substring(2))}static asKey(t){return t instanceof Uint8Array||typeof t=="string"?new r(t):typeof t.uint8Array=="function"?new r(t.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=dd),this._buf[0]!==Oi){let t=new Uint8Array(this._buf.byteLength+1);t.fill(Oi,0,1),t.set(this._buf,1),this._buf=t}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Oi;)this._buf=this._buf.subarray(0,-1)}less(t){let e=this.list(),n=t.list();for(let o=0;o<e.length;o++){if(n.length<o+1)return!1;let i=e[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return e.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let t=this.namespaces();return t[t.length-1]}list(){return this.toString().split(je).slice(1)}type(){return Mg(this.baseNamespace())}name(){return Kg(this.baseNamespace())}instance(t){return new r(this.toString()+":"+t)}path(){let t=this.parent().toString();return t.endsWith(je)||(t+=je),t+=this.type(),new r(t)}parent(){let t=this.list();return t.length===1?new r(je):new r(t.slice(0,-1).join(je))}child(t){return this.toString()===je?t:t.toString()===je?this:new r(this.toString()+t.toString(),!1)}isAncestorOf(t){return t.toString()===this.toString()?!1:t.toString().startsWith(this.toString())}isDecendantOf(t){return t.toString()===this.toString()?!1:this.toString().startsWith(t.toString())}isTopLevel(){return this.list().length===1}concat(...t){return r.withNamespaces([...this.namespaces(),...$g(t.map(e=>e.namespaces()))])}};function Mg(r){let t=r.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function Kg(r){let t=r.split(":");return t[t.length-1]}function $g(r){return[].concat(...r)}function Mi({enumerable:r=!0,configurable:t=!1}={}){return{enumerable:r,configurable:t,writable:!1}}function*Vg(r,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[e,n]of t.entries()){let o=[...r,e],i=K.asCID(n);i!=null?yield[o.join("/"),i]:typeof n=="object"&&(yield*Fc(n,o))}else{let e=K.asCID(t);e!=null?yield[r.join("/"),e]:yield*Fc(t,r)}}function*Fc(r,t){if(r==null||r instanceof Uint8Array)return;let e=K.asCID(r);e!=null&&(yield[t.join("/"),e]);for(let[n,o]of Object.entries(r)){let i=[...t,n];yield*Vg(i,o)}}function*qg(r,t){if(Array.isArray(t))for(let[e,n]of t.entries()){let o=[...r,e];yield o.join("/"),typeof n=="object"&&K.asCID(n)==null&&(yield*Oc(n,o))}else yield*Oc(t,r)}function*Oc(r,t){if(!(r==null||typeof r!="object"))for(let[e,n]of Object.entries(r)){let o=[...t,e];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&K.asCID(n)==null&&(yield*qg(o,n))}}function zg(r,t){let e=r;for(let[n,o]of t.entries()){if(e=e[o],e==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let i=K.asCID(e);if(i!=null)return{value:i,remaining:t.slice(n+1).join("/")}}return{value:e}}var Mc=class{cid;bytes;value;asBlock;constructor({cid:t,bytes:e,value:n}){if(t==null||e==null||typeof n>"u")throw new Error("Missing required argument");this.cid=t,this.bytes=e,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:Mi(),bytes:Mi(),value:Mi(),asBlock:Mi()})}links(){return Fc(this.value,[])}tree(){return Oc(this.value,[])}get(t="/"){return zg(this.value,t.split("/").filter(Boolean))}};function pd({bytes:r,cid:t,value:e,codec:n}){let o=e!==void 0?e:n?.decode(r);if(o===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Mc({cid:t,bytes:r,value:o})}var gd="/pin/",md="/pinned-block/",Kc=Ae,yd=1;function Ki(r){return r.version===0&&(r=r.toV1()),new Dt(`${gd}${r.toString(Kc)}`)}var $i=class{datastore;blockstore;getCodec;constructor(t,e,n){this.datastore=t,this.blockstore=e,this.getCodec=n}async*add(t,e={}){let n=Ki(t);if(await this.datastore.has(n))throw new Error("Already pinned");let o=Math.round(e.depth??1/0);if(o<0)throw new Error("Depth must be greater than or equal to 0");let i=new Ne({concurrency:yd});for await(let a of this.#t(t,i,{...e,depth:o}))await this.#e(a,c=>c.pinnedBy.find(l=>Q(l,t.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(t.bytes),!0),e),yield a;let s={depth:o,metadata:e.metadata??{}};await this.datastore.put(n,dr(s),e)}async*#t(t,e,n){if(n.depth===-1)return;let o=await this.getCodec(t.code),i=await this.blockstore.get(t,n),s=pd({bytes:i,cid:t,codec:o});yield t;for(let[,a]of s.links())yield*await e.add(async()=>this.#t(a,e,{...n,depth:n.depth-1}))}async#e(t,e,n){let o=new Dt(`${md}${Kc.encode(t.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=ee(await this.datastore.get(o,n))}catch(a){if(a.name!=="NotFoundError")throw a}if(e(i)){if(i.pinCount===0&&await this.datastore.has(o)){await this.datastore.delete(o);return}await this.datastore.put(o,dr(i),n),n.onProgress?.(new et("helia:pin:add",t))}}async*rm(t,e={}){let n=Ki(t),o=await this.datastore.get(n,e),i=ee(o);await this.datastore.delete(n,e);let s=new Ne({concurrency:yd});for await(let a of this.#t(t,s,{...e,depth:i.depth}))await this.#e(a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>Q(l,t.bytes)),!0),{...e,depth:i.depth}),yield a}async*ls(t={}){for await(let{key:e,value:n}of this.datastore.query({prefix:gd+(t.cid!=null?`${t.cid.toString(Ae)}`:"")},t)){let o=K.parse(e.toString().substring(5),Ae),i=ee(n);yield{cid:o,...i}}}async isPinned(t,e={}){let n=new Dt(`${md}${Kc.encode(t.multihash.bytes)}`);return this.datastore.has(n,e)}async get(t,e){let n=Ki(t),o=await this.datastore.get(n,e);return ee(o)}async setMetadata(t,e,n){let o=Ki(t),i=await this.datastore.get(o,n),s=ee(i);s.metadata=e??{},await this.datastore.put(o,dr(s),n)}};var $c=1,Vc=5;var xo=class extends Error{static name="InsufficientProvidersError";constructor(t="Insufficient providers found"){super(t),this.name="InsufficientProvidersError"}},pr=class extends Error{static name="NoRoutersAvailableError";constructor(t="No routers available"){super(t),this.name="NoRoutersAvailableError"}},bo=class extends Error{static name="UnknownHashAlgorithmError";constructor(t="Unknown hash algorithm"){super(t),this.name="UnknownHashAlgorithmError"}},Eo=class extends Error{static name="UnknownCodecError";constructor(t="Unknown codec"){super(t),this.name="UnknownCodecError"}};var Hg=5,Vi=class{log;routers;providerLookupConcurrency;constructor(t,e){this.log=t.logger.forComponent("helia:routing"),this.routers=e.routers??[],this.providerLookupConcurrency=e.providerLookupConcurrency??Hg,this.findProviders=t.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=t.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=t.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=t.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=t.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=t.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=t.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async start(){await Je(...this.routers)}async stop(){await tr(...this.routers)}async*findProviders(t,e={}){if(this.routers.length===0)throw new pr("No content routers available");let n=new $o({concurrency:this.providerLookupConcurrency});n.addEventListener("error",()=>{});for await(let o of br(n.toGenerator(),...Rr(this.routers,"findProviders").map(i=>i.findProviders(t,e))))if(o!=null){if(o.multiaddrs.length===0){if(n.find(o.id)!=null)continue;n.add(async()=>{try{let i=await this.findPeer(o.id,e);return i.multiaddrs.length===0?null:i}catch(i){return this.log.error("could not load multiaddrs for peer %p",o.id,i),null}},{peerId:o.id,signal:e.signal}).catch(i=>{this.log.error("could not load multiaddrs for peer %p",o.id,i)})}yield o}}async provide(t,e={}){if(this.routers.length===0)throw new pr("No content routers available");await Promise.all(Rr(this.routers,"provide").map(async n=>{await n.provide(t,e)}))}async cancelReprovide(t,e={}){await Promise.all(Rr(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(t,e)}))}async put(t,e,n){await Promise.all(Rr(this.routers,"put").map(async o=>{await o.put(t,e,n)}))}async get(t,e){return Promise.any(Rr(this.routers,"get").map(async n=>n.get(t,e)))}async findPeer(t,e){if(this.routers.length===0)throw new pr("No peer routers available");let n=this,o=br(...Rr(this.routers,"findPeer").map(i=>async function*(){try{yield await i.findPeer(t,e)}catch(s){n.log.error(s)}}()));for await(let i of o)if(i!=null)return i;throw new Ct("Could not find peer in routing")}async*getClosestPeers(t,e={}){if(this.routers.length===0)throw new pr("No peer routers available");for await(let n of br(...Rr(this.routers,"getClosestPeers").map(o=>o.getClosestPeers(t,e))))n!=null&&(yield n)}};function Rr(r,t){return r.filter(e=>e[t]!=null)}var mr={},gn=r=>{r.addEventListener("message",t=>{gn.dispatchEvent("message",r,t)}),r.port!=null&&r.port.addEventListener("message",t=>{gn.dispatchEvent("message",r,t)})};gn.addEventListener=(r,t)=>{mr[r]==null&&(mr[r]=[]),mr[r].push(t)};gn.removeEventListener=(r,t)=>{mr[r]!=null&&(mr[r]=mr[r].filter(e=>e===t))};gn.dispatchEvent=function(r,t,e){mr[r]!=null&&mr[r].forEach(n=>n(t,e))};var qc=gn;var zc="lock:worker:request-read",Hc="lock:worker:release-read",jc="lock:master:grant-read",Gc="lock:worker:request-write",Wc="lock:worker:release-write",Yc="lock:master:grant-write";var wd=(r=21)=>Math.random().toString().substring(2);var xd=(r,t,e,n,o)=>(i,s)=>{if(s.data.type!==e)return;let a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};r.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{i.postMessage({type:o,name:a.name,identifier:a.identifier}),await new Promise(c=>{let l=u=>{if(u?.data==null)return;let f={type:u.data.type,name:u.data.name,identifier:u.data.identifier};f.type===n&&f.identifier===a.identifier&&(i.removeEventListener("message",l),c())};i.addEventListener("message",l)})}}}))},bd=(r,t,e,n)=>async()=>{let o=wd();return globalThis.postMessage({type:t,identifier:o,name:r}),new Promise(i=>{let s=a=>{if(a?.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===e&&c.identifier===o&&(globalThis.removeEventListener("message",s),i(()=>{globalThis.postMessage({type:n,identifier:o,name:r})}))};globalThis.addEventListener("message",s)})},jg={singleProcess:!1},Ed=r=>{if(r=Object.assign({},jg,r),!!globalThis.document||r.singleProcess){let e=new EventTarget;return qc.addEventListener("message",xd(e,"requestReadLock",zc,Hc,jc)),qc.addEventListener("message",xd(e,"requestWriteLock",Gc,Wc,Yc)),e}return{isWorker:!0,readLock:e=>bd(e,zc,jc,Hc),writeLock:e=>bd(e,Gc,Yc,Wc)}};var Dr={},yr;async function Zc(r,t){let e,n=new Promise(o=>{e=o});return r.add(async()=>lo((async()=>{await new Promise(o=>{e(()=>{o()})})})(),{milliseconds:t.timeout})),n}var Gg=(r,t)=>{if(yr.isWorker===!0)return{readLock:yr.readLock(r,t),writeLock:yr.writeLock(r,t)};let e=new Pe({concurrency:1}),n;return{async readLock(){if(n!=null)return Zc(n,t);n=new Pe({concurrency:t.concurrency,autoStart:!1});let o=n,i=Zc(n,t);return e.add(async()=>{o.start(),await o.onIdle().then(()=>{n===o&&(n=null)})}),i},async writeLock(){return n=null,Zc(e,t)}}},Wg={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Xc(r){let t=Object.assign({},Wg,r);return yr==null&&(yr=Ed(t),yr.isWorker!==!0&&(yr.addEventListener("requestReadLock",e=>{Dr[e.data.name]!=null&&Dr[e.data.name].readLock().then(async n=>e.data.handler().finally(()=>{n()}))}),yr.addEventListener("requestWriteLock",async e=>{Dr[e.data.name]!=null&&Dr[e.data.name].writeLock().then(async n=>e.data.handler().finally(()=>{n()}))}))),Dr[t.name]==null&&(Dr[t.name]=Gg(t.name,t)),Dr[t.name]}var qi=class{lock;child;pins;started;constructor(t,e,n={}){this.child=t,this.pins=e,this.lock=Xc({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await Je(this.child),this.started=!0}async stop(){await tr(this.child),this.started=!1}unwrap(){return this.child}async put(t,e,n={}){n?.signal?.throwIfAborted();let o=await this.lock.readLock();try{return await this.child.put(t,e,n)}finally{o()}}async*putMany(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.readLock();try{yield*this.child.putMany(t,e)}finally{n()}}async get(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.readLock();try{return await this.child.get(t,e)}finally{n()}}async*getMany(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.readLock();try{yield*this.child.getMany(t,e)}finally{n()}}async delete(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.writeLock();try{if(await this.pins.isPinned(t))throw new Error("CID was pinned");await this.child.delete(t,e)}finally{n()}}async*deleteMany(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.writeLock();try{let o=this;yield*this.child.deleteMany(async function*(){for await(let i of t){if(await o.pins.isPinned(i))throw new Error("CID was pinned");yield i}}(),e)}finally{n()}}async has(t,e={}){e?.signal?.throwIfAborted();let n=await this.lock.readLock();try{return await this.child.has(t,e)}finally{n()}}async*getAll(t={}){t?.signal?.throwIfAborted();let e=await this.lock.readLock();try{yield*this.child.getAll(t)}finally{e()}}createSession(t,e){return e?.signal?.throwIfAborted(),this.child.createSession(t,e)}};var Qc=new Dt("/version"),vd=1;async function Sd(r){if(!await r.has(Qc)){await r.put(Qc,V(`${vd}`));return}let t=await r.get(Qc),e=q(t);if(parseInt(e,10)!==vd)throw new Error("Unknown datastore version, a datastore migration may be required")}var eu={};wt(eu,{code:()=>tu,decode:()=>nw,decodeOptions:()=>tw,encode:()=>rw,encodeOptions:()=>Qg,name:()=>ew,toByteView:()=>_d});var Ad=42;function _d(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function Yg(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let t=K.asCID(r);if(!t)return null;let e=new Uint8Array(t.bytes.byteLength+1);return e.set(t.bytes,1),[new E(h.tag,Ad),new E(h.bytes,e)]}function Zg(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Xg(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Jc={float64:!0,typeEncoders:{Object:Yg,undefined:Zg,number:Xg}},Qg={...Jc,typeEncoders:{...Jc.typeEncoders}};function Jg(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return K.decode(r.subarray(1))}var zi={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};zi.tags[Ad]=Jg;var tw={...zi,tags:zi.tags.slice()},ew="dag-cbor",tu=113,rw=r=>dr(r,Jc),nw=r=>ee(_d(r),zi);var cu={};wt(cu,{code:()=>au,decode:()=>Td,encode:()=>Id,format:()=>pw,name:()=>dw,parse:()=>yw,stringify:()=>pw});var ru=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(t){let e=this.inRecursive[this.inRecursive.length-1];e&&(e.type===h.array&&(e.elements++,e.elements!==1&&t.push([44])),e.type===h.map&&(e.elements++,e.elements!==1&&(e.elements%2===1?t.push([44]):t.push([58]))))}[h.uint.major](t,e){this.prefix(t);let n=String(e.value),o=[];for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);t.push(o)}[h.negint.major](t,e){this[h.uint.major](t,e)}[h.bytes.major](t,e){throw new Error(`${ze} unsupported type: Uint8Array`)}[h.string.major](t,e){this.prefix(t);let n=Ii(JSON.stringify(e.value));t.push(n.length>32?ho(n):n)}[h.array.major](t,e){this.prefix(t),this.inRecursive.push({type:h.array,elements:0}),t.push([91])}[h.map.major](t,e){this.prefix(t),this.inRecursive.push({type:h.map,elements:0}),t.push([123])}[h.tag.major](t,e){}[h.float.major](t,e){if(e.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===h.array)t.push([93]);else if(s.type===h.map)t.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(e.value===void 0)throw new Error(`${ze} unsupported type: undefined`);if(this.prefix(t),e.type.name==="true"){t.push([116,114,117,101]);return}else if(e.type.name==="false"){t.push([102,97,108,115,101]);return}else if(e.type.name==="null"){t.push([110,117,108,108]);return}let n=String(e.value),o=[],i=!1;for(let s=0;s<n.length;s++)o[s]=n.charCodeAt(s),!i&&(o[s]===46||o[s]===101||o[s]===69)&&(i=!0);i||(o.push(46),o.push(48)),t.push(o)}};function ow(r,t){if(Array.isArray(r[0])||Array.isArray(t[0]))throw new Error(`${ze} complex map keys are not supported`);let e=r[0],n=t[0];if(e.type!==h.string||n.type!==h.string)throw new Error(`${ze} non-string map keys are not supported`);if(e<n)return-1;if(e>n)return 1;throw new Error(`${ze} unexpected duplicate map keys, this is not supported`)}var iw={addBreakTokens:!0,mapSorter:ow};function nu(r,t){return t=Object.assign({},iw,t),Rc(r,new ru,t)}var wn=class{constructor(t,e={}){this._pos=0,this.data=t,this.options=e,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let t=this.ch();for(;t===32||t===9||t===13||t===10;)t=this.data[++this._pos]}expect(t){if(this.data.length-this._pos<t.length)throw new Error(`${O} unexpected end of input at position ${this._pos}`);for(let e=0;e<t.length;e++)if(this.data[this._pos++]!==t[e])throw new Error(`${O} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...t)}'`)}parseNumber(){let t=this._pos,e=!1,n=!1,o=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(e=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new E(h.uint,0,this._pos-t);if(o([48,49,50,51,52,53,54,55,56,57]),e&&this._pos===t+1)throw new Error(`${O} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${O} unexpected token at position ${this._pos}`);n=!0,this._pos++,o([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,o([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(t,this._pos)),s=parseFloat(i);return n?new E(h.float,s,this._pos-t):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new E(s>=0?h.uint:h.negint,s,this._pos-t):new E(s>=0?h.uint:h.negint,BigInt(i),this._pos-t)}parseString(){if(this.ch()!==34)throw new Error(`${O} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let i=this._pos,s=0;i<this.data.length&&s<65536;i++,s++){let a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new E(h.string,c,s)}}let t=this._pos,e=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${O} unexpected end of unicode escape sequence at position ${this._pos}`);let i=0;for(let s=0;s<4;s++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${O} unexpected unicode escape character at position ${this._pos}`);i=i*16+a,this._pos++}return i},o=()=>{let i=this.ch(),s=null,a=i>239?4:i>223?3:i>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${O} unexpected unicode sequence at position ${this._pos}`);let c,l,u,f;switch(a){case 1:i<128&&(s=i);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(f=(i&31)<<6|c&63,f>127&&(s=f));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(f=(i&15)<<12|(c&63)<<6|l&63,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],u=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(f=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,f>65535&&f<1114112&&(s=f))}s===null?(s=65533,a=1):s>65535&&(s-=65536,e.push(s>>>10&1023|55296),s=56320|s&1023),e.push(s),this._pos+=a};for(;!this.done();){let i=this.ch(),s;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${O} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:e.push(s);break;case 98:e.push(8);break;case 116:e.push(9);break;case 110:e.push(10);break;case 102:e.push(12);break;case 114:e.push(13);break;case 117:e.push(n());break;default:throw new Error(`${O} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new E(h.string,kc(e),this._pos-t);default:if(i<32)throw new Error(`${O} invalid control character at position ${this._pos}`);i<128?(e.push(i),this._pos++):o()}}throw new Error(`${O} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new E(h.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new E(h.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new E(h.null,null,4);case 102:return this.expect([102,97,108,115,101]),new E(h.false,!1,5);case 116:return this.expect([116,114,117,101]),new E(h.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${O} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new E(h.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new E(h.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new E(h.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new E(h.break,void 0,1);let t=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${O} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),t}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${O} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function ou(r,t){return t=Object.assign({tokenizer:new wn(r,t)},t),ee(r,t)}function aw(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function cw(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;let t=K.asCID(r);if(!t)return null;let e=t.toString();return[new E(h.map,1/0,1),new E(h.string,"/",1),new E(h.string,e,e.length),new E(h.break,void 0,1)]}function Hi(r){let t=_e.encode(r).slice(1);return[new E(h.map,1/0,1),new E(h.string,"/",1),new E(h.map,1/0,1),new E(h.string,"bytes",5),new E(h.string,t,t.length),new E(h.break,void 0,1),new E(h.break,void 0,1)]}function ge(r){return Hi(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function uw(r){return Hi(new Uint8Array(r))}function lw(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function fw(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var hw={typeEncoders:{Object:cw,Buffer:Hi,Uint8Array:Hi,Int8Array:ge,Uint16Array:ge,Int16Array:ge,Uint32Array:ge,Int32Array:ge,Float32Array:ge,Float64Array:ge,Uint8ClampedArray:ge,BigInt64Array:ge,BigUint64Array:ge,DataView:ge,ArrayBuffer:uw,undefined:lw,number:fw}},iu=class extends wn{constructor(t,e){super(t,e),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let t=this._next();if(t.type===h.map){let e=this._next();if(e.type===h.string&&e.value==="/"){let n=this._next();if(n.type===h.string){if(this._next().type!==h.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new E(h.tag,42,0)}if(n.type===h.map){let o=this._next();if(o.type===h.string&&o.value==="bytes"){let i=this._next();if(i.type===h.string){for(let a=0;a<2;a++)if(this._next().type!==h.break)throw new Error("Invalid encoded Bytes form");let s=_e.decode(`m${i.value}`);return new E(h.bytes,s,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(o)}this.tokenBuffer.push(n)}this.tokenBuffer.push(e)}return t}},su={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};su.tags[42]=K.parse;var dw="dag-json",au=297,Id=r=>nu(r,hw),Td=r=>{let t=aw(r),e=Object.assign(su,{tokenizer:new iu(t,su)});return ou(t,e)},pw=r=>mw.decode(Id(r));var mw=new TextDecoder,yw=r=>Td(gw.encode(r)),gw=new TextEncoder;var pu={};wt(pu,{code:()=>du,createLink:()=>Fd,createNode:()=>Ud,decode:()=>Pw,encode:()=>Cw,name:()=>kw,prepare:()=>fu,validate:()=>hu});var ww=new TextDecoder;function uu(r,t){let e=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=r.length)throw new Error("protobuf: unexpected end of data");let o=r[t++];if(e+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[e,t]}function ji(r,t){let e;[e,t]=uu(r,t);let n=t+e;if(e<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(t,n),n]}function kd(r,t){let e;return[e,t]=uu(r,t),[e&7,e>>3,t]}function xw(r){let t={},e=r.length,n=0;for(;n<e;){let o,i;if([o,i,n]=kd(r,n),i===1){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(t.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=ji(r,n)}else if(i===2){if(t.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=ji(r,n),t.Name=ww.decode(s)}else if(i===3){if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[t.Tsize,n]=uu(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>e)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function Cd(r){let t=r.length,e=0,n,o=!1,i;for(;e<t;){let a,c;if([a,c,e]=kd(r,e),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,e]=ji(r,e),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,e]=ji(r,e),n.push(xw(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(e>t)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return i&&(s.Data=i),s.Links=n||[],s}var Bd=new TextEncoder,Pd=2**32,bw=2**31;function Ew(r,t){let e=t.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");e=vo(t,e,r.Tsize)-1,t[e]=24}if(typeof r.Name=="string"){let n=Bd.encode(r.Name);e-=n.length,t.set(n,e),e=vo(t,e,n.length)-1,t[e]=18}return r.Hash&&(e-=r.Hash.length,t.set(r.Hash,e),e=vo(t,e,r.Hash.length)-1,t[e]=10),t.length-e}function Ld(r){let t=Sw(r),e=new Uint8Array(t),n=t;if(r.Data&&(n-=r.Data.length,e.set(r.Data,n),n=vo(e,n,r.Data.length)-1,e[n]=10),r.Links)for(let o=r.Links.length-1;o>=0;o--){let i=Ew(r.Links[o],e.subarray(0,n));n-=i,n=vo(e,n,i)-1,e[n]=18}return e}function vw(r){let t=0;if(r.Hash){let e=r.Hash.length;t+=1+e+xn(e)}if(typeof r.Name=="string"){let e=Bd.encode(r.Name).length;t+=1+e+xn(e)}return typeof r.Tsize=="number"&&(t+=1+xn(r.Tsize)),t}function Sw(r){let t=0;if(r.Data){let e=r.Data.length;t+=1+e+xn(e)}if(r.Links)for(let e of r.Links){let n=vw(e);t+=1+n+xn(n)}return t}function vo(r,t,e){t-=xn(e);let n=t;for(;e>=bw;)r[t++]=e&127|128,e/=128;for(;e>=128;)r[t++]=e&127|128,e>>>=7;return r[t]=e,n}function xn(r){return r%2===0&&r++,Math.floor((Aw(r)+6)/7)}function Aw(r){let t=0;return r>=Pd&&(r=Math.floor(r/Pd),t=32),r>=65536&&(r>>>=16,t+=16),r>=256&&(r>>>=8,t+=8),t+_w[r]}var _w=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var Iw=["Data","Links"],Tw=["Hash","Name","Tsize"],lu=new TextEncoder;function Rd(r,t){if(r===t)return 0;let e=r.Name?lu.encode(r.Name):[],n=t.Name?lu.encode(t.Name):[],o=e.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(e[s]!==n[s]){o=e[s],i=n[s];break}return o<i?-1:i<o?1:0}function Nd(r,t){return!Object.keys(r).some(e=>!t.includes(e))}function Dd(r){if(typeof r.asCID=="object"){let e=K.asCID(r);if(!e)throw new TypeError("Invalid DAG-PB form");return{Hash:e}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let t={};if(r.Hash){let e=K.asCID(r.Hash);try{e||(typeof r.Hash=="string"?e=K.parse(r.Hash):r.Hash instanceof Uint8Array&&(e=K.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}e&&(t.Hash=e)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(t.Name=r.Name),typeof r.Tsize=="number"&&(t.Tsize=r.Tsize),t}function fu(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let t={};if(r.Data!==void 0)if(typeof r.Data=="string")t.Data=lu.encode(r.Data);else if(r.Data instanceof Uint8Array)t.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))t.Links=r.Links.map(Dd),t.Links.sort(Rd);else throw new TypeError("Invalid DAG-PB form");else t.Links=[];return t}function hu(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!Nd(r,Iw))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<r.Links.length;t++){let e=r.Links[t];if(!e||typeof e!="object"||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!Nd(e,Tw))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(e.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(e.Hash==null||!e.Hash["/"]||e.Hash["/"]!==e.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(e.Name!==void 0&&typeof e.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(e.Tsize!==void 0){if(typeof e.Tsize!="number"||e.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&Rd(e,r.Links[t-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Ud(r,t=[]){return fu({Data:r,Links:t})}function Fd(r,t,e){return Dd({Hash:e,Name:r,Tsize:t})}function Od(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}var kw="dag-pb",du=112;function Cw(r){hu(r);let t={};return r.Links&&(t.Links=r.Links.map(e=>{let n={};return e.Hash&&(n.Hash=e.Hash.bytes),e.Name!==void 0&&(n.Name=e.Name),e.Tsize!==void 0&&(n.Tsize=e.Tsize),n})),r.Data&&(t.Data=r.Data),Ld(t)}function Pw(r){let t=Od(r),e=Cd(t),n={};return e.Data&&(n.Data=e.Data),e.Links&&(n.Links=e.Links.map(o=>{let i={};try{i.Hash=K.decode(o.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return o.Name!==void 0&&(i.Name=o.Name),o.Tsize!==void 0&&(i.Tsize=o.Tsize),i})),n}function bn(r){return r?.then!=null}function Md(r=[],t){let e={[du]:pu,[Fn]:On,[tu]:eu,[au]:cu,[la]:zo};return r.forEach(n=>{e[n.code]=n}),async n=>{let o=e[n];if(o==null&&t!=null){let i=t(n);bn(i)?o=await i:o=i,e[o.code]=o}if(o!=null)return o;throw new Eo(`Could not load codec for ${n}`)}}function Kd(r=[],t){let e={[nr.code]:nr,[jo.code]:jo,[Nt.code]:Nt};return r.forEach(n=>{e[n.code]=n}),async n=>{let o=e[n];if(o==null&&t!=null){let i=t(n);bn(i)?o=await i:o=i,e[o.code]=o}if(o!=null)return o;throw new bo(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}var oe=class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(t="Not Found"){super(t)}};var Ge=class{has(t,e){return Promise.reject(new Error(".has is not implemented"))}put(t,e,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(t,e){for await(let{cid:n,block:o}of t)await this.put(n,o,e),yield n}get(t,e){return Promise.reject(new Error(".get is not implemented"))}async*getMany(t,e){for await(let n of t)yield{cid:n,block:await this.get(n,e)}}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(t,e){for await(let n of t)await this.delete(n,e),yield n}async*getAll(t){throw new Error(".getAll is not implemented")}};var Gi=0,Wi=class extends Ge{child;constructor(t){super(),this.child=t}put(t,e){return t.multihash.code===Gi||this.child==null?t:this.child.put(t,e)}get(t){if(t.multihash.code===Gi)return t.multihash.digest;if(this.child==null)throw new oe;return this.child.get(t)}has(t){return t.multihash.code===Gi?!0:this.child==null?!1:this.child.has(t)}delete(t){if(t.code!==Gi&&this.child!=null)return this.child.delete(t)}getAll(t){return this.child!=null?this.child.getAll(t):[]}};function Bw(r){return r[Symbol.asyncIterator]!=null}function Lw(r,t){let e=0;if(Bw(r))return async function*(){for await(let c of r)await t(c,e++)&&(yield c)}();let n=zr(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();let s=t(o,e++);if(typeof s.then=="function")return async function*(){await s&&(yield o);for await(let c of n)await t(c,e++)&&(yield c)}();let a=t;return function*(){s===!0&&(yield o);for(let c of n)a(c,e++)&&(yield c)}()}var we=Lw;function Nw(r){return r[Symbol.asyncIterator]!=null}function $d(r){return r?.then!=null}function Rw(r,t){let e=0;if(Nw(r))return async function*(){for await(let c of r){let l=t(c,e++);$d(l)&&await l,yield c}}();let n=zr(r),{value:o,done:i}=n.next();if(i===!0)return function*(){}();if(typeof t(o,e++)?.then=="function")return async function*(){yield o;for await(let c of n){let l=t(c,e++);$d(l)&&await l,yield c}}();let a=t;return function*(){yield o;for(let c of n)a(c,e++),yield c}()}var mu=Rw;var Yi=class{child;getHasher;log;logger;components;constructor(t){this.log=t.logger.forComponent("helia:networked-storage"),this.logger=t.logger,this.components=t,this.child=new Wi(t.blockstore),this.getHasher=t.getHasher}async put(t,e,n={}){return await this.child.has(t,n)?(n.onProgress?.(new et("blocks:put:duplicate",t)),t):(n.onProgress?.(new et("blocks:put:providers:notify",t)),await Promise.all(this.components.blockBrokers.map(async o=>o.announce?.(t,e,n))),n.onProgress?.(new et("blocks:put:blockstore:put",t)),this.child.put(t,e,n))}async*putMany(t,e={}){let n=we(t,async({cid:i})=>{let s=await this.child.has(i,e);return s&&e.onProgress?.(new et("blocks:put-many:duplicate",i)),!s}),o=mu(n,async({cid:i,block:s})=>{e.onProgress?.(new et("blocks:put-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async a=>a.announce?.(i,s,e)))});e.onProgress?.(new et("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(o,e)}async get(t,e={}){if(e.offline!==!0&&!await this.child.has(t,e)){let n=await this.getHasher(t.multihash.code);e.onProgress?.(new et("blocks:get:providers:get",t));let o=await Vd(t,this.components.blockBrokers,n,{...e,log:this.log});return e.onProgress?.(new et("blocks:get:blockstore:put",t)),await this.child.put(t,o,e),e.onProgress?.(new et("blocks:get:providers:notify",t)),await Promise.all(this.components.blockBrokers.map(async i=>i.announce?.(t,o,e))),o}return e.onProgress?.(new et("blocks:get:blockstore:get",t)),this.child.get(t,e)}async*getMany(t,e={}){e.onProgress?.(new et("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(mu(t,async n=>{if(e.offline!==!0&&!await this.child.has(n,e)){let o=await this.getHasher(n.multihash.code);e.onProgress?.(new et("blocks:get-many:providers:get",n));let i=await Vd(n,this.components.blockBrokers,o,{...e,log:this.log});e.onProgress?.(new et("blocks:get-many:blockstore:put",n)),await this.child.put(n,i,e),e.onProgress?.(new et("blocks:get-many:providers:notify",n)),await Promise.all(this.components.blockBrokers.map(async s=>s.announce?.(n,i,e)))}}))}async delete(t,e={}){e.onProgress?.(new et("blocks:delete:blockstore:delete",t)),await this.child.delete(t,e)}async*deleteMany(t,e={}){e.onProgress?.(new et("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let n of t)yield n}(),e)}async has(t,e={}){return this.child.has(t,e)}async*getAll(t={}){t.onProgress?.(new et("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(t)}},Zi=class extends Yi{started;constructor(t){super(t),this.started=!1}isStarted(){return this.started}async start(){await Je(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await tr(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(t,e){let n=this.components.blockBrokers.map(o=>o.createSession==null?o:o.createSession(e));return new yu({blockstore:this.child,blockBrokers:n,getHasher:this.getHasher,logger:this.logger},{root:t})}},yu=class extends Yi{closeController;constructor(t,e){super(t),this.closeController=new AbortController,this.closeController.signal,this.log=t.logger.forComponent(`helia:session-storage:${e.root}`)}close(){this.closeController.abort()}async put(t,e,n={}){let o=Ft([this.closeController.signal,n.signal]);try{return await super.put(t,e,{...n,signal:o})}finally{o.clear()}}async*putMany(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{yield*super.putMany(t,{...e,signal:n})}finally{n.clear()}}async get(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{return await super.get(t,{...e,signal:n})}finally{n.clear()}}async*getMany(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{yield*super.getMany(t,{...e,signal:n})}finally{n.clear()}}async delete(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{await super.delete(t,{...e,signal:n})}finally{n.clear()}}async*deleteMany(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{yield*super.deleteMany(t,{...e,signal:n})}finally{n.clear()}}async has(t,e={}){let n=Ft([this.closeController.signal,e.signal]);try{return await super.has(t,{...e,signal:n})}finally{n.clear()}}async*getAll(t={}){let e=Ft([this.closeController.signal,t.signal]);try{yield*super.getAll({...t,signal:e})}finally{e.clear()}}};function Dw(r){return typeof r.retrieve=="function"}var Uw=(r,t)=>{if(t==null)throw new ht(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async e=>{let n,o=t.digest(e);if(bn(o)?n=await o:n=o,!Q(n.digest,r.multihash.digest))throw new Qe("Hash of downloaded block did not match multihash from passed CID")}};async function Vd(r,t,e,n){let o=Uw(r,e),i=new AbortController,s=Ft([i.signal,n.signal]);i.signal;let a=[];for(let c of t)Dw(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1,u=await c.retrieve(r,{...n,signal:s,validateFn:async f=>{await o(f),l=!0}});return l||await o(u),u}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{i.abort(),s.clear()}}var So=class extends Kr{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(t,e){super(),this.name=e.name,this.logger=t.logger,this.log=t.logger.forComponent(this.name),this.requests=new Map,this.minProviders=e.minProviders??1,this.maxProviders=e.maxProviders??5,this.providers=[],this.evictionFilter=xc(this.maxProviders),this.initialProviders=e.providers??[]}async retrieve(t,e={}){let n=_e.encode(t.multihash.bytes),o=this.requests.get(n);if(o!=null)return this.log("join existing request for %c",t),o;let i=ft();if(this.requests.set(n,i.promise),this.providers.length===0){let u=!1;this.initialPeerSearchComplete==null&&(u=!0,this.log=this.logger.forComponent(`${this.name}:${t}`),this.initialPeerSearchComplete=this.findProviders(t,this.minProviders,e)),await this.initialPeerSearchComplete,u&&this.log("found initial session peers for %c",t)}let s=!1,a=new Ne({concurrency:this.maxProviders});a.addEventListener("error",()=>{}),a.addEventListener("failure",u=>{this.log.error("error querying provider %o, evicting from session",u.detail.job.options.provider,u.detail.error),this.evict(u.detail.job.options.provider)}),a.addEventListener("success",u=>{s=!0,i.resolve(u.detail.result)}),a.addEventListener("idle",()=>{if(s||e.signal?.aborted===!0){this.log.trace("session idle, found block");return}Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",t);for(let u=0;u<this.minProviders&&this.providers.length!==0;u++){let f=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(f)}await this.findProviders(t,this.minProviders,e),this.log("found new providers re-retrieving %c",t),this.requests.delete(n),i.resolve(await this.retrieve(t,e))}).catch(u=>{this.log.error("could not find new providers for %c",t,u),i.reject(u)})});let c=u=>{a.add(async()=>this.queryProvider(t,u.detail,e),{provider:u.detail}).catch(f=>{e.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",t,f)})};this.addEventListener("provider",c),Promise.all([...this.providers].map(async u=>a.add(async()=>this.queryProvider(t,u,e),{provider:u}))).catch(u=>{e.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",t,u)});let l=()=>{i.reject(new se(e.signal?.reason??"Session aborted")),a.abort()};e.signal?.addEventListener("abort",l);try{return await i.promise}finally{this.removeEventListener("provider",c),e.signal?.removeEventListener("abort",l),a.clear(),this.requests.delete(n)}}evict(t){this.evictionFilter.add(this.toEvictionKey(t));let e=this.providers.findIndex(n=>this.equals(n,t));e!==-1&&this.providers.splice(e,1)}isEvicted(t){return this.evictionFilter.has(this.toEvictionKey(t))}hasProvider(t){return!!(this.providers.find(e=>this.equals(e,t))!=null||this.isEvicted(t))}async findProviders(t,e,n){let o=ft(),i=0;return Promise.resolve().then(async()=>{if(this.log("finding %d-%d new provider(s) for %c",e,this.maxProviders,t),this.initialProviders.length>0)for(;i<e&&this.initialProviders.length>0;){let s=this.initialProviders.pop();if(s==null)break;let a=await this.convertToProvider(s,n);if(n.signal?.aborted===!0)break;if(a!=null&&!this.hasProvider(a)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(a),this.safeDispatchEvent("provider",{detail:a}),i++,i===e&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(i<this.maxProviders)for await(let s of this.findNewProviders(t,n)){if(i===this.maxProviders||n.signal?.aborted===!0)break;if(!this.hasProvider(s)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(s),this.safeDispatchEvent("provider",{detail:s}),i++,i===e&&(this.log("session is ready"),o.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<e)throw new xo(`Found ${i} of ${e} ${this.name} providers for ${t}`)}).catch(s=>{this.log.error("error searching routing for potential session peers for %c",t,s.errors??s),o.reject(s)}),o.promise}};var Xi=class{blockstore;datastore;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(t){this.logger=t.logger??Jf(),this.log=this.logger.forComponent("helia"),this.getHasher=Kd(t.hashers,t.loadHasher),this.getCodec=Md(t.codecs,t.loadCodec),this.dns=t.dns??uh(),this.metrics=t.metrics;let e={blockstore:t.blockstore,datastore:t.datastore,logger:this.logger,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...t.components??{}};this.routing=e.routing=new Vi(e,{routers:(t.routers??[]).flatMap(o=>{let i=[o];return o[Rn]!=null&&i.push(o[Rn]),o[Dn]!=null&&i.push(o[Dn]),i}),providerLookupConcurrency:t.providerLookupConcurrency});let n=new Zi(e);this.pins=new $i(t.datastore,n,this.getCodec),this.blockstore=new qi(n,this.pins,{holdGcLock:t.holdGcLock??!0}),this.datastore=t.datastore,e.blockBrokers=t.blockBrokers.map(o=>o(e))}async start(){await Sd(this.datastore),await Je(this.blockstore,this.datastore,this.routing)}async stop(){await tr(this.blockstore,this.datastore,this.routing)}async gc(t={}){let e=await this.blockstore.lock.writeLock();try{let n=this,o=this.blockstore.unwrap();this.log("gc start"),await wr(o.deleteMany(async function*(){for await(let{cid:i}of o.getAll())try{if(await n.pins.isPinned(i,t))continue;yield i,t.onProgress?.(new et("helia:gc:deleted",i))}catch(s){n.log.error("Error during gc",s),t.onProgress?.(new et("helia:gc:error",s))}}()))}finally{e()}this.log("gc finished")}};var Qi=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let e=this.index,n=t();return n===void 0&&(this.index=e),n}parseWith(t){let e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let e=this.readChar();if(e===t)return e})}readSeparator(t,e,n){return this.readAtomically(()=>{if(!(e>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,e,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*o)-1;for(;;){let u=this.readAtomically(()=>{let f=this.readChar();if(f===void 0)return;let d=Number.parseInt(f,t);if(!Number.isNaN(d))return d});if(u===void 0)break;if(i*=t,i+=u,i>l||(s+=1,e!==void 0&&s>e))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let e=0;e<t.length;e++){let n=this.readSeparator(".",e,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[e]=n}return t})}readIPv6Addr(){let t=e=>{for(let n=0;n<e.length/2;n++){let o=n*2;if(n<e.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return e[o]=s[0],e[o+1]=s[1],e[o+2]=s[2],e[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];e[o]=i>>8,e[o+1]=i&255}return[e.length,!1]};return this.readAtomically(()=>{let e=new Uint8Array(16),[n,o]=t(e);if(n===16)return e;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=t(i.subarray(0,s));return e.set(i.subarray(0,a),16-a),e})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var qd=45,Fw=15,En=new Qi;function gu(r){if(!(r.length>Fw))return En.new(r).parseWith(()=>En.readIPv4Addr())}function wu(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>qd))return En.new(r).parseWith(()=>En.readIPv6Addr())}function Ji(r,t=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>qd)return;let e=En.new(r).parseWith(()=>En.readIPAddr());if(e)return t&&e.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,e[0],e[1],e[2],e[3]]):e}var cA=parseInt("0xFFFF",16),uA=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function vn(r){return!!gu(r)}function Sn(r){return!!wu(r)}function ts(r){return!!Ji(r)}var jd=vn,Vw=Sn,xu=function(r){let t=0;if(r=r.toString().trim(),jd(r)){let e=new Uint8Array(t+4);return r.split(/\./g).forEach(n=>{e[t++]=parseInt(n,10)&255}),e}if(Vw(r)){let e=r.split(":",8),n;for(n=0;n<e.length;n++){let i=jd(e[n]),s;i&&(s=xu(e[n]),e[n]=q(s.slice(0,2),"base16")),s!=null&&++n<8&&e.splice(n,0,q(s.slice(2,4),"base16"))}if(e[0]==="")for(;e.length<8;)e.unshift("0");else if(e[e.length-1]==="")for(;e.length<8;)e.push("0");else if(e.length<8){for(n=0;n<e.length&&e[n]!=="";n++);let i=[n,1];for(n=9-e.length;n>0;n--)i.push("0");e.splice.apply(e,i)}let o=new Uint8Array(t+16);for(n=0;n<e.length;n++){let i=parseInt(e[n],16);o[t++]=i>>8&255,o[t++]=i&255}return o}throw new Error("invalid ip address")},Gd=function(r,t=0,e){t=~~t,e=e??r.length-t;let n=new DataView(r.buffer);if(e===4){let o=[];for(let i=0;i<e;i++)o.push(r[t+i]);return o.join(".")}if(e===16){let o=[];for(let i=0;i<e;i+=2)o.push(n.getUint16(t+i).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var An={},bu={},zw=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]];zw.forEach(r=>{let t=Hw(...r);bu[t.code]=t,An[t.name]=t});function Hw(r,t,e,n,o){return{code:r,size:t,name:e,resolvable:!!n,path:!!o}}function G(r){if(typeof r=="number"){if(bu[r]!=null)return bu[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(An[r]!=null)return An[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var jA=G("ip4"),GA=G("ip6"),WA=G("ipcidr");function Au(r,t){switch(G(r).code){case 4:case 41:return Gw(t);case 42:return Su(t);case 43:return q(t,"base10");case 6:case 273:case 33:case 132:return Zd(t).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Su(t);case 421:return Xw(t);case 444:return Yd(t);case 445:return Yd(t);case 466:return Zw(t);case 481:return globalThis.encodeURIComponent(Su(t));default:return q(t,"base16")}}function _u(r,t){switch(G(r).code){case 4:return Wd(t);case 41:return Wd(t);case 42:return vu(t);case 43:return V(t,"base10");case 6:case 273:case 33:case 132:return Iu(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return vu(t);case 421:return Ww(t);case 444:return Qw(t);case 445:return Jw(t);case 466:return Yw(t);case 481:return vu(globalThis.decodeURIComponent(t));default:return V(t,"base16")}}var Eu=Object.values(Vn).map(r=>r.decoder),jw=function(){let r=Eu[0].or(Eu[1]);return Eu.slice(2).forEach(t=>r=r.or(t)),r}();function Wd(r){if(!ts(r))throw new Error("invalid ip address");return xu(r)}function Gw(r){let t=Gd(r,0,r.length);if(t==null)throw new Error("ipBuff is required");if(!ts(t))throw new Error("invalid ip address");return t}function Iu(r){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,r),new Uint8Array(t)}function Zd(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function vu(r){let t=V(r),e=Uint8Array.from(Vr(t.length));return Bt([e,t],e.length+t.length)}function Su(r){let t=xr(r);if(r=r.slice(qt(t)),r.length!==t)throw new Error("inconsistent lengths");return q(r)}function Ww(r){let t;r[0]==="Q"||r[0]==="1"?t=fe(ot.decode(`z${r}`)).bytes:t=K.parse(r).multihash.bytes;let e=Uint8Array.from(Vr(t.length));return Bt([e,t],e.length+t.length)}function Yw(r){let t=jw.decode(r),e=Uint8Array.from(Vr(t.length));return Bt([e,t],e.length+t.length)}function Zw(r){let t=xr(r),e=r.slice(qt(t));if(e.length!==t)throw new Error("inconsistent lengths");return"u"+q(e,"base64url")}function Xw(r){let t=xr(r),e=r.slice(qt(t));if(e.length!==t)throw new Error("inconsistent lengths");return q(e,"base58btc")}function Qw(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let e=At.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Iu(n);return Bt([e,o],e.length+o.length)}function Jw(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let e=At.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Iu(n);return Bt([e,o],e.length+o.length)}function Yd(r){let t=r.slice(0,r.length-2),e=r.slice(r.length-2),n=q(t,"base32"),o=Zd(e);return`${n}:${o}`}function Xd(r){r=Tu(r);let t=[],e=[],n=null,o=r.split("/").slice(1);if(o.length===1&&o[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<o.length;i++){let s=o[i],a=G(s);if(a.size===0){t.push([a.code]),e.push([a.code]);continue}if(i++,i>=o.length)throw new es("invalid address: "+r);if(a.path===!0){n=Tu(o.slice(i).join("/")),t.push([a.code,_u(a.code,n)]),e.push([a.code,n]);break}let c=_u(a.code,o[i]);t.push([a.code,c]),e.push([a.code,Au(a.code,c)])}return{string:Qd(e),bytes:rs(t),tuples:t,stringTuples:e,path:n}}function ku(r){let t=[],e=[],n=null,o=0;for(;o<r.length;){let i=xr(r,o),s=qt(i),a=G(i),c=tx(a,r.slice(o+s));if(c===0){t.push([i]),e.push([i]),o+=s;continue}let l=r.slice(o+s,o+s+c);if(o+=c+s,o>r.length)throw new es("Invalid address Uint8Array: "+q(r,"base16"));t.push([i,l]);let u=Au(i,l);if(e.push([i,u]),a.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:Qd(e),tuples:t,stringTuples:e,path:n}}function Qd(r){let t=[];return r.map(e=>{let n=G(e[0]);return t.push(n.name),e.length>1&&e[1]!=null&&t.push(e[1]),null}),Tu(t.join("/"))}function rs(r){return Bt(r.map(t=>{let e=G(t[0]),n=Uint8Array.from(Vr(e.code));return t.length>1&&t[1]!=null&&(n=Bt([n,t[1]])),n}))}function tx(r,t){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let e=xr(t instanceof Uint8Array?t:Uint8Array.from(t));return e+qt(e)}}function Tu(r){return"/"+r.trim().split("/").filter(t=>t).join("/")}var es=class extends Error{static name="ParseError";name="ParseError";constructor(t){super(`Error parsing address: ${t}`)}};var ex=Symbol.for("nodejs.util.inspect.custom"),Pu=Symbol.for("@multiformats/js-multiaddr/multiaddr"),rx=[G("dns").code,G("dns4").code,G("dns6").code,G("dnsaddr").code],Cu=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}},ns=class r{bytes;#t;#e;#r;#o;[Pu]=!0;constructor(t){t==null&&(t="");let e;if(t instanceof Uint8Array)e=ku(t);else if(typeof t=="string"){if(t.length>0&&t.charAt(0)!=="/")throw new Error(`multiaddr "${t}" must start with a "/"`);e=Xd(t)}else if(tp(t))e=ku(t.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=e.bytes,this.#t=e.string,this.#e=e.tuples,this.#r=e.stringTuples,this.#o=e.path}toString(){return this.#t}toJSON(){return this.toString()}toOptions(){let t,e,n,o,i="",s=G("tcp"),a=G("udp"),c=G("ip4"),l=G("ip6"),u=G("dns6"),f=G("ip6zone");for(let[x,C]of this.stringTuples())x===f.code&&(i=`%${C??""}`),rx.includes(x)&&(e=s.name==="tcp"?"tcp":"udp",o=443,n=`${C??""}${i}`,t=x===u.code?6:4),(x===s.code||x===a.code)&&(e=G(x).name==="tcp"?"tcp":"udp",o=parseInt(C??"")),(x===c.code||x===l.code)&&(e=G(x).name==="tcp"?"tcp":"udp",n=`${C??""}${i}`,t=x===l.code?6:4);if(t==null||e==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:e,port:o}}protos(){return this.#e.map(([t])=>Object.assign({},G(t)))}protoCodes(){return this.#e.map(([t])=>t)}protoNames(){return this.#e.map(([t])=>G(t).name)}tuples(){return this.#e.map(([t,e])=>e==null?[t]:[t,e])}stringTuples(){return this.#r.map(([t,e])=>e==null?[t]:[t,e])}encapsulate(t){return t=new r(t),new r(this.toString()+t.toString())}decapsulate(t){let e=t.toString(),n=this.toString(),o=n.lastIndexOf(e);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new r(n.slice(0,o))}decapsulateCode(t){let e=this.tuples();for(let n=e.length-1;n>=0;n--)if(e[n][0]===t)return new r(rs(e.slice(0,n)));return this}getPeerId(){try{let t=[];this.stringTuples().forEach(([n,o])=>{n===An.p2p.code&&t.push([n,o]),n===An["p2p-circuit"].code&&(t=[])});let e=t.pop();if(e?.[1]!=null){let n=e[1];return n[0]==="Q"||n[0]==="1"?q(ot.decode(`z${n}`),"base58btc"):q(K.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#o}equals(t){return Q(this.bytes,t.bytes)}async resolve(t){let e=this.protos().find(i=>i.resolvable);if(e==null)return[this];let n=Jd.get(e.name);if(n==null)throw new Cu(`no available resolver for ${e.name}`);return(await n(this,t)).map(i=>We(i))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){let e=(t??this).protos();return!(e.length!==2||e[0].code!==4&&e[0].code!==41||e[1].code!==6&&e[1].code!==273)}[ex](){return`Multiaddr(${this.#t})`}};var Jd=new Map;function tp(r){return!!r?.[Pu]}function We(r){return new ns(r)}var nx=[G("tcp").code,G("dns").code,G("dnsaddr").code,G("dns4").code,G("dns6").code];function ep(r){return op("sni",r)?.[1]}function rp(r){let t=op("tcp",r)?.[1];return t==null?"":`:${t}`}function op(r,t){let e;try{e=G(r).code}catch{return}for(let[n,o]of t)if(n===e&&o!=null)return[n,o]}function np(r){return r.some(([t,e])=>t===G("tls").code)}function xe(r,t,e){let n=ip[G(r).name];if(n==null)throw new Error(`Can't interpret protocol ${G(r).name}`);let o=n(t,e);return r===G("ip6").code?`[${o}]`:o}var ip={ip4:(r,t)=>r,ip6:(r,t)=>t.length===0?r:`[${r}]`,tcp:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return`tcp://${xe(e[0],e[1]??"",t)}:${r}`},udp:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return`udp://${xe(e[0],e[1]??"",t)}:${r}`},dnsaddr:(r,t)=>r,dns4:(r,t)=>r,dns6:(r,t)=>r,dns:(r,t)=>r,ipfs:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return`${xe(e[0],e[1]??"",t)}`},p2p:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return`${xe(e[0],e[1]??"",t)}`},http:(r,t)=>{let e=np(t),n=ep(t),o=rp(t);if(e&&n!=null)return`https://${n}${o}`;let i=e?"https://":"http://",s=t.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=xe(s[0],s[1]??"",t);return a=a.replace("tcp://",""),`${i}${a}`},"http-path":(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");let n=xe(e[0],e[1]??"",t),o=decodeURIComponent(r);return`${n}/${o}`},tls:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return xe(e[0],e[1]??"",t)},sni:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");return xe(e[0],e[1]??"",t)},https:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");let n=xe(e[0],e[1]??"",t);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,t)=>{let e=np(t),n=ep(t),o=rp(t);if(e&&n!=null)return`wss://${n}${o}`;let i=e?"wss://":"ws://",s=t.pop();if(s==null)throw new Error("Unexpected end of multiaddr");let a=xe(s[0],s[1]??"",t);return a=a.replace("tcp://",""),`${i}${a}`},wss:(r,t)=>{let e=t.pop();if(e==null)throw new Error("Unexpected end of multiaddr");let n=xe(e[0],e[1]??"",t);return n=n.replace("tcp://",""),`wss://${n}`}};function os(r,t){let n=We(r).stringTuples(),o=n.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let i=G(o[0]),s=ip[i.name];if(s==null)throw new Error(`No interpreter found for ${i.name}`);let a=s(o[1]??"",n);return t?.assumeHttp!==!1&&nx.includes(o[0])&&(a=a.replace(/^.*:\/\//,""),o[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}var _n=class{url;#t=0;#e=0;#r=0;#o=0;#a=new Map;log;transformRequestInit;constructor(t,{logger:e,transformRequestInit:n}){this.url=t instanceof URL?t:new URL(t),this.transformRequestInit=n,this.log=e.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#u(t){let e=t.multihash.bytes;return _e.encode(e)}async getRawBlock(t,e){let n=new URL(this.url.toString());if(n.pathname=`/ipfs/${t.toString()}`,n.search="?format=raw",e?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${t} from gateway ${this.url} was aborted prior to fetch`);let o=this.#u(t),i=new AbortController,s=()=>{i.abort()};e?.addEventListener("abort",s);try{let a=this.#a.get(o);if(a==null){this.#t++;let c={signal:i.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},l=this.transformRequestInit!=null?await this.transformRequestInit(c):c;a=fetch(n.toString(),l).then(async u=>{if(this.log("GET %s %d",n,u.status),!u.ok)throw this.#e++,new Error(`unable to fetch raw block for CID ${t} from gateway ${this.url}`);return this.#o++,new Uint8Array(await u.arrayBuffer())}),this.#a.set(o,a)}return await a}catch{throw e?.aborted===!0?new Error(`fetching raw block for CID ${t} from gateway ${this.url} was aborted`):(this.#e++,new Error(`unable to fetch raw block for CID ${t}`))}finally{e?.removeEventListener("abort",s),this.#a.delete(o)}}reliability(){return this.#t===0?1:this.#r>0?-1/0:this.#o/(this.#t+this.#e*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#t,errors:this.#e,invalidBlocks:this.#r,successes:this.#o,pendingResponses:this.#a.size}}};var ap=Nn(sp(),1),ox=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],ix=ox.map(r=>new ap.Netmask(r));function Bu(r){for(let t of ix)if(t.contains(r))return!0;return!1}function sx(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function ax(r){let t=r.split(":");if(t.length<2)return!1;let e=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(e.substring(0,2),16)}.${parseInt(e.substring(2),16)}`;return Bu(o)}function cx(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function ux(r){let t=r.split(":"),e=t[t.length-1];return Bu(e)}function lx(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function cp(r){return vn(r)?Bu(r):sx(r)?ax(r):cx(r)?ux(r):Sn(r)?lx(r):void 0}var fx=r=>r.toString().split("/").slice(1),In=r=>({match:t=>t.length<1?!1:r(t[0])?t.slice(1):!1,pattern:"fn"}),W=r=>({match:t=>In(e=>e===r).match(t),pattern:r}),Ur=()=>({match:r=>In(t=>typeof t=="string").match(r),pattern:"{string}"}),Tn=()=>({match:r=>In(t=>!isNaN(parseInt(t))).match(r),pattern:"{number}"}),st=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{ot.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),_o=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{sa.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),rt=r=>({match:t=>{let e=r.match(t);return e===!1?t:e},pattern:`optional(${r.pattern})`}),Ut=(...r)=>({match:t=>{let e;for(let n of r){let o=n.match(t);o!==!1&&(e==null||o.length<e.length)&&(e=o)}return e??!1},pattern:`or(${r.map(t=>t.pattern).join(", ")})`}),Z=(...r)=>({match:t=>{for(let e of r){let n=e.match(t);if(n===!1)return!1;t=n}return t},pattern:`and(${r.map(t=>t.pattern).join(", ")})`});function lt(...r){function t(o){let i=fx(o);for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function e(o){return t(o)!==!1}function n(o){let i=t(o);return i===!1?!1:i.length===0}return{matchers:r,matches:e,exactMatch:n}}var hx=st(),L_=lt(hx),ss=Z(W("dns4"),Ur()),as=Z(W("dns6"),Ur()),cs=Z(W("dnsaddr"),Ur()),Nu=Z(W("dns"),Ur()),N_=lt(ss,rt(st())),R_=lt(as,rt(st())),D_=lt(cs,rt(st())),up=lt(Ut(Nu,cs,ss,as),rt(st())),lp=Z(W("ip4"),In(vn)),fp=Z(W("ip6"),In(Sn)),Ru=Ut(lp,fp),Ye=Ut(Ru,Nu,ss,as,cs),U_=lt(Ut(Ru,Z(Ut(Nu,cs,ss,as),rt(st())))),F_=lt(lp),O_=lt(fp),M_=lt(Ru),Du=Z(Ye,W("tcp"),Tn()),Io=Z(Ye,W("udp"),Tn()),K_=lt(Z(Du,rt(st()))),$_=lt(Io),Uu=Z(Io,W("quic"),rt(st())),us=Z(Io,W("quic-v1"),rt(st())),dx=Ut(Uu,us),V_=lt(Uu),q_=lt(us),Lu=Ut(Ye,Du,Io,Uu,us),hp=Ut(Z(Lu,W("ws"),rt(st()))),z_=lt(hp),dp=Ut(Z(Lu,W("wss"),rt(st())),Z(Lu,W("tls"),rt(Z(W("sni"),Ur())),W("ws"),rt(st()))),H_=lt(dp),pp=Z(Io,W("webrtc-direct"),rt(_o()),rt(_o()),rt(st())),j_=lt(pp),mp=Z(us,W("webtransport"),rt(_o()),rt(_o()),rt(st())),G_=lt(mp),is=Ut(hp,dp,Z(Du,rt(st())),Z(dx,rt(st())),Z(Ye,rt(st())),pp,mp,st()),W_=lt(is),px=Z(is,W("p2p-circuit"),st()),Y_=lt(px),mx=Ut(Z(is,W("p2p-circuit"),W("webrtc"),rt(st())),Z(is,W("webrtc"),rt(st())),Z(W("webrtc"),rt(st()))),Z_=lt(mx),yx=Ut(Z(Ye,W("tcp"),Tn(),W("http"),rt(st())),Z(Ye,W("http"),rt(st()))),yp=lt(yx),gx=Ut(Z(Ye,W("tcp"),Ut(Z(W("443"),W("http")),Z(Tn(),W("https")),Z(Tn(),W("tls"),W("http"))),rt(st())),Z(Ye,W("tls"),W("http"),rt(st())),Z(Ye,W("https"),rt(st()))),gp=lt(gx),wx=Ut(Z(W("memory"),Ur(),rt(st()))),X_=lt(wx);function Fu(r,t,e){return r.filter(n=>{if(gp.matches(n)||t&&yp.matches(n))return e||up.matches(n)?!0:cp(n.toOptions().host)===!1;if(!t&&e){let{host:o}=n.toOptions();if(o==="127.0.0.1"||o==="localhost"||o.endsWith(".localhost"))return!0}return!1})}async function*ls(r,t,e,n,o,i={}){for await(let s of t.findProviders(r,i)){let a=Fu(s.multiaddrs,n,o);if(a.length===0)continue;let c=os(a[0]);yield new _n(c,{logger:e,transformRequestInit:i.transformRequestInit})}}var Ou=class extends So{routing;allowInsecure;allowLocal;transformRequestInit;constructor(t,e){super(t,{...e,name:"helia:trustless-gateway:session"}),this.routing=t.routing,this.allowInsecure=e.allowInsecure??fs,this.allowLocal=e.allowLocal??hs,this.transformRequestInit=e.transformRequestInit}async queryProvider(t,e,n){this.log("fetching BLOCK for %c from %s",t,e.url);let o=await e.getRawBlock(t,n.signal);return this.log.trace("got block for %c from %s",t,e.url),await n.validateFn?.(o),o}async*findNewProviders(t,e={}){yield*ls(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...e,transformRequestInit:this.transformRequestInit})}toEvictionKey(t){return t.url.toString()}equals(t,e){return t.url.toString()===e.url.toString()}async convertToProvider(t,e){if(Ju(t))return;let n=Fu(Array.isArray(t)?t:[t],this.allowInsecure,this.allowLocal);if(n.length===0)return;let o=os(n[0]);return new _n(o,{logger:this.logger,transformRequestInit:this.transformRequestInit})}};function wp(r,t){return new Ou(r,t)}var ds=class{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(t,e={}){this.log=t.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=t.logger,this.routing=t.routing,this.allowInsecure=e.allowInsecure??fs,this.allowLocal=e.allowLocal??hs,this.transformRequestInit=e.transformRequestInit}async retrieve(t,e={}){let n=[];for await(let o of ls(t,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...e,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",t,o.url);try{let i=await o.getRawBlock(t,e.signal);this.log.trace("got block for %c from %s",t,o.url);try{await e.validateFn?.(i)}catch(s){this.log.error("failed to validate block for %c from %s",t,o.url,s);continue}return i}catch(i){if(this.log.error("failed to get block for %c from %s",t,o.url,i),i instanceof Error?n.push(i):n.push(new Error(`Unable to fetch raw block for CID ${t} from gateway ${o.url}`)),e.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",t,o.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${t} from any gateway`):new Error(`Unable to fetch raw block for CID ${t} from any gateway`)}createSession(t={}){return wp({logger:this.logger,routing:this.routing},{...t,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}};var fs=!1,hs=!1;function ps(r={}){return t=>new ds(t,r)}async function*ms(r,t={}){let e=r.getReader();try{for(;;){let n=await e.read();if(n.done)return;yield n.value}}finally{t.preventCancel!==!0&&await e.cancel(),e.releaseLock()}}var Ax=Nn(Ku(),1);var be=class extends Error{static name="SignatureVerificationError";constructor(t="Record signature verification failed"){super(t),this.name="SignatureVerificationError"}},ys=class extends Error{static name="RecordExpiredError";constructor(t="Record has expired"){super(t),this.name="RecordExpiredError"}},kn=class extends Error{static name="UnsupportedValidityError";constructor(t="The validity type is unsupported"){super(t),this.name="UnsupportedValidityError"}},gs=class extends Error{static name="RecordTooLargeError";constructor(t="The record is too large"){super(t),this.name="RecordTooLargeError"}},ws=class extends Error{static name="InvalidValueError";constructor(t="Value must be a valid content path starting with /"){super(t),this.name="InvalidValueError"}},xs=class extends Error{static name="InvalidRecordDataError";constructor(t="Invalid record data"){super(t),this.name="InvalidRecordDataError"}},To=class extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(t="Invalid embedded public key"){super(t),this.name="InvalidEmbeddedPublicKeyError"}};var Ee;(function(r){let t;(function(o){o.EOL="EOL"})(t=r.ValidityType||(r.ValidityType={}));let e;(function(o){o[o.EOL=0]="EOL"})(e||(e={})),function(o){o.codec=()=>Hn(e)}(t=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=Jr((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.value!=null&&(i.uint32(10),i.bytes(o.value)),o.signatureV1!=null&&(i.uint32(18),i.bytes(o.signatureV1)),o.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(o.validityType,i)),o.validity!=null&&(i.uint32(34),i.bytes(o.validity)),o.sequence!=null&&(i.uint32(40),i.uint64(o.sequence)),o.ttl!=null&&(i.uint32(48),i.uint64(o.ttl)),o.pubKey!=null&&(i.uint32(58),i.bytes(o.pubKey)),o.signatureV2!=null&&(i.uint32(66),i.bytes(o.signatureV2)),o.data!=null&&(i.uint32(74),i.bytes(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.value=o.bytes();break}case 2:{a.signatureV1=o.bytes();break}case 3:{a.validityType=r.ValidityType.codec().decode(o);break}case 4:{a.validity=o.bytes();break}case 5:{a.sequence=o.uint64();break}case 6:{a.ttl=o.uint64();break}case 7:{a.pubKey=o.bytes();break}case 8:{a.signatureV2=o.bytes();break}case 9:{a.data=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Xr(o,r.codec()),r.decode=(o,i)=>jr(o,r.codec(),i)})(Ee||(Ee={}));var xx=Zt("ipns:utils"),xp=V("/ipns/");var bx=0,Ex=18;function bp(r){let t;if(r.pubKey!=null)try{t=qf(r.pubKey)}catch(e){throw xx.error(e),e}if(t!=null)return t}function Ep(r){let t=V("ipns-signature:");return Bt([t,r])}function Fr(r){return"signatureV1"in r?Ee.encode({value:V(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:V(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):Ee.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function Le(r){let t=Ee.decode(r);if(t.sequence!=null&&(t.sequence=BigInt(t.sequence)),t.ttl!=null&&(t.ttl=BigInt(t.ttl)),t.signatureV2==null||t.data==null)throw new be("Missing data or signatureV2");let e=vp(t.data),n=vx(e.Value),o=q(e.Validity);if(t.value!=null&&t.signatureV1!=null)return Sx(t),{value:n,validityType:Ee.ValidityType.EOL,validity:o,sequence:e.Sequence,ttl:e.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(t.signatureV2!=null)return{value:n,validityType:Ee.ValidityType.EOL,validity:o,sequence:e.Sequence,ttl:e.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function ko(r){return Bt([xp,r.bytes])}function Ze(r){let t=fe(r.slice(xp.length));if(!bs(t,bx)&&!bs(t,Ex))throw new Qe("Multihash in IPNS key was not identity or sha2-256");return t}function vp(r){let t=ee(r);if(t.ValidityType===0)t.ValidityType=Ee.ValidityType.EOL;else throw new kn("The validity type is unsupported");return Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t}function vx(r){let t=q(r).trim();if(t.startsWith("/"))return t;try{return`/ipfs/${K.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${K.parse(t).toV1().toString()}`}catch{}throw new ws("Value must be a valid content path starting with /")}function Sx(r){if(r.data==null)throw new xs("Record data is missing");let t=vp(r.data);if(!Q(t.Value,r.value??new Uint8Array(0)))throw new be('Field "value" did not match between protobuf and CBOR');if(!Q(t.Validity,r.validity??new Uint8Array(0)))throw new be('Field "validity" did not match between protobuf and CBOR');if(t.ValidityType!==r.validityType)throw new be('Field "validityType" did not match between protobuf and CBOR');if(t.Sequence!==r.sequence)throw new be('Field "sequence" did not match between protobuf and CBOR');if(t.TTL!==r.ttl)throw new be('Field "ttl" did not match between protobuf and CBOR')}function bs(r,t){return r.code===t}var VI=Zt("ipns"),qI=5*60*1e9,_x="/ipns/",zI=_x.length;var Sp=Nn(Ku(),1);var Es=Zt("ipns:validator"),Ix=1024*10,Tx=async(r,t)=>{let e=Le(t),n;try{let o=Ep(e.data);n=await r.verify(o,e.signatureV2)}catch{n=!1}if(!n)throw Es.error("record signature verification failed"),new be("Record signature verification failed");if(e.validityType===Ee.ValidityType.EOL){if(Sp.default.fromString(e.validity).toDate().getTime()<Date.now())throw Es.error("record has expired"),new ys("record has expired")}else if(e.validityType!=null)throw Es.error("the validity type is unsupported"),new kn("The validity type is unsupported");Es("ipns record for %s is valid",e.value)};async function Ap(r,t){if(t.byteLength>Ix)throw new gs("The record is too large");let e=Ze(r),n;bs(e,0)&&(n=di(e));let o=Le(t),i=bp(o)??n;if(i==null)throw new To("Could not extract public key from IPNS record or routing key");let s=ko(i.toMultihash());if(!Q(s,r))throw new To("Embedded public key did not match routing key");await Tx(i,t)}var vs=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"};async function*Co(r,t={}){let e=/\r?\n/,n=new TextDecoder("utf8"),o="";for await(let i of r){if(typeof i=="string"&&(i=new TextEncoder().encode(i)),qr(i)&&(i=i.subarray()),o+=n.decode(i,{stream:!0}),o.length>(t?.maxMessageLength??o.length))throw new vs("Incoming message too long");let s=o.split(e);o=s.pop()??"";for(let a=0;a<s.length;a++)yield JSON.parse(s[a])}o+=n.decode(),o!==""&&(yield JSON.parse(o))}var Cn=class extends Error{static name="InvalidRequestError";constructor(t="Invalid request"){super(t),this.name="InvalidRequestError"}},ve=class extends Error{static name="BadResponseError";constructor(t="Bad response"){super(t),this.name="BadResponseError"}};function kx(r){return r[Symbol.asyncIterator]!=null}function Cx(r){if(kx(r))return(async()=>{for await(let t of r)return t})();for(let t of r)return t}var Ss=Cx;var _p=V("/ipns/");function Ip(r){return Q(r.subarray(0,_p.byteLength),_p)}var As=class{client;constructor(t){this.client=t}async*findProviders(t,e={}){yield*Hr(this.client.getProviders(t,e),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(t,e,n){if(!Ip(t))return;let o=Ze(t),i=K.createV1(114,o),s=Le(e);await this.client.putIPNS(i,s,n)}async get(t,e){if(!Ip(t))throw new Ct("Not found");let n=Ze(t),o=K.createV1(114,n);try{let i=await this.client.getIPNS(o,e);return Fr(i)}catch(i){throw i.name==="BadResponseError"?new Ct("Not found"):i}}},_s=class{client;constructor(t){this.client=t}async findPeer(t,e={}){let n=await Ss(this.client.getPeers(t,e));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new Ct("Not found")}async*getClosestPeers(t,e={}){}};var Tt=Zt("delegated-routing-v1-http-api-client"),Is={concurrentRequests:4,timeout:3e4,cacheTTL:5*60*1e3,cacheName:"delegated-routing-v1-cache"},Ts=class{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(t,e={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new Pe({concurrency:e.concurrentRequests??Is.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=t instanceof URL?t:new URL(t),this.timeout=e.timeout??Is.timeout,this.filterAddrs=e.filterAddrs,this.filterProtocols=e.filterProtocols,this.contentRouting=new As(this),this.peerRouting=new _s(this),this.cacheName=e.cacheName??Is.cacheName,this.cacheTTL=e.cacheTTL??Is.cacheTTL}get[Rn](){return this.contentRouting}get[Dn](){return this.peerRouting}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await globalThis.caches?.open(this.cacheName),this.cache!=null&&Tt("cache enabled with ttl %d",this.cacheTTL)))}async stop(){this.httpQueue.clear(),this.shutDownController.abort(),await globalThis.caches?.delete(this.cacheName),this.started=!1}async*getProviders(t,e={}){Tt("getProviders starts: %c",t);let n=AbortSignal.timeout(this.timeout),o=Ft([this.shutDownController.signal,n,e.signal]);let i=ft(),s=ft();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let a=new URL(`${this.clientUrl}routing/v1/providers/${t.toString()}`);this.#e(a,e.filterAddrs,e.filterProtocols);let c={headers:{Accept:"application/x-ndjson"},signal:o},l=await this.#r(a.toString(),c);if(l==null)throw new ve("No response received");if(!l.ok)throw l.status===404?new Ct("No matching records found"):l.status===422?new Cn("Request does not conform to schema or semantic constraints"):new ve(`Unexpected status code: ${l.status}`);if(l.body==null)throw new ve("Routing response had no body");let u=l.headers.get("Content-Type");if(u==null)throw new ve("No Content-Type header received");if(u?.startsWith("application/json")){let f=await l.json();for(let d of f.Providers){let x=this.#t(d);x!=null&&(yield x)}}else if(u.includes("application/x-ndjson"))for await(let f of Co(ms(l.body))){let d=this.#t(f);d!=null&&(yield d)}else throw new ve(`Unsupported Content-Type: ${u}`)}finally{o.clear(),s.resolve(),Tt("getProviders finished: %c",t)}}async*getPeers(t,e={}){Tt("getPeers starts: %c",t);let n=AbortSignal.timeout(this.timeout),o=Ft([this.shutDownController.signal,n,e.signal]);let i=ft(),s=ft();this.httpQueue.add(async()=>(i.resolve(),s.promise));try{await i.promise;let a=new URL(`${this.clientUrl}routing/v1/peers/${t.toCID().toString()}`);this.#e(a,e.filterAddrs,e.filterProtocols);let c={headers:{Accept:"application/x-ndjson"},signal:o},l=await this.#r(a.toString(),c);if(l.status===404)throw new Ct("No matching records found");if(l.status===422)throw new Cn("Request does not conform to schema or semantic constraints");if(l.body==null)throw new ve("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){let f=await l.json();for(let d of f.Peers){let x=this.#t(d);x!=null&&(yield x)}}else for await(let f of Co(ms(l.body))){let d=this.#t(f);d!=null&&(yield d)}}catch(a){Tt.error("getPeers errored:",a)}finally{o.clear(),s.resolve(),Tt("getPeers finished: %c",t)}}async getIPNS(t,e={}){Tt("getIPNS starts: %s",t);let n=AbortSignal.timeout(this.timeout),o=Ft([this.shutDownController.signal,n,e.signal]);let i=ft(),s=ft();this.httpQueue.add(async()=>(i.resolve(),s.promise));let a=`${this.clientUrl}routing/v1/ipns/${t}`;try{await i.promise;let c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:o},l=await this.#r(a,c);if(Tt("getIPNS GET %s %d",a,l.status),l.status===404)throw new Ct("No matching records found");if(l.status===422)throw new Cn("Request does not conform to schema or semantic constraints");if(l.body==null)throw new ve("GET ipns response had no body");let u=await l.arrayBuffer(),f=new Uint8Array(u,0,u.byteLength);return e.validate!==!1&&await Ap(ko(t.multihash),f),Le(f)}catch(c){throw Tt.error("getIPNS GET %s error:",a,c),c}finally{o.clear(),s.resolve(),Tt("getIPNS finished: %s",t)}}async putIPNS(t,e,n={}){Tt("putIPNS starts: %c",t);let o=AbortSignal.timeout(this.timeout),i=Ft([this.shutDownController.signal,o,n.signal]);let s=ft(),a=ft();this.httpQueue.add(async()=>(s.resolve(),a.promise));let c=`${this.clientUrl}routing/v1/ipns/${t}`;try{await s.promise;let l=Fr(e),u={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:i},f=await this.#r(c,u);if(Tt("putIPNS PUT %s %d",c,f.status),f.status!==200)throw new ve("PUT ipns response had status other than 200")}catch(l){throw Tt.error("putIPNS PUT %s error:",c,l.stack),l}finally{i.clear(),a.resolve(),Tt("putIPNS finished: %c",t)}}#t(t){try{let e=[],n=t.Addrs?.map(We)??[];return t.Protocols!=null&&e.push(...t.Protocols),t.Protocol!=null&&(e.push(t.Protocol),delete t.Protocol),{...t,Schema:"peer",ID:jf(t.ID),Addrs:n,Protocols:e}}catch(e){Tt.error("could not conform record to peer schema",e)}}#e(t,e,n){if(e!=null||this.filterAddrs!=null){let o=e?.join(",")??this.filterAddrs?.join(",")??"";o!==""&&t.searchParams.set("filter-addrs",o)}if(n!=null||this.filterProtocols!=null){let o=n?.join(",")??this.filterProtocols?.join(",")??"";o!==""&&t.searchParams.set("filter-protocols",o)}}async#r(t,e){let n=e.method??"GET",o=`${n}-${t}`;if(n==="GET"){let c=await this.cache?.match(t);if(c!=null){if(parseInt(c.headers.get("x-cache-expires")??"0",10)>Date.now())return Tt("returning cached response for %s",o),c;await this.cache?.delete(t)}}let i=this.inFlightRequests.get(o);if(i!=null){let c=await i;return Tt("deduplicating outgoing request for %s",o),c.clone()}let s=fetch(t,e).then(async c=>{if(this.cache!=null&&c.ok&&n==="GET"){let l=Date.now()+this.cacheTTL,u=new Headers(c.headers);u.set("x-cache-expires",l.toString());let f=new Response(c.clone().body,{status:c.status,statusText:c.statusText,headers:u});await this.cache.put(t,f)}return c}).finally(()=>{this.inFlightRequests.delete(o)});return this.inFlightRequests.set(o,s),await s}};function Tp(r,t={}){return new Ts(new URL(r),t)}function kp(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}var Cp=V("/ipns/");function Pp(r){return Q(r.subarray(0,Cp.byteLength),Cp)}var $u=class{client;constructor(t,e={}){this.client=Tp(t,e)}async provide(t,e){}async cancelReprovide(t,e){}async*findProviders(t,e){yield*Hr(this.client.getProviders(t,e),n=>({id:n.ID,multiaddrs:n.Addrs,protocols:n.Protocols}))}async put(t,e,n){if(!Pp(t))return;let o=Ze(t),i=K.createV1(114,o),s=Le(e);await this.client.putIPNS(i,s,n)}async get(t,e){if(!Pp(t))throw new Ct("Not found");let n=Ze(t),o=K.createV1(114,n);try{let i=await this.client.getIPNS(o,e);return Fr(i)}catch(i){throw i.name==="BadResponseError"?new Ct("Not found"):i}}async findPeer(t,e){let n=await Ss(this.client.getPeers(t,e));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new Ct("Not found")}async*getClosestPeers(t,e){}};function ks(r,t){let e=t??kp();return new $u(new URL(r),e)}var Bp="[a-fA-F\\d:]",gr=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${Bp})|(?<=${Bp})(?=\\s|$))`:"",Se="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",gt="[a-fA-F\\d]{1,4}",Cs=`
(?:
(?:${gt}:){7}(?:${gt}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${gt}:){6}(?:${Se}|:${gt}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${gt}:){5}(?::${Se}|(?::${gt}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${gt}:){4}(?:(?::${gt}){0,1}:${Se}|(?::${gt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${gt}:){3}(?:(?::${gt}){0,2}:${Se}|(?::${gt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${gt}:){2}(?:(?::${gt}){0,3}:${Se}|(?::${gt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${gt}:){1}(?:(?::${gt}){0,4}:${Se}|(?::${gt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${gt}){0,5}:${Se}|(?::${gt}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Px=new RegExp(`(?:^${Se}$)|(?:^${Cs}$)`),Bx=new RegExp(`^${Se}$`),Lx=new RegExp(`^${Cs}$`),Vu=r=>r&&r.exact?Px:new RegExp(`(?:${gr(r)}${Se}${gr(r)})|(?:${gr(r)}${Cs}${gr(r)})`,"g");Vu.v4=r=>r&&r.exact?Bx:new RegExp(`${gr(r)}${Se}${gr(r)}`,"g");Vu.v6=r=>r&&r.exact?Lx:new RegExp(`${gr(r)}${Cs}${gr(r)}`,"g");var qu=Vu;function zu(r){let t=(...e)=>r(...e);return Object.defineProperty(t,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),t}function Lp(){return!1}var{toString:Nx}=Object.prototype;function Hu(r){return Nx.call(r)==="[object RegExp]"}var Np={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function ju(r,t={}){if(!Hu(r))throw new TypeError("Expected a RegExp instance");let e=Object.keys(Np).map(o=>(typeof t[o]=="boolean"?t[o]:r[o])?Np[o]:"").join(""),n=new RegExp(t.source||r.source,e);return n.lastIndex=typeof t.lastIndex=="number"?t.lastIndex:r.lastIndex,n}function Gu(r,t,{timeout:e}={}){try{return zu(()=>ju(r).test(t),{timeout:e})()}catch(n){if(Lp(n))return!1;throw n}}var Rx=15,Dx=45,Rp={timeout:400};function Wu(r){return r.length>Dx?!1:Gu(qu.v6({exact:!0}),r,Rp)}function Dp(r){return r.length>Rx?!1:Gu(qu.v4({exact:!0}),r,Rp)}var Up={http:"80",https:"443",ws:"80",wss:"443"},Ux=["http","https","ws","wss"];function Fp(r,t){t=t??{};let e=t.defaultDnsType??"dns",{scheme:n,hostname:o,port:i,path:s}=Fx(r),a=[Ox(o,e),Mx(i,n),Kx(n)];s!=null&&a.push($x(s));let c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return We(c)}function Fx(r){let[t]=r.split(":");Ux.includes(t)||(r="http"+r.substring(t.length));let{protocol:e,hostname:n,port:o,pathname:i,search:s}=new URL(r);if(o==null||o===""){let c=Vx(t);c!=null&&(o=c),c==null&&e==="http:"&&(o="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),s!=null&&s!==""&&(a=a??"",a+=s),{scheme:t,hostname:n,port:o,path:a}}function Ox(r,t){if(!(r==null||r==="")){if(Dp(r))return["ip4",r];if(Wu(r))return["ip6",r];if(r[0]==="["){let e=r.substring(1,r.length-1);if(Wu(e))return["ip6",e]}return[t,r]}}function Mx(r,t){if(!(r==null||r===""))return t==="udp"?["udp",r]:["tcp",r]}function Kx(r){if(r.match(/^tcp$|^udp$/)==null)return r==="https"?["/tls/http"]:r==="wss"?["/tls/ws"]:[r]}function $x(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function Vx(r){if(!(r==null||r===""||Up[r]==null))return Up[r]}var qx=["https://trustless-gateway.link","https://4everland.io"],zx=2336;function Hx(r){return r=r.toString(),{id:mc(K.createV1(zx,Nt.digest(V(r)))),multiaddrs:[Fp(r)]}}var Yu=class{gateways;shuffle;constructor(t={}){this.gateways=(t.gateways??qx).map(e=>Hx(e)),this.shuffle=t.shuffle??!0}async*findProviders(t,e){yield*(this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}};function Ps(r={}){return new Yu(r)}var Pn=class extends Ge{data;constructor(){super(),this.data=new Map}put(t,e){return this.data.set(At.encode(t.multihash.bytes),e),t}get(t){let e=this.data.get(At.encode(t.multihash.bytes));if(e==null)throw new oe;return e}has(t){return this.data.has(At.encode(t.multihash.bytes))}async delete(t){this.data.delete(At.encode(t.multihash.bytes))}async*getAll(){for(let[t,e]of this.data.entries())yield{cid:K.createV1(Fn,fe(At.decode(t))),block:e}}};var UT=Zt("blockstore:core:tiered");var Kp="SHARDING";function Gx(r){return r[Symbol.asyncIterator]!=null}function Wx(r){if(Gx(r))return(async()=>{let e=[];for await(let n of r)e.push(n);return e})();let t=[];for(let e of r)t.push(e);return t}var Zu=Wx;function Yx(r){return r[Symbol.asyncIterator]!=null}function Zx(r,t){return Yx(r)?async function*(){yield*(await Zu(r)).sort(t)}():function*(){yield*Zu(r).sort(t)}()}var Bs=Zx;var Xe=class{put(t,e,n){return Promise.reject(new Error(".put is not implemented"))}get(t,e){return Promise.reject(new Error(".get is not implemented"))}has(t,e){return Promise.reject(new Error(".has is not implemented"))}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,e={}){for await(let{key:n,value:o}of t)await this.put(n,o,e),yield n}async*getMany(t,e={}){for await(let n of t)yield{key:n,value:await this.get(n,e)}}async*deleteMany(t,e={}){for await(let n of t)await this.delete(n,e),yield n}batch(){let t=[],e=[];return{put(n,o){t.push({key:n,value:o})},delete(n){e.push(n)},commit:async n=>{await wr(this.putMany(t,n)),t=[],await wr(this.deleteMany(e,n)),e=[]}}}async*_all(t,e){throw new Error("._all is not implemented")}async*_allKeys(t,e){throw new Error("._allKeys is not implemented")}query(t,e){let n=this._all(t,e);if(t.prefix!=null){let o=t.prefix;n=we(n,i=>i.key.toString().startsWith(o))}if(Array.isArray(t.filters)&&(n=t.filters.reduce((o,i)=>we(o,i),n)),Array.isArray(t.orders)&&(n=t.orders.reduce((o,i)=>Bs(o,i),n)),t.offset!=null){let o=0,i=t.offset;n=we(n,()=>o++>=i)}return t.limit!=null&&(n=Vo(n,t.limit)),n}queryKeys(t,e){let n=this._allKeys(t,e);if(t.prefix!=null){let o=t.prefix;n=we(n,i=>i.toString().startsWith(o))}if(Array.isArray(t.filters)&&(n=t.filters.reduce((o,i)=>we(o,i),n)),Array.isArray(t.orders)&&(n=t.orders.reduce((o,i)=>Bs(o,i),n)),t.offset!=null){let o=t.offset,i=0;n=we(n,()=>i++>=o)}return t.limit!=null&&(n=Vo(n,t.limit)),n}};var Bn=class extends Xe{data;constructor(){super(),this.data=new Map}put(t,e){return this.data.set(t.toString(),e),t}get(t){let e=this.data.get(t.toString());if(e==null)throw new oe;return e}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(let[t,e]of this.data.entries())yield{key:new Dt(t),value:e}}*_allKeys(){for(let t of this.data.keys())yield new Dt(t)}};var yk=new Dt(Kp);var Pk=Zt("datastore:core:tiered");async function Xx(r={}){let t=r.datastore??new Bn,e=r.blockstore??new Pn;return{...r,datastore:t,blockstore:e,blockBrokers:r.blockBrokers??[ps()],routers:r.routers??[ks("https://delegated-ipfs.dev"),Ps()]}}async function Qx(r={}){let t=r.datastore??new Bn,e=r.blockstore??new Pn,n=new Xi({...r,datastore:t,blockstore:e,blockBrokers:r.blockBrokers??[ps()],routers:r.routers??[ks("https://delegated-ipfs.dev"),Ps()]});return r.start!==!1&&await n.start(),n}return Xp(Jx);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return HeliaHttp}));
//# sourceMappingURL=index.min.js.map
